const global = typeof global !== 'undefined' ? global :
                typeof self !== 'undefined' ? self :
                    typeof window !== 'undefined' ? window : {};
global.connect = global.connect || {};
const currentWebsocketManager = connect.WebSocketManager;

(()=>{var e={975:(e,n,t)=>{var o;!function(){"use strict";var r={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function i(e){return function(e,n){var t,o,c,a,s,u,l,d,p,f=1,g=e.length,b="";for(o=0;o<g;o++)if("string"==typeof e[o])b+=e[o];else if("object"==typeof e[o]){if((a=e[o]).keys)for(t=n[f],c=0;c<a.keys.length;c++){if(null==t)throw new Error(i('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[c],a.keys[c-1]));t=t[a.keys[c]]}else t=a.param_no?n[a.param_no]:n[f++];if(r.not_type.test(a.type)&&r.not_primitive.test(a.type)&&t instanceof Function&&(t=t()),r.numeric_arg.test(a.type)&&"number"!=typeof t&&isNaN(t))throw new TypeError(i("[sprintf] expecting number but found %T",t));switch(r.number.test(a.type)&&(d=t>=0),a.type){case"b":t=parseInt(t,10).toString(2);break;case"c":t=String.fromCharCode(parseInt(t,10));break;case"d":case"i":t=parseInt(t,10);break;case"j":t=JSON.stringify(t,null,a.width?parseInt(a.width):0);break;case"e":t=a.precision?parseFloat(t).toExponential(a.precision):parseFloat(t).toExponential();break;case"f":t=a.precision?parseFloat(t).toFixed(a.precision):parseFloat(t);break;case"g":t=a.precision?String(Number(t.toPrecision(a.precision))):parseFloat(t);break;case"o":t=(parseInt(t,10)>>>0).toString(8);break;case"s":t=String(t),t=a.precision?t.substring(0,a.precision):t;break;case"t":t=String(!!t),t=a.precision?t.substring(0,a.precision):t;break;case"T":t=Object.prototype.toString.call(t).slice(8,-1).toLowerCase(),t=a.precision?t.substring(0,a.precision):t;break;case"u":t=parseInt(t,10)>>>0;break;case"v":t=t.valueOf(),t=a.precision?t.substring(0,a.precision):t;break;case"x":t=(parseInt(t,10)>>>0).toString(16);break;case"X":t=(parseInt(t,10)>>>0).toString(16).toUpperCase()}r.json.test(a.type)?b+=t:(!r.number.test(a.type)||d&&!a.sign?p="":(p=d?"+":"-",t=t.toString().replace(r.sign,"")),u=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",l=a.width-(p+t).length,s=a.width&&l>0?u.repeat(l):"",b+=a.align?p+t+s:"0"===u?p+s+t:s+p+t)}return b}(function(e){if(a[e])return a[e];for(var n,t=e,o=[],i=0;t;){if(null!==(n=r.text.exec(t)))o.push(n[0]);else if(null!==(n=r.modulo.exec(t)))o.push("%");else{if(null===(n=r.placeholder.exec(t)))throw new SyntaxError("[sprintf] unexpected placeholder");if(n[2]){i|=1;var c=[],s=n[2],u=[];if(null===(u=r.key.exec(s)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(c.push(u[1]);""!==(s=s.substring(u[0].length));)if(null!==(u=r.key_access.exec(s)))c.push(u[1]);else{if(null===(u=r.index_access.exec(s)))throw new SyntaxError("[sprintf] failed to parse named argument key");c.push(u[1])}n[2]=c}else i|=2;if(3===i)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");o.push({placeholder:n[0],param_no:n[1],keys:n[2],sign:n[3],pad_char:n[4],align:n[5],width:n[6],precision:n[7],type:n[8]})}t=t.substring(n[0].length)}return a[e]=o}(e),arguments)}function c(e,n){return i.apply(null,[e].concat(n||[]))}var a=Object.create(null);n.sprintf=i,n.vsprintf=c,"undefined"!=typeof window&&(window.sprintf=i,window.vsprintf=c,void 0===(o=function(){return{sprintf:i,vsprintf:c}}.call(n,t,n,e))||(e.exports=o))}()}},n={};function t(o){var r=n[o];if(void 0!==r)return r.exports;var i=n[o]={exports:{}};return e[o](i,i.exports,t),i.exports}(()=>{"use strict";function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}var n=t(975),o="AMZ_WEB_SOCKET_MANAGER:",r="aws/subscribe",i="aws/heartbeat",c="aws/ping",a="disconnected",s={assertTrue:function(e,n){if(!e)throw new Error(n)},assertNotNull:function(t,o){return s.assertTrue(null!==t&&void 0!==e(t),(0,n.sprintf)("%s must be provided",o||"A value")),t},isNonEmptyString:function(e){return"string"==typeof e&&e.length>0},assertIsList:function(e,n){if(!Array.isArray(e))throw new Error(n+" is not an array")},isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},isObject:function(n){return!("object"!==e(n)||null===n)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e}},u=new RegExp("^(wss://)\\w*"),l=new RegExp("^(ws://127.0.0.1:)");s.validWSUrl=function(e){return u.test(e)||l.test(e)},s.getSubscriptionResponse=function(e,n,t){return{topic:e,content:{status:n?"success":"failure",topics:t}}},s.assertIsObject=function(e,n){if(!s.isObject(e))throw new Error(n+" is not an object!")},s.addJitter=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;n=Math.min(n,1);var t=Math.random()>.5?1:-1;return Math.floor(e+t*e*Math.random()*n)},s.isNetworkOnline=function(){return navigator.onLine},s.isNetworkFailure=function(e){return!(!e._debug||!e._debug.type)&&"NetworkingError"===e._debug.type};const d=s;function p(e,n){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},p(e,n)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function g(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function b(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function m(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function v(e,n,t){return n&&m(e.prototype,n),t&&m(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(n){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,r=f(n);if(t){var i=f(this).constructor;o=Reflect.construct(r,arguments,i)}else o=r.apply(this,arguments);return function(n,t){if(t&&("object"===e(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)}(this,o)}}function y(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}var k=function(){function e(){b(this,e)}return v(e,[{key:"debug",value:function(e){}},{key:"info",value:function(e){}},{key:"warn",value:function(e){}},{key:"error",value:function(e){}},{key:"advancedLog",value:function(e){}}]),e}(),w=o,S={DEBUG:10,INFO:20,WARN:30,ERROR:40,ADVANCED_LOG:50},C=function(){function n(e){b(this,n),this.logMetaData=e||"",this.updateLoggerConfig()}return v(n,[{key:"hasLogMetaData",value:function(){return!!this.logMetaData}},{key:"writeToClientLogger",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(this.hasClientLogger()){var t="string"==typeof n?n:JSON.stringify(n,O()),o="string"==typeof this.logMetaData?this.logMetaData:JSON.stringify(this.logMetaData,O()),r="".concat(function(e){switch(e){case 10:return"DEBUG";case 20:return"INFO";case 30:return"WARN";case 40:return"ERROR";case 50:return"ADVANCED_LOG"}}(e)," ").concat(t);switch(o&&(r+=" ".concat(o)),e){case S.DEBUG:return this._clientLogger.debug(r)||r;case S.INFO:return this._clientLogger.info(r)||r;case S.WARN:return this._clientLogger.warn(r)||r;case S.ERROR:return this._clientLogger.error(r)||r;case S.ADVANCED_LOG:return this._advancedLogWriter?this._clientLogger[this._advancedLogWriter](r)||r:""}}}},{key:"isLevelEnabled",value:function(e){return e>=this._level}},{key:"hasClientLogger",value:function(){return null!==this._clientLogger}},{key:"getLogger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.prefix||w;return e.logMetaData&&this.setLogMetaData(e.logMetaData),new L(this,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?y(Object(t),!0).forEach((function(n){g(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({prefix:n,logMetaData:this.logMetaData},e))}},{key:"setLogMetaData",value:function(e){this.logMetaData=e}},{key:"updateLoggerConfig",value:function(n){var t=n||{};this._level=t.level||S.INFO,this._advancedLogWriter="warn",t.advancedLogWriter&&(this._advancedLogWriter=t.advancedLogWriter),t.customizedLogger&&"object"===e(t.customizedLogger)?this.useClientLogger=!0:this.useClientLogger=!1,this._clientLogger=t.logger||this.selectLogger(t),this._logsDestination="NULL",t.debug&&(this._logsDestination="DEBUG"),t.logger&&(this._logsDestination="CLIENT_LOGGER")}},{key:"selectLogger",value:function(n){return n.customizedLogger&&"object"===e(n.customizedLogger)?n.customizedLogger:n.useDefaultLogger?W():null}}]),n}(),T=function(){function e(){b(this,e)}return v(e,[{key:"debug",value:function(){}},{key:"info",value:function(){}},{key:"warn",value:function(){}},{key:"error",value:function(){}},{key:"advancedLog",value:function(){}}]),e}(),L=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&p(e,n)}(t,e);var n=h(t);function t(e,o){var r;return b(this,t),(r=n.call(this)).options=o||{},r.prefix=o.prefix||w,r.excludeTimestamp=o.excludeTimestamp,r.logManager=e,r}return v(t,[{key:"debug",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return this._log(S.DEBUG,n)}},{key:"info",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return this._log(S.INFO,n)}},{key:"warn",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return this._log(S.WARN,n)}},{key:"error",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return this._log(S.ERROR,n)}},{key:"advancedLog",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return this._log(S.ADVANCED_LOG,n)}},{key:"_shouldLog",value:function(e){return this.logManager.hasClientLogger()&&this.logManager.isLevelEnabled(e)}},{key:"_writeToClientLogger",value:function(e,n){return this.logManager.writeToClientLogger(e,n)}},{key:"_log",value:function(e,n){if(this._shouldLog(e)){var t=this.logManager.useClientLogger?n:this._convertToSingleStatement(n);return this._writeToClientLogger(e,t)}}},{key:"_convertToSingleStatement",value:function(e){var n=new Date(Date.now()).toISOString(),t=this.excludeTimestamp?"":"[".concat(n,"] ");(this.prefix||this.options.prefix)&&(t+=(this.options.prefix||this.prefix)+":");for(var o=0;o<e.length;o++){var r=e[o];t+=this._convertToString(r)+" "}return t}},{key:"_convertToString",value:function(e){try{if(!e)return"";if(d.isString(e))return e;if(d.isObject(e)&&d.isFunction(e.toString)){var n=e.toString();if(!n.startsWith("[object"))return n}return JSON.stringify(e)}catch(n){return console.error("Error while converting argument to string",e,n),""}}}]),t}(T);function O(){var n=new WeakSet;return function(t,o){if("object"===e(o)&&null!==o){if(n.has(o))return;n.add(o)}return o}}var W=function(){var e=new T;return e.debug=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return console.debug.apply(window.console,[].concat(n))},e.info=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return console.info.apply(window.console,[].concat(n))},e.warn=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return console.warn.apply(window.console,[].concat(n))},e.error=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return console.error.apply(window.console,[].concat(n))},e},I=function(){function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3;b(this,e),this.numAttempts=0,this.executor=n,this.hasActiveReconnection=!1,this.defaultRetry=t}return v(e,[{key:"retry",value:function(){var e=this;this.hasActiveReconnection||(this.hasActiveReconnection=!0,setTimeout((function(){e._execute()}),this._getDelay()))}},{key:"_execute",value:function(){this.hasActiveReconnection=!1,this.executor(),this.numAttempts++}},{key:"connected",value:function(){this.numAttempts=0}},{key:"_getDelay",value:function(){var e=Math.pow(2,this.numAttempts)*this.defaultRetry;return e<=3e4?e:3e4}},{key:"getIsConnected",value:function(){return!this.numAttempts}}]),e}(),N=null,F=function(){var e=N.getLogger({prefix:o,excludeTimestamp:!0}),n=d.isNetworkOnline(),t={primary:null,secondary:null},s={reconnectWebSocket:!0,websocketInitFailed:!1,exponentialBackOffTime:1e3,exponentialTimeoutHandle:null,lifeTimeTimeoutHandle:null,webSocketInitCheckerTimeoutId:null,connState:null},u={connectWebSocketRetryCount:0,connectionAttemptStartTime:null,noOpenConnectionsTimestamp:null},l={pendingResponse:!1,intervalHandle:null},p={pendingResponse:!1,intervalHandle:null},f={initFailure:new Set,getWebSocketTransport:null,subscriptionUpdate:new Set,subscriptionFailure:new Set,topic:new Map,allMessage:new Set,connectionGain:new Set,connectionLost:new Set,connectionOpen:new Set,connectionClose:new Set,deepHeartbeatSuccess:new Set,deepHeartbeatFailure:new Set,topicFailure:new Set},g={connConfig:null,promiseHandle:null,promiseCompleted:!0},b={subscribed:new Set,pending:new Set,subscriptionHistory:new Set},m={responseCheckIntervalId:null,requestCompleted:!0,reSubscribeIntervalId:null,consecutiveFailedSubscribeAttempts:0,consecutiveNoResponseRequest:0},v=new I((function(){U().catch((function(){}))})),h=new Set([r,"aws/unsubscribe",i,c]),y=setInterval((function(){if(n!==d.isNetworkOnline()){if(!(n=d.isNetworkOnline()))return void J(e.advancedLog("Network offline"));var t=O();n&&(!t||C(t,WebSocket.CLOSING)||C(t,WebSocket.CLOSED))&&(J(e.advancedLog("Network online, connecting to WebSocket server")),U().catch((function(){})))}}),250),k=function(n,t){n.forEach((function(n){try{n(t)}catch(n){J(e.error("Error executing callback",n))}}))},w=function(e){if(null===e)return"NULL";switch(e.readyState){case WebSocket.CONNECTING:return"CONNECTING";case WebSocket.OPEN:return"OPEN";case WebSocket.CLOSING:return"CLOSING";case WebSocket.CLOSED:return"CLOSED";default:return"UNDEFINED"}},S=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";J(e.debug("["+n+"] Primary WebSocket: "+w(t.primary)+" | Secondary WebSocket: "+w(t.secondary)))},C=function(e,n){return e&&e.readyState===n},T=function(e){return C(e,WebSocket.OPEN)},L=function(e){return null===e||void 0===e.readyState||C(e,WebSocket.CLOSED)},O=function(){return null!==t.secondary?t.secondary:t.primary},W=function(){return T(O())},F=function(){if(p.pendingResponse&&(J(e.debug("aws/ping deep heartbeat response not received")),k(f.deepHeartbeatFailure,{timestamp:Date.now(),error:"aws/ping response is not received"}),clearInterval(p.intervalHandle),p.pendingResponse=!1),l.pendingResponse)return J(e.warn("Heartbeat response not received")),clearInterval(l.intervalHandle),l.intervalHandle=null,l.pendingResponse=!1,void U().catch((function(){}));W()?(J(e.debug("Sending aws/ping deep heartbeat")),O().send(G(c)),p.pendingResponse=!0,J(e.debug("Sending heartbeat")),O().send(G(i)),l.pendingResponse=!0):(J(e.debug("Failed to send aws/ping deep heartbeat since WebSocket is not open")),k(f.deepHeartbeatFailure,{timestamp:Date.now(),error:"Unable to send message to aws/ping because websocket connection is not established."}),J(e.warn("Failed to send heartbeat since WebSocket is not open")),S("sendHeartBeat"),U().catch((function(){})))},_=function(){J(e.advancedLog("Reset Websocket state")),s.exponentialBackOffTime=1e3,l.pendingResponse=!1,p.pendingResponse=!1,s.reconnectWebSocket=!0,clearTimeout(s.lifeTimeTimeoutHandle),clearInterval(l.intervalHandle),clearInterval(p.intervalHandle),clearTimeout(s.exponentialTimeoutHandle),clearTimeout(s.webSocketInitCheckerTimeoutId),l.intervalHandle=null},E=function(){m.consecutiveFailedSubscribeAttempts=0,m.consecutiveNoResponseRequest=0,clearInterval(m.responseCheckIntervalId),clearInterval(m.reSubscribeIntervalId)},D=function(){u.connectWebSocketRetryCount=0,u.connectionAttemptStartTime=null,u.noOpenConnectionsTimestamp=null},R=function(){v.connected();try{J(e.advancedLog("WebSocket connection established!")),S("webSocketOnOpen"),null!==s.connState&&s.connState!==a||k(f.connectionGain),s.connState="connected";var n=Date.now();k(f.connectionOpen,{connectWebSocketRetryCount:u.connectWebSocketRetryCount,connectionAttemptStartTime:u.connectionAttemptStartTime,noOpenConnectionsTimestamp:u.noOpenConnectionsTimestamp,connectionEstablishedTime:n,timeToConnect:n-u.connectionAttemptStartTime,timeWithoutConnection:u.noOpenConnectionsTimestamp?n-u.noOpenConnectionsTimestamp:null}),D(),_(),O().openTimestamp=Date.now(),0===b.subscribed.size&&T(t.secondary)&&j(t.primary,"[Primary WebSocket] Closing WebSocket"),(b.subscribed.size>0||b.pending.size>0)&&(T(t.secondary)&&J(e.info("Subscribing secondary websocket to topics of primary websocket")),b.subscribed.forEach((function(e){b.subscriptionHistory.add(e),b.pending.add(e)})),b.subscribed.clear(),M()),F(),null!==l.intervalHandle&&clearInterval(l.intervalHandle),l.intervalHandle=setInterval(F,1e4);var o=1e3*g.connConfig.webSocketTransport.transportLifeTimeInSeconds;J(e.debug("Scheduling WebSocket manager reconnection, after delay "+o+" ms")),s.lifeTimeTimeoutHandle=setTimeout((function(){J(e.debug("Starting scheduled WebSocket manager reconnection")),U().catch((function(){}))}),o)}catch(n){J(e.error("Error after establishing WebSocket connection",n))}},x=function(n){S("webSocketOnError"),J(e.advancedLog("WebSocketManager Error, error_event: ",JSON.stringify(n))),v.getIsConnected()?U().catch((function(){})):v.retry()},A=function(n){if(void 0!==n.data&&""!==n.data){var o=JSON.parse(n.data);switch(o.topic){case r:if(J(e.debug("Subscription Message received from webSocket server")),m.requestCompleted=!0,m.consecutiveNoResponseRequest=0,"success"===o.content.status)m.consecutiveFailedSubscribeAttempts=0,o.content.topics.forEach((function(e){b.subscriptionHistory.delete(e),b.pending.delete(e),b.subscribed.add(e)})),0===b.subscriptionHistory.size?T(t.secondary)&&(J(e.debug("Successfully subscribed secondary websocket to all topics of primary websocket")),j(t.primary,"[Primary WebSocket] Closing WebSocket")):M(),k(f.subscriptionUpdate,o);else{if(clearInterval(m.reSubscribeIntervalId),++m.consecutiveFailedSubscribeAttempts,5===m.consecutiveFailedSubscribeAttempts)return k(f.subscriptionFailure,o),void(m.consecutiveFailedSubscribeAttempts=0);m.reSubscribeIntervalId=setInterval((function(){M()}),500)}break;case i:J(e.debug("Heartbeat response received")),l.pendingResponse=!1,null===l.intervalHandle&&(l.intervalHandle=setInterval(F,1e4));break;case c:J(e.debug("aws/ping deep heartbeat received")),p.pendingResponse=!1,200===o.statusCode?k(f.deepHeartbeatSuccess,{timestamp:Date.now()}):k(f.deepHeartbeatFailure,{timestamp:Date.now(),statusCode:o.statusCode,statusContent:o.statusContent});break;default:if(o.topic){if(J(e.advancedLog("Message received for topic ",o.topic)),T(t.primary)&&T(t.secondary)&&0===b.subscriptionHistory.size&&this===t.primary)return void J(e.warn("Ignoring Message for Topic "+o.topic+", to avoid duplicates"));if(0===f.allMessage.size&&0===f.topic.size)return void J(e.warn("No registered callback listener for Topic",o.topic));J(e.advancedLog("WebsocketManager invoke callbacks for topic success ",o.topic)),k(f.allMessage,o),f.topic.has(o.topic)&&k(f.topic.get(o.topic),o)}else o.message?(J(e.advancedLog("WebSocketManager Message Error",o)),k(f.topicFailure,{timestamp:Date.now(),errorMessage:o.message,connectionId:o.connectionId,requestId:o.requestId})):J(e.advancedLog("Invalid incoming message",o))}}else J(e.warn("An empty message has been received on Websocket. Ignoring"))},M=function n(){if(m.consecutiveNoResponseRequest>3)return J(e.warn("Ignoring subscribePendingTopics since we have exhausted max subscription retries with no response")),void k(f.subscriptionFailure,d.getSubscriptionResponse(r,!1,Array.from(b.pending)));W()?0!==Array.from(b.pending).length&&(clearInterval(m.responseCheckIntervalId),O().send(G(r,{topics:Array.from(b.pending)})),m.requestCompleted=!1,m.responseCheckIntervalId=setInterval((function(){m.requestCompleted||(++m.consecutiveNoResponseRequest,n())}),1e3)):J(e.warn("Ignoring subscribePendingTopics call since Default WebSocket is not open"))},j=function(n,t){C(n,WebSocket.CONNECTING)||C(n,WebSocket.OPEN)?n.close(1e3,t):J(e.warn("Ignoring WebSocket Close request, WebSocket State: "+w(n)))},H=function(e){j(t.primary,"[Primary] WebSocket "+e),j(t.secondary,"[Secondary] WebSocket "+e)},P=function(n){_(),E(),J(e.advancedLog("WebSocket Initialization failed - Terminating and cleaning subscriptions",n)),s.websocketInitFailed=!0,H("Terminating WebSocket Manager"),clearInterval(y),k(f.initFailure,{connectWebSocketRetryCount:u.connectWebSocketRetryCount,connectionAttemptStartTime:u.connectionAttemptStartTime,reason:n}),D()},G=function(e,n){return JSON.stringify({topic:e,content:n})},z=function(n){return!!(d.isObject(n)&&d.isObject(n.webSocketTransport)&&d.isNonEmptyString(n.webSocketTransport.url)&&d.validWSUrl(n.webSocketTransport.url)&&1e3*n.webSocketTransport.transportLifeTimeInSeconds>=3e5)||(J(e.error("Invalid WebSocket Connection Configuration",n)),!1)},U=function(){return d.isNetworkOnline()?s.websocketInitFailed?(J(e.debug("WebSocket Init had failed, ignoring this getWebSocketConnConfig request")),Promise.resolve({webSocketConnectionFailed:!0})):g.promiseCompleted?(_(),J(e.advancedLog("Fetching new WebSocket connection configuration")),u.connectionAttemptStartTime=u.connectionAttemptStartTime||Date.now(),g.promiseCompleted=!1,g.promiseHandle=f.getWebSocketTransport(),g.promiseHandle.then((function(n){return g.promiseCompleted=!0,J(e.advancedLog("Successfully fetched webSocket connection configuration")),z(n)?(g.connConfig=n,g.connConfig.urlConnValidTime=Date.now()+85e3,q()):(P("Invalid WebSocket connection configuration: "+n),{webSocketConnectionFailed:!0})}),(function(n){return g.promiseCompleted=!0,J(e.advancedLog("Failed to fetch webSocket connection configuration",n)),d.isNetworkFailure(n)?(J(e.advancedLog("Retrying fetching new WebSocket connection configuration",n)),v.retry()):P("Failed to fetch webSocket connection configuration: "+JSON.stringify(n)),{webSocketConnectionFailed:!0}}))):(J(e.debug("There is an ongoing getWebSocketConnConfig request, this request will be ignored")),Promise.resolve({webSocketConnectionFailed:!0})):(J(e.advancedLog("Network offline, ignoring this getWebSocketConnConfig request")),Promise.resolve({webSocketConnectionFailed:!0}))},q=function(){if(s.websocketInitFailed)return J(e.info("web-socket initializing had failed, aborting re-init")),{webSocketConnectionFailed:!0};if(!d.isNetworkOnline())return J(e.warn("System is offline aborting web-socket init")),{webSocketConnectionFailed:!0};J(e.advancedLog("Initializing Websocket Manager")),S("initWebSocket");try{if(z(g.connConfig)){var n=null;return T(t.primary)?(J(e.debug("Primary Socket connection is already open")),C(t.secondary,WebSocket.CONNECTING)||(J(e.debug("Establishing a secondary web-socket connection")),v.numAttempts=0,t.secondary=B()),n=t.secondary):(C(t.primary,WebSocket.CONNECTING)||(J(e.debug("Establishing a primary web-socket connection")),t.primary=B()),n=t.primary),s.webSocketInitCheckerTimeoutId=setTimeout((function(){T(n)||function(){u.connectWebSocketRetryCount++;var n=d.addJitter(s.exponentialBackOffTime,.3);Date.now()+n<=g.connConfig.urlConnValidTime?(J(e.advancedLog("Scheduling WebSocket reinitialization, after delay "+n+" ms")),s.exponentialTimeoutHandle=setTimeout((function(){return q()}),n),s.exponentialBackOffTime*=2):(J(e.advancedLog("WebSocket URL cannot be used to establish connection")),U().catch((function(){})))}()}),1e3),{webSocketConnectionFailed:!1}}}catch(n){return J(e.error("Error Initializing web-socket-manager",n)),P("Failed to initialize new WebSocket: "+n.message),{webSocketConnectionFailed:!0}}},B=function(){var n=new WebSocket(g.connConfig.webSocketTransport.url);return n.addEventListener("open",R),n.addEventListener("message",A),n.addEventListener("error",x),n.addEventListener("close",(function(o){return function(n,o){var r={openTimestamp:o.openTimestamp,closeTimestamp:Date.now(),connectionDuration:Date.now()-o.openTimestamp,code:n.code,reason:n.reason,wasClean:n.wasClean},i="Close Code: ".concat(r.code," - Reason: ").concat(r.reason," - WasClean: ").concat(r.wasClean),c="OpenTimestamp: ".concat(r.openTimestamp," - CloseTimestamp: ").concat(r.closeTimestamp," - ConnectionDuration: ").concat(r.connectionDuration);J(e.advancedLog("WebSocket connection is closed. ",i)),J(e.advancedLog("Closed WebSocket connection duration: ",c)),S("webSocketOnClose before-cleanup"),k(f.connectionClose,r),L(t.primary)&&(t.primary=null),L(t.secondary)&&(t.secondary=null),s.reconnectWebSocket&&(T(t.primary)||T(t.secondary)?L(t.primary)&&T(t.secondary)&&(J(e.debug("[Primary] WebSocket Cleanly Closed")),t.primary=t.secondary,t.secondary=null):(J(e.warn("Neither primary websocket and nor secondary websocket have open connections, attempting to re-establish connection")),s.connState===a?J(e.info("Ignoring connectionLost callback invocation")):(k(f.connectionLost,{openTimestamp:o.openTimestamp,closeTimestamp:Date.now(),connectionDuration:Date.now()-o.openTimestamp,code:n.code,reason:n.reason}),u.noOpenConnectionsTimestamp=Date.now()),s.connState=a,U().catch((function(){}))),S("webSocketOnClose after-cleanup"))}(o,n)})),n},J=function(e){return e&&"function"==typeof e.sendInternalLogToServer&&e.sendInternalLogToServer(),e};this.init=function(n){if(d.assertTrue(d.isFunction(n),"transportHandle must be a function"),null===f.getWebSocketTransport)return f.getWebSocketTransport=n,U();J(e.warn("Web Socket Manager was already initialized"))},this.onInitFailure=function(n){return J(e.advancedLog("Initializing Websocket Manager Failure callback registered")),d.assertTrue(d.isFunction(n),"cb must be a function"),f.initFailure.add(n),s.websocketInitFailed&&n(),function(){return f.initFailure.delete(n)}},this.onConnectionOpen=function(n){return J(e.advancedLog("Websocket connection open callback registered")),d.assertTrue(d.isFunction(n),"cb must be a function"),f.connectionOpen.add(n),function(){return f.connectionOpen.delete(n)}},this.onConnectionClose=function(n){return J(e.advancedLog("Websocket connection close callback registered")),d.assertTrue(d.isFunction(n),"cb must be a function"),f.connectionClose.add(n),function(){return f.connectionClose.delete(n)}},this.onConnectionGain=function(n){return J(e.advancedLog("Websocket connection gain callback registered")),d.assertTrue(d.isFunction(n),"cb must be a function"),f.connectionGain.add(n),W()&&n(),function(){return f.connectionGain.delete(n)}},this.onConnectionLost=function(n){return J(e.advancedLog("Websocket connection lost callback registered")),d.assertTrue(d.isFunction(n),"cb must be a function"),f.connectionLost.add(n),s.connState===a&&n(),function(){return f.connectionLost.delete(n)}},this.onSubscriptionUpdate=function(e){return d.assertTrue(d.isFunction(e),"cb must be a function"),f.subscriptionUpdate.add(e),function(){return f.subscriptionUpdate.delete(e)}},this.onSubscriptionFailure=function(n){return J(e.advancedLog("Websocket subscription failure callback registered")),d.assertTrue(d.isFunction(n),"cb must be a function"),f.subscriptionFailure.add(n),function(){return f.subscriptionFailure.delete(n)}},this.onMessage=function(e,n){return d.assertNotNull(e,"topicName"),d.assertTrue(d.isFunction(n),"cb must be a function"),f.topic.has(e)?f.topic.get(e).add(n):f.topic.set(e,new Set([n])),function(){return f.topic.get(e).delete(n)}},this.onAllMessage=function(e){return d.assertTrue(d.isFunction(e),"cb must be a function"),f.allMessage.add(e),function(){return f.allMessage.delete(e)}},this.subscribeTopics=function(e){d.assertNotNull(e,"topics"),d.assertIsList(e),e.forEach((function(e){b.subscribed.has(e)||b.pending.add(e)})),m.consecutiveNoResponseRequest=0,M()},this.sendMessage=function(n){if(d.assertIsObject(n,"payload"),void 0===n.topic||h.has(n.topic))J(e.warn("Cannot send message, Invalid topic: "+n.topic));else{try{n=JSON.stringify(n)}catch(t){return void J(e.warn("Error stringify message",n))}W()?O().send(n):J(e.warn("Cannot send message, web socket connection is not open"))}},this.onDeepHeartbeatSuccess=function(n){return J(e.advancedLog("Websocket deep heartbeat success callback registered")),d.assertTrue(d.isFunction(n),"cb must be a function"),f.deepHeartbeatSuccess.add(n),function(){return f.deepHeartbeatSuccess.delete(n)}},this.onDeepHeartbeatFailure=function(n){return J(e.advancedLog("Websocket deep heartbeat failure callback registered")),d.assertTrue(d.isFunction(n),"cb must be a function"),f.deepHeartbeatFailure.add(n),function(){return f.deepHeartbeatFailure.delete(n)}},this.onTopicFailure=function(n){return J(e.advancedLog("Websocket topic failure callback registered")),d.assertTrue(d.isFunction(n),"cb must be a function"),f.topicFailure.add(n),function(){return f.topicFailure.delete(n)}},this.closeWebSocket=function(){_(),E(),s.reconnectWebSocket=!1,clearInterval(y),H("User request to close WebSocket")},this.terminateWebSocketManager=P},_={create:function(e){return N||(N=new C(e)),N.hasLogMetaData()||N.setLogMetaData(e),new F},setGlobalConfig:function(e){var n=e&&e.loggerConfig;N||(N=new C),N.updateLoggerConfig(n);var t=e&&e.webSocketManagerConfig,o=t&&t.isNetworkOnline;o&&"function"==typeof o&&(d.isNetworkOnline=o)},LogLevel:S,Logger:k};global.connect=global.connect||{},connect.WebSocketManager=_})()})();
//# sourceMappingURL=amazon-connect-websocket-manager.js.map

const WebSocketManager = connect.WebSocketManager;
connect.WebSocketManager = currentWebsocketManager || WebSocketManager;
export default WebSocketManager;
