(()=>{var e={639:e=>{var t,n=["assign"],r=["$metadata"];function i(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function o(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function s(e){o(a,r,i,s,c,"next",e)}function c(e){o(a,r,i,s,c,"throw",e)}s(void 0)}))}}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e){return new p(e,0)}function d(e){var t,n;function r(t,n){try{var o=e[t](n),a=o.value,s=a instanceof p;Promise.resolve(s?a.v:a).then((function(n){if(s){var c="return"===t?"return":"next";if(!a.k||n.done)return r(c,n);n=e[c](n).value}i(o.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new Promise((function(o,a){var s={key:e,arg:i,resolve:o,reject:a,next:null};n?n=n.next=s:(t=n=s,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function p(e,t){this.v=e,this.k=t}d.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},d.prototype.next=function(e){return this._invoke("next",e)},d.prototype.throw=function(e){return this._invoke("throw",e)},d.prototype.return=function(e){return this._invoke("return",e)},self,t=()=>(()=>{var e={880:function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=90)}({17:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var r=n(18),i=function(){function e(){}return e.getFirstMatch=function(e,t){var n=t.match(e);return n&&n.length>0&&n[1]||""},e.getSecondMatch=function(e,t){var n=t.match(e);return n&&n.length>1&&n[2]||""},e.matchAndReturnConst=function(e,t,n){if(e.test(t))return n},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,n,r){void 0===r&&(r=!1);var i=e.getVersionPrecision(t),o=e.getVersionPrecision(n),a=Math.max(i,o),s=0,c=e.map([t,n],(function(t){var n=a-e.getVersionPrecision(t),r=t+new Array(n+1).join(".0");return e.map(r.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(r&&(s=a-Math.min(i,o)),a-=1;a>=s;){if(c[0][a]>c[1][a])return 1;if(c[0][a]===c[1][a]){if(a===s)return 0;a-=1}else if(c[0][a]<c[1][a])return-1}},e.map=function(e,t){var n,r=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n+=1)r.push(t(e[n]));return r},e.find=function(e,t){var n,r;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(n=0,r=e.length;n<r;n+=1){var i=e[n];if(t(i,n))return i}},e.assign=function(e){for(var t,n,r=e,i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];if(Object.assign)return Object.assign.apply(Object,[e].concat(o));var s=function(){var e=o[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){r[t]=e[t]}))};for(t=0,n=o.length;t<n;t+=1)s();return e},e.getBrowserAlias=function(e){return r.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return r.BROWSER_MAP[e]||""},e}();t.default=i,e.exports=t.default},18:function(e,t,n){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var r,i=(r=n(91))&&r.__esModule?r:{default:r},o=n(18),a=function(){function e(){}var t;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new i.default(e,t)},e.parse=function(e){return new i.default(e).getResult()},(t=[{key:"BROWSER_MAP",get:function(){return o.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return o.ENGINE_MAP}},{key:"OS_MAP",get:function(){return o.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return o.PLATFORMS_MAP}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e,t),e}();t.default=a,e.exports=t.default},91:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var r=c(n(92)),i=c(n(93)),o=c(n(94)),a=c(n(95)),s=c(n(17));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=s.default.find(r.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=s.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=s.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=s.default.find(a.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return s.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,n={},r=0,i={},o=0;if(Object.keys(e).forEach((function(t){var a=e[t];"string"==typeof a?(i[t]=a,o+=1):"object"==typeof a&&(n[t]=a,r+=1)})),r>0){var a=Object.keys(n),c=s.default.find(a,(function(e){return t.isOS(e)}));if(c){var u=this.satisfies(n[c]);if(void 0!==u)return u}var l=s.default.find(a,(function(e){return t.isPlatform(e)}));if(l){var d=this.satisfies(n[l]);if(void 0!==d)return d}}if(o>0){var p=Object.keys(i),h=s.default.find(p,(function(e){return t.isBrowser(e,!0)}));if(void 0!==h)return this.compareVersion(i[h])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var n=this.getBrowserName().toLowerCase(),r=e.toLowerCase(),i=s.default.getBrowserTypeByAlias(r);return t&&i&&(r=i.toLowerCase()),r===n},t.compareVersion=function(e){var t=[0],n=e,r=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(n=e.substr(1),"="===e[1]?(r=!0,n=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?n=e.substr(1):"~"===e[0]&&(r=!0,n=e.substr(1)),t.indexOf(s.default.compareVersions(i,n,r))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=u,e.exports=t.default},92:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=/version\/(\d+(\.?_?\d+)+)/i,a=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},n=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},n=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},n=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},n=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},n=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},n=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},n=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},n=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},n=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},n=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},n=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},n=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},n=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},n=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},n=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return n&&(t.version=n),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},n=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},n=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},n=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},n=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},n=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},n=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},n=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},n=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},n=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},n=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},n=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},n=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},n=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t={name:"Android Browser"},n=i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},n=i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},n=i.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(t,e),version:i.default.getSecondMatch(t,e)}}}];t.default=a,e.exports=t.default},93:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=n(18),a=[{test:[/Roku\/DVP/],describe:function(e){var t=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:o.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),n=i.default.getWindowsVersionName(t);return{name:o.OS_MAP.Windows,version:t,versionName:n}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:o.OS_MAP.iOS},n=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return n&&(t.version=n),t}},{test:[/macintosh/i],describe:function(e){var t=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),n=i.default.getMacOSVersionName(t),r={name:o.OS_MAP.MacOS,version:t};return n&&(r.versionName=n),r}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:o.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),n=i.default.getAndroidVersionName(t),r={name:o.OS_MAP.Android,version:t};return n&&(r.versionName=n),r}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),n={name:o.OS_MAP.WebOS};return t&&t.length&&(n.version=t),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||i.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:o.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:o.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:o.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.PlayStation4,version:t}}}];t.default=a,e.exports=t.default},94:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=n(18),a=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=i.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",n={type:o.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(n.model=t),n}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),n=e.test(/like (ipod|iphone)/i);return t&&!n},describe:function(e){var t=i.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:o.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}}];t.default=a,e.exports=t.default},95:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0;var r,i=(r=n(17))&&r.__esModule?r:{default:r},o=n(18),a=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:o.ENGINE_MAP.Blink};var t=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:o.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:o.ENGINE_MAP.Trident},n=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:o.ENGINE_MAP.Presto},n=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=e.test(/gecko/i),n=e.test(/like gecko/i);return t&&!n},describe:function(e){var t={name:o.ENGINE_MAP.Gecko},n=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:o.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:o.ENGINE_MAP.WebKit},n=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}}];t.default=a,e.exports=t.default}})}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,o),i.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{"use strict";var e,t,u,p,h,f,g;o.r(s),o.d(s,{$Command:()=>Gt,AccessDeniedException:()=>si,ArtifactStatus:()=>bi,CancelParticipantAuthenticationCommand:()=>ao,ChatItemType:()=>Ei,CompleteAttachmentUploadCommand:()=>so,ConflictException:()=>di,ConnectParticipant:()=>bo,ConnectParticipantClient:()=>ri,ConnectParticipantServiceException:()=>ai,ConnectionType:()=>hi,CreateParticipantConnectionCommand:()=>co,DescribeViewCommand:()=>uo,DescribeViewResponseFilterSensitiveLog:()=>Ti,DisconnectParticipantCommand:()=>lo,GetAttachmentCommand:()=>po,GetAuthenticationUrlCommand:()=>ho,GetTranscriptCommand:()=>fo,InternalServerException:()=>ci,ParticipantRole:()=>wi,ResourceNotFoundException:()=>gi,ResourceType:()=>fi,ScanDirection:()=>vi,SendEventCommand:()=>go,SendMessageCommand:()=>mo,ServiceQuotaExceededException:()=>pi,SortKey:()=>yi,StartAttachmentUploadCommand:()=>vo,ThrottlingException:()=>ui,ValidationException:()=>li,ViewContentFilterSensitiveLog:()=>Ci,ViewFilterSensitiveLog:()=>Si,__Client:()=>zt,paginateGetTranscript:()=>So}),function(e){e.HEADER="header",e.QUERY="query"}(e||(e={})),(h=t||(t={})).HEADER="header",h.QUERY="query",function(e){e.HTTP="http",e.HTTPS="https"}(u||(u={})),function(e){e.MD5="md5",e.CRC32="crc32",e.CRC32C="crc32c",e.SHA1="sha1",e.SHA256="sha256"}(p||(p={})),(g=f||(f={}))[g.HEADER=0]="HEADER",g[g.TRAILER=1]="TRAILER";var m,v,y="__smithy_context";!function(e){e.PROFILE="profile",e.SSO_SESSION="sso-session",e.SERVICES="services"}(m||(m={})),function(e){e.HTTP_0_9="http/0.9",e.HTTP_1_0="http/1.0",e.TDS_8_0="tds/8.0"}(v||(v={}));class b{constructor(e){this.method=e.method||"GET",this.hostname=e.hostname||"localhost",this.port=e.port,this.query=e.query||{},this.headers=e.headers||{},this.body=e.body,this.protocol=e.protocol?":"!==e.protocol.slice(-1)?"".concat(e.protocol,":"):e.protocol:"https:",this.path=e.path?"/"!==e.path.charAt(0)?"/".concat(e.path):e.path:"/",this.username=e.username,this.password=e.password,this.fragment=e.fragment}static clone(e){var t,n=new b(c(c({},e),{},{headers:c({},e.headers)}));return n.query&&(n.query=(t=n.query,Object.keys(t).reduce(((e,n)=>{var r=t[n];return c(c({},e),{},{[n]:Array.isArray(r)?[...r]:r})}),{}))),n}static isInstance(e){if(!e)return!1;var t=e;return"method"in t&&"protocol"in t&&"hostname"in t&&"path"in t&&"object"==typeof t.query&&"object"==typeof t.headers}clone(){return b.clone(this)}}class w{constructor(e){this.statusCode=e.statusCode,this.reason=e.reason,this.headers=e.headers||{},this.body=e.body}static isInstance(e){if(!e)return!1;var t=e;return"number"==typeof t.statusCode&&"object"==typeof t.headers}}var E={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},C={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},S="X-Amzn-Trace-Id",T={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},I=e=>e[y]||(e[y]={}),A=e=>{if("function"==typeof e)return e;var t=Promise.resolve(e);return()=>t},k={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},O={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},M={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function N(e,t,n){return{applyToStack:r=>{r.add(((e,t)=>n=>function(){var r=a((function*(r){var{response:i}=yield n(r);try{return{response:i,output:yield t(i,e)}}catch(e){throw Object.defineProperty(e,"$response",{value:i}),"$metadata"in e||(e.message+="\n  Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.",void 0!==e.$responseBodyText&&e.$response&&(e.$response.body=e.$responseBodyText)),e}}));return function(e){return r.apply(this,arguments)}}())(e,n),O),r.add(((e,t)=>(n,r)=>function(){var i=a((function*(i){var o,s=null!==(o=r.endpointV2)&&void 0!==o&&o.url&&e.urlParser?a((function*(){return e.urlParser(r.endpointV2.url)})):e.endpoint;if(!s)throw new Error("No valid endpoint provider available.");var u=yield t(i.input,c(c({},e),{},{endpoint:s}));return n(c(c({},i),{},{request:u}))}));return function(e){return i.apply(this,arguments)}}())(e,t),M)}}}for(var P=e=>e=>{throw e},R=(e,t)=>{},_={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},D=e=>{if("function"==typeof e)return e;var t=Promise.resolve(e);return()=>t},x=function(){var e=a((function*(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];return yield t.send(new e(n),...i)}));return function(t,n,r){return e.apply(this,arguments)}}(),L=(e,t)=>{var n=e,r=t.split(".");for(var i of r){if(!n||"object"!=typeof n)return;n=n[i]}return n},U={},F=new Array(64),j=0,W="A".charCodeAt(0),H="Z".charCodeAt(0);j+W<=H;j++){var B=String.fromCharCode(j+W);U[B]=j,F[j]=B}for(var z=0,G="a".charCodeAt(0),q="z".charCodeAt(0);z+G<=q;z++){var V=String.fromCharCode(z+G),$=z+26;U[V]=$,F[$]=V}for(var J=0;J<10;J++){U[J.toString(10)]=J+52;var K=J.toString(10),Y=J+52;U[K]=Y,F[Y]=K}U["+"]=62,F[62]="+",U["/"]=63,F[63]="/";var X=e=>{var t=e.length/4*3;"=="===e.slice(-2)?t-=2:"="===e.slice(-1)&&t--;for(var n=new ArrayBuffer(t),r=new DataView(n),i=0;i<e.length;i+=4){for(var o=0,a=0,s=i,c=i+3;s<=c;s++)if("="!==e[s]){if(!(e[s]in U))throw new TypeError("Invalid character ".concat(e[s]," in base64 string."));o|=U[e[s]]<<6*(c-s),a+=6}else o>>=6;var u=i/4*3;o>>=a%8;for(var l=Math.floor(a/8),d=0;d<l;d++){var p=8*(l-d-1);r.setUint8(u+d,(o&255<<p)>>p)}}return new Uint8Array(n)},Q=e=>(new TextEncoder).encode(e);function Z(e){var t,n="object"==typeof(t="string"==typeof e?Q(e):e)&&"number"==typeof t.length,r="object"==typeof t&&"number"==typeof t.byteOffset&&"number"==typeof t.byteLength;if(!n&&!r)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");for(var i="",o=0;o<t.length;o+=3){for(var a=0,s=0,c=o,u=Math.min(o+3,t.length);c<u;c++)a|=t[c]<<8*(u-c-1),s+=8;var l=Math.ceil(s/6);a<<=6*l-s;for(var d=1;d<=l;d++){var p=6*(l-d);i+=F[(a&63<<p)>>p]}i+="==".slice(0,4-l)}return i}var ee=e=>{if("string"==typeof e)return e;if("object"!=typeof e||"number"!=typeof e.byteOffset||"number"!=typeof e.byteLength)throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(e)};class te extends Uint8Array{static fromString(e){if("string"==typeof e)return function(e,t){return"base64"===t?te.mutate(X(e)):te.mutate(Q(e))}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8");throw new Error("Unsupported conversion from ".concat(typeof e," to Uint8ArrayBlobAdapter."))}static mutate(e){return Object.setPrototypeOf(e,te.prototype),e}transformToString(){return function(e){return"base64"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8")?Z(e):ee(e)}(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"utf-8")}}var ne=e=>encodeURIComponent(e).replace(/[!'()*]/g,re),re=e=>"%".concat(e.charCodeAt(0).toString(16).toUpperCase());function ie(e,t){return new Request(e,t)}function oe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(((t,n)=>{e&&setTimeout((()=>{var t=new Error("Request did not complete within ".concat(e," ms"));t.name="TimeoutError",n(t)}),e)}))}var ae={supported:void 0};class se{static create(e){return"function"==typeof(null==e?void 0:e.handle)?e:new se(e)}constructor(e){"function"==typeof e?this.configProvider=e().then((e=>e||{})):(this.config=null!=e?e:{},this.configProvider=Promise.resolve(this.config)),void 0===ae.supported&&(ae.supported=Boolean("undefined"!=typeof Request&&"keepalive"in ie("https://[::1]")))}destroy(){}handle(e){var t=arguments,n=this;return a((function*(){var r,i,o,{abortSignal:a}=t.length>1&&void 0!==t[1]?t[1]:{};n.config||(n.config=yield n.configProvider);var s=n.config.requestTimeout,c=!0===n.config.keepAlive,u=n.config.credentials;if(null!=a&&a.aborted){var l=new Error("Request aborted");return l.name="AbortError",Promise.reject(l)}var d=e.path,p=function(e){var t=[];for(var n of Object.keys(e).sort()){var r=e[n];if(n=ne(n),Array.isArray(r))for(var i=0,o=r.length;i<o;i++)t.push("".concat(n,"=").concat(ne(r[i])));else{var a=n;(r||"string"==typeof r)&&(a+="=".concat(ne(r))),t.push(a)}}return t.join("&")}(e.query||{});p&&(d+="?".concat(p)),e.fragment&&(d+="#".concat(e.fragment));var h="";null==e.username&&null==e.password||(h="".concat(null!==(r=e.username)&&void 0!==r?r:"",":").concat(null!==(i=e.password)&&void 0!==i?i:"","@"));var{port:f,method:g}=e,m="".concat(e.protocol,"//").concat(h).concat(e.hostname).concat(f?":".concat(f):"").concat(d),v="GET"===g||"HEAD"===g?void 0:e.body,y={body:v,headers:new Headers(e.headers),method:g,credentials:u};null!==(o=n.config)&&void 0!==o&&o.cache&&(y.cache=n.config.cache),v&&(y.duplex="half"),"undefined"!=typeof AbortController&&(y.signal=a),ae.supported&&(y.keepalive=c),"function"==typeof n.config.requestInit&&Object.assign(y,n.config.requestInit(e));var b=()=>{},E=ie(m,y),C=[fetch(E).then((e=>{var t=e.headers,n={};for(var r of t.entries())n[r[0]]=r[1];return null!=e.body?{response:new w({headers:n,reason:e.statusText,statusCode:e.status,body:e.body})}:e.blob().then((t=>({response:new w({headers:n,reason:e.statusText,statusCode:e.status,body:t})})))})),oe(s)];return a&&C.push(new Promise(((e,t)=>{var n=()=>{var e=new Error("Request aborted");e.name="AbortError",t(e)};if("function"==typeof a.addEventListener){var r=a;r.addEventListener("abort",n,{once:!0}),b=()=>r.removeEventListener("abort",n)}else a.onabort=n}))),Promise.race(C).finally(b)}))()}updateHttpClientConfig(e,t){this.config=void 0,this.configProvider=this.configProvider.then((n=>(n[e]=t,n)))}httpHandlerConfigs(){var e;return null!==(e=this.config)&&void 0!==e?e:{}}}for(var ce=function(){var e=a((function*(e){var t,n;return"function"==typeof Blob&&e instanceof Blob||"Blob"===(null===(t=e.constructor)||void 0===t?void 0:t.name)?new Uint8Array(yield e.arrayBuffer()):(n=a((function*(e){for(var t=[],n=e.getReader(),r=!1,i=0;!r;){var{done:o,value:a}=yield n.read();a&&(t.push(a),i+=a.length),r=o}var s=new Uint8Array(i),c=0;for(var u of t)s.set(u,c),c+=u.length;return s})),function(e){return n.apply(this,arguments)})(e)}));return function(t){return e.apply(this,arguments)}}(),ue={},le={},de=0;de<256;de++){var pe=de.toString(16).toLowerCase();1===pe.length&&(pe="0".concat(pe)),ue[de]=pe,le[pe]=de}function he(e){for(var t="",n=0;n<e.byteLength;n++)t+=ue[e[n]];return t}"function"==typeof ReadableStream&&ReadableStream;var fe=function(){var e=a((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uint8Array,t=arguments.length>1?arguments[1]:void 0;if(e instanceof Uint8Array)return te.mutate(e);if(!e)return te.mutate(new Uint8Array);var n=t.streamCollector(e);return te.mutate(yield n)}));return function(){return e.apply(this,arguments)}}();function ge(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}function me(e,t){return new ve(e,t)}class ve{constructor(e,t){this.input=e,this.context=t,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}build(){var e=this;return a((function*(){var{hostname:t,protocol:n="https",port:r,path:i}=yield e.context.endpoint();for(var o of(e.path=i,e.resolvePathStack))o(e.path);return new b({protocol:n,hostname:e.hostname||t,port:r,method:e.method,path:e.path,query:e.query,body:e.body,headers:e.headers})}))()}hn(e){return this.hostname=e,this}bp(e){return this.resolvePathStack.push((t=>{this.path="".concat(null!=t&&t.endsWith("/")?t.slice(0,-1):t||"")+e})),this}p(e,t,n,r){return this.resolvePathStack.push((i=>{this.path=((e,t,n,r,i,o)=>{if(null==t||void 0===t[n])throw new Error("No value provided for input HTTP label: "+n+".");var a=r();if(a.length<=0)throw new Error("Empty value provided for input HTTP label: "+n+".");return e.replace(i,o?a.split("/").map((e=>ge(e))).join("/"):ge(a))})(i,this.input,e,t,n,r)})),this}h(e){return this.headers=e,this}q(e){return this.query=e,this}b(e){return this.body=e,this}m(e){return this.method=e,this}}class ye{constructor(e){for(var[t,n]of(this.authSchemes=new Map,Object.entries(e)))void 0!==n&&this.authSchemes.set(t,n)}getIdentityProvider(e){return this.authSchemes.get(e)}}var be=e=>we(e)&&e.expiration.getTime()-Date.now()<3e5,we=e=>void 0!==e.expiration,Ee=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),Ce=e=>Ee.test(e)||e.startsWith("[")&&e.endsWith("]"),Se=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),Te=function e(t){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1]))return Se.test(t);var n=t.split(".");for(var r of n)if(!e(r))return!1;return!0},Ie={},Ae="endpoints";function ke(e){return"object"!=typeof e||null==e?e:"ref"in e?"$".concat(ke(e.ref)):"fn"in e?"".concat(e.fn,"(").concat((e.argv||[]).map(ke).join(", "),")"):JSON.stringify(e,null,2)}class Oe extends Error{constructor(e){super(e),this.name="EndpointError"}}var Me=(e,t)=>(e=>{var t=e.split("."),n=[];for(var r of t){var i=r.indexOf("[");if(-1!==i){if(r.indexOf("]")!==r.length-1)throw new Oe("Path: '".concat(e,"' does not end with ']'"));var o=r.slice(i+1,-1);if(Number.isNaN(parseInt(o)))throw new Oe("Invalid array index: '".concat(o,"' in path: '").concat(e,"'"));0!==i&&n.push(r.slice(0,i)),n.push(o)}else n.push(r)}return n})(t).reduce(((n,r)=>{if("object"!=typeof n)throw new Oe("Index '".concat(r,"' in '").concat(t,"' not found in '").concat(JSON.stringify(e),"'"));return Array.isArray(n)?n[parseInt(r)]:n[r]}),e),Ne={[u.HTTP]:80,[u.HTTPS]:443},Pe={booleanEquals:(e,t)=>e===t,getAttr:Me,isSet:e=>null!=e,isValidHostLabel:Te,not:e=>!e,parseURL:e=>{var t=(()=>{try{if(e instanceof URL)return e;if("object"==typeof e&&"hostname"in e){var{hostname:t,port:n,protocol:r="",path:i="",query:o={}}=e,a=new URL("".concat(r,"//").concat(t).concat(n?":".concat(n):"").concat(i));return a.search=Object.entries(o).map((e=>{var[t,n]=e;return"".concat(t,"=").concat(n)})).join("&"),a}return new URL(e)}catch(e){return null}})();if(!t)return console.error("Unable to parse ".concat(JSON.stringify(e)," as a whatwg URL.")),null;var n=t.href,{host:r,hostname:i,pathname:o,protocol:a,search:s}=t;if(s)return null;var c=a.slice(0,-1);if(!Object.values(u).includes(c))return null;var l=Ce(i);return{scheme:c,authority:"".concat(r).concat(n.includes("".concat(r,":").concat(Ne[c]))||"string"==typeof e&&e.includes("".concat(r,":").concat(Ne[c]))?":".concat(Ne[c]):""),path:o,normalizedPath:o.endsWith("/")?o:"".concat(o,"/"),isIp:l}},stringEquals:(e,t)=>e===t,substring:(e,t,n,r)=>t>=n||e.length<n?null:r?e.substring(e.length-n,e.length-t):e.substring(t,n),uriEncode:e=>encodeURIComponent(e).replace(/[!*'()]/g,(e=>"%".concat(e.charCodeAt(0).toString(16).toUpperCase())))},Re=(e,t)=>{for(var n=[],r=c(c({},t.endpointParams),t.referenceRecord),i=0;i<e.length;){var o=e.indexOf("{",i);if(-1===o){n.push(e.slice(i));break}n.push(e.slice(i,o));var a=e.indexOf("}",o);if(-1===a){n.push(e.slice(o));break}"{"===e[o+1]&&"}"===e[a+1]&&(n.push(e.slice(o+1,a)),i=a+2);var s=e.substring(o+1,a);if(s.includes("#")){var[u,l]=s.split("#");n.push(Me(r[u],l))}else n.push(r[s]);i=a+1}return n.join("")},_e=(e,t,n)=>{if("string"==typeof e)return Re(e,n);if(e.fn)return De(e,n);if(e.ref)return((e,t)=>{var{ref:n}=e;return c(c({},t.endpointParams),t.referenceRecord)[n]})(e,n);throw new Oe("'".concat(t,"': ").concat(String(e)," is not a string, function or reference."))},De=(e,t)=>{var{fn:n,argv:r}=e,i=r.map((e=>["boolean","number"].includes(typeof e)?e:_e(e,"arg",t))),o=n.split(".");return o[0]in Ie&&null!=o[1]?Ie[o[0]][o[1]](...i):Pe[n](...i)},xe=(e,t)=>{var r,o,{assign:a}=e,s=i(e,n);if(a&&a in t.referenceRecord)throw new Oe("'".concat(a,"' is already defined in Reference Record."));var u=De(s,t);return null!==(r=t.logger)&&void 0!==r&&null!==(o=r.debug)&&void 0!==o&&o.call(r,"".concat(Ae," evaluateCondition: ").concat(ke(s)," = ").concat(ke(u))),c({result:""===u||!!u},null!=a&&{toAssign:{name:a,value:u}})},Le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n={};for(var r of e){var i,o,a,{result:s,toAssign:u}=xe(r,c(c({},t),{},{referenceRecord:c(c({},t.referenceRecord),n)}));if(!s)return{result:s};u&&(n[u.name]=u.value,null===(i=t.logger)||void 0===i||null===(o=(a=i).debug)||void 0===o||o.call(a,"".concat(Ae," assign: ").concat(u.name," := ").concat(ke(u.value))))}return{result:!0,referenceRecord:n}},Ue=(e,t)=>Object.entries(e).reduce(((e,n)=>{var[r,i]=n;return c(c({},e),{},{[r]:i.map((e=>{var n=_e(e,"Header value entry",t);if("string"!=typeof n)throw new Oe("Header '".concat(r,"' value '").concat(n,"' is not a string"));return n}))})}),{}),Fe=(e,t)=>{if(Array.isArray(e))return e.map((e=>Fe(e,t)));switch(typeof e){case"string":return Re(e,t);case"object":if(null===e)throw new Oe("Unexpected endpoint property: ".concat(e));return je(e,t);case"boolean":return e;default:throw new Oe("Unexpected endpoint property type: "+typeof e)}},je=(e,t)=>Object.entries(e).reduce(((e,n)=>{var[r,i]=n;return c(c({},e),{},{[r]:Fe(i,t)})}),{}),We=(e,t)=>{var n=_e(e,"Endpoint URL",t);if("string"==typeof n)try{return new URL(n)}catch(e){throw console.error("Failed to construct URL with ".concat(n),e),e}throw new Oe("Endpoint URL must be a string, got "+typeof n)},He=(e,t)=>{var n,r,{conditions:i,endpoint:o}=e,{result:a,referenceRecord:s}=Le(i,t);if(a){var u=c(c({},t),{},{referenceRecord:c(c({},t.referenceRecord),s)}),{url:l,properties:d,headers:p}=o;return null!==(n=t.logger)&&void 0!==n&&null!==(r=n.debug)&&void 0!==r&&r.call(n,"".concat(Ae," Resolving endpoint from template: ").concat(ke(o))),c(c(c({},null!=p&&{headers:Ue(p,u)}),null!=d&&{properties:je(d,u)}),{},{url:We(l,u)})}},Be=(e,t)=>{var{conditions:n,error:r}=e,{result:i,referenceRecord:o}=Le(n,t);if(i)throw new Oe(_e(r,"Error",c(c({},t),{},{referenceRecord:c(c({},t.referenceRecord),o)})))},ze=(e,t)=>{var{conditions:n,rules:r}=e,{result:i,referenceRecord:o}=Le(n,t);if(i)return Ge(r,c(c({},t),{},{referenceRecord:c(c({},t.referenceRecord),o)}))},Ge=(e,t)=>{for(var n of e)if("endpoint"===n.type){var r=He(n,t);if(r)return r}else if("error"===n.type)Be(n,t);else{if("tree"!==n.type)throw new Oe("Unknown endpoint rule: ".concat(n));var i=ze(n,t);if(i)return i}throw new Oe("Rules evaluation failed")},qe=JSON.parse('{"partitions":[{"id":"aws","outputs":{"dnsSuffix":"amazonaws.com","dualStackDnsSuffix":"api.aws","implicitGlobalRegion":"us-east-1","name":"aws","supportsDualStack":true,"supportsFIPS":true},"regionRegex":"^(us|eu|ap|sa|ca|me|af|il|mx)\\\\-\\\\w+\\\\-\\\\d+$","regions":{"af-south-1":{"description":"Africa (Cape Town)"},"ap-east-1":{"description":"Asia Pacific (Hong Kong)"},"ap-northeast-1":{"description":"Asia Pacific (Tokyo)"},"ap-northeast-2":{"description":"Asia Pacific (Seoul)"},"ap-northeast-3":{"description":"Asia Pacific (Osaka)"},"ap-south-1":{"description":"Asia Pacific (Mumbai)"},"ap-south-2":{"description":"Asia Pacific (Hyderabad)"},"ap-southeast-1":{"description":"Asia Pacific (Singapore)"},"ap-southeast-2":{"description":"Asia Pacific (Sydney)"},"ap-southeast-3":{"description":"Asia Pacific (Jakarta)"},"ap-southeast-4":{"description":"Asia Pacific (Melbourne)"},"ap-southeast-5":{"description":"Asia Pacific (Malaysia)"},"aws-global":{"description":"AWS Standard global region"},"ca-central-1":{"description":"Canada (Central)"},"ca-west-1":{"description":"Canada West (Calgary)"},"eu-central-1":{"description":"Europe (Frankfurt)"},"eu-central-2":{"description":"Europe (Zurich)"},"eu-north-1":{"description":"Europe (Stockholm)"},"eu-south-1":{"description":"Europe (Milan)"},"eu-south-2":{"description":"Europe (Spain)"},"eu-west-1":{"description":"Europe (Ireland)"},"eu-west-2":{"description":"Europe (London)"},"eu-west-3":{"description":"Europe (Paris)"},"il-central-1":{"description":"Israel (Tel Aviv)"},"me-central-1":{"description":"Middle East (UAE)"},"me-south-1":{"description":"Middle East (Bahrain)"},"sa-east-1":{"description":"South America (Sao Paulo)"},"us-east-1":{"description":"US East (N. Virginia)"},"us-east-2":{"description":"US East (Ohio)"},"us-west-1":{"description":"US West (N. California)"},"us-west-2":{"description":"US West (Oregon)"}}},{"id":"aws-cn","outputs":{"dnsSuffix":"amazonaws.com.cn","dualStackDnsSuffix":"api.amazonwebservices.com.cn","implicitGlobalRegion":"cn-northwest-1","name":"aws-cn","supportsDualStack":true,"supportsFIPS":true},"regionRegex":"^cn\\\\-\\\\w+\\\\-\\\\d+$","regions":{"aws-cn-global":{"description":"AWS China global region"},"cn-north-1":{"description":"China (Beijing)"},"cn-northwest-1":{"description":"China (Ningxia)"}}},{"id":"aws-us-gov","outputs":{"dnsSuffix":"amazonaws.com","dualStackDnsSuffix":"api.aws","implicitGlobalRegion":"us-gov-west-1","name":"aws-us-gov","supportsDualStack":true,"supportsFIPS":true},"regionRegex":"^us\\\\-gov\\\\-\\\\w+\\\\-\\\\d+$","regions":{"aws-us-gov-global":{"description":"AWS GovCloud (US) global region"},"us-gov-east-1":{"description":"AWS GovCloud (US-East)"},"us-gov-west-1":{"description":"AWS GovCloud (US-West)"}}},{"id":"aws-iso","outputs":{"dnsSuffix":"c2s.ic.gov","dualStackDnsSuffix":"c2s.ic.gov","implicitGlobalRegion":"us-iso-east-1","name":"aws-iso","supportsDualStack":false,"supportsFIPS":true},"regionRegex":"^us\\\\-iso\\\\-\\\\w+\\\\-\\\\d+$","regions":{"aws-iso-global":{"description":"AWS ISO (US) global region"},"us-iso-east-1":{"description":"US ISO East"},"us-iso-west-1":{"description":"US ISO WEST"}}},{"id":"aws-iso-b","outputs":{"dnsSuffix":"sc2s.sgov.gov","dualStackDnsSuffix":"sc2s.sgov.gov","implicitGlobalRegion":"us-isob-east-1","name":"aws-iso-b","supportsDualStack":false,"supportsFIPS":true},"regionRegex":"^us\\\\-isob\\\\-\\\\w+\\\\-\\\\d+$","regions":{"aws-iso-b-global":{"description":"AWS ISOB (US) global region"},"us-isob-east-1":{"description":"US ISOB East (Ohio)"}}},{"id":"aws-iso-e","outputs":{"dnsSuffix":"cloud.adc-e.uk","dualStackDnsSuffix":"cloud.adc-e.uk","implicitGlobalRegion":"eu-isoe-west-1","name":"aws-iso-e","supportsDualStack":false,"supportsFIPS":true},"regionRegex":"^eu\\\\-isoe\\\\-\\\\w+\\\\-\\\\d+$","regions":{"eu-isoe-west-1":{"description":"EU ISOE West"}}},{"id":"aws-iso-f","outputs":{"dnsSuffix":"csp.hci.ic.gov","dualStackDnsSuffix":"csp.hci.ic.gov","implicitGlobalRegion":"us-isof-south-1","name":"aws-iso-f","supportsDualStack":false,"supportsFIPS":true},"regionRegex":"^us\\\\-isof\\\\-\\\\w+\\\\-\\\\d+$","regions":{}}],"version":"1.1"}'),Ve={isVirtualHostableS3Bucket:function e(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){for(var n of t.split("."))if(!e(n))return!1;return!0}return!(!Te(t)||t.length<3||t.length>63||t!==t.toLowerCase()||Ce(t))},parseArn:e=>{var t=e.split(":");if(t.length<6)return null;var[n,r,i,o,a,...s]=t;return"arn"!==n||""===r||""===i||""===s.join(":")?null:{partition:r,service:i,region:o,accountId:a,resourceId:s.map((e=>e.split("/"))).flat()}},partition:e=>{var{partitions:t}=qe;for(var n of t){var{regions:r,outputs:i}=n;for(var[o,a]of Object.entries(r))if(o===e)return c(c({},i),a)}for(var s of t){var{regionRegex:u,outputs:l}=s;if(new RegExp(u).test(e))return c({},l)}var d=t.find((e=>"aws"===e.id));if(!d)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return c({},d.outputs)}};function $e(e,t,n){e.__aws_sdk_context?e.__aws_sdk_context.features||(e.__aws_sdk_context.features={}):e.__aws_sdk_context={features:{}},e.__aws_sdk_context.features[t]=n}Ie.aws=Ve;var Je,Ke=/\d{12}\.ddb/,Ye="user-agent",Xe="x-amz-user-agent",Qe=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,Ze=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g,et=e=>{var t,n=e[0].split("/").map((e=>e.replace(Qe,"-"))).join("/"),r=null===(t=e[1])||void 0===t?void 0:t.replace(Ze,"-"),i=n.indexOf("/"),o=n.substring(0,i),a=n.substring(i+1);return"api"===o&&(a=a.toLowerCase()),[o,a,r].filter((e=>e&&e.length>0)).reduce(((e,t,n)=>{switch(n){case 0:return t;case 1:return"".concat(e,"/").concat(t);default:return"".concat(e,"#").concat(t)}}),"")},tt={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0};!function(e){e.ENV="env",e.CONFIG="shared config entry"}(Je||(Je={}));var nt,rt=e=>"string"==typeof e&&(e.startsWith("fips-")||e.endsWith("-fips")),it=e=>rt(e)?["fips-aws-global","aws-fips"].includes(e)?"us-east-1":e.replace(/fips-(dkr-|prod-)?|-fips/,""):e,ot="content-length",at={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},st=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,ct=/(\d+\.){3}\d+/,ut=/\.\./,lt=(e,t,n)=>{var r=function(){var r=a((function*(){var r,i=null!==(r=n[e])&&void 0!==r?r:n[t];return"function"==typeof i?i():i}));return function(){return r.apply(this,arguments)}}();return"credentialScope"===e||"CredentialScope"===t?a((function*(){var e,t="function"==typeof n.credentials?yield n.credentials():n.credentials;return null!==(e=null==t?void 0:t.credentialScope)&&void 0!==e?e:null==t?void 0:t.CredentialScope})):"accountId"===e||"AccountId"===t?a((function*(){var e,t="function"==typeof n.credentials?yield n.credentials():n.credentials;return null!==(e=null==t?void 0:t.accountId)&&void 0!==e?e:null==t?void 0:t.AccountId})):"endpoint"===e||"endpoint"===t?a((function*(){var e=yield r();if(e&&"object"==typeof e){if("url"in e)return e.url.href;if("hostname"in e){var{protocol:t,hostname:n,port:i,path:o}=e;return"".concat(t,"//").concat(n).concat(i?":"+i:"").concat(o)}}return e})):r},dt=function(){var e=a((function*(e){}));return function(t){return e.apply(this,arguments)}}(),pt=e=>{if("string"==typeof e)return pt(new URL(e));var t,{hostname:n,pathname:r,port:i,protocol:o,search:a}=e;return a&&(t=function(e){var t={};if(e=e.replace(/^\?/,""))for(var n of e.split("&")){var[r,i=null]=n.split("=");r=decodeURIComponent(r),i&&(i=decodeURIComponent(i)),r in t?Array.isArray(t[r])?t[r].push(i):t[r]=[t[r],i]:t[r]=i}return t}(a)),{hostname:n,port:i?parseInt(i):void 0,protocol:o,path:r,query:t}},ht=e=>"object"==typeof e?"url"in e?pt(e.url):e:pt(e),ft=function(){var e=a((function*(e,t,n){var r,i,o={},s=(null==t||null===(r=t.getEndpointParameterInstructions)||void 0===r?void 0:r.call(t))||{};for(var[c,u]of Object.entries(s))switch(u.type){case"staticContextParams":o[c]=u.value;break;case"contextParams":o[c]=e[u.name];break;case"clientContextParams":case"builtInParams":o[c]=yield lt(u.name,c,n)();break;case"operationContextParams":o[c]=u.get(e);break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(u))}return 0===Object.keys(s).length&&Object.assign(o,n),"s3"===String(n.serviceId).toLowerCase()&&(yield(i=a((function*(e){var t,n=(null==e?void 0:e.Bucket)||"";if("string"==typeof e.Bucket&&(e.Bucket=n.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),(e=>{var[t,n,r,,,i]=e.split(":"),o="arn"===t&&e.split(":").length>=6,a=Boolean(o&&n&&r&&i);if(o&&!a)throw new Error("Invalid ARN: ".concat(e," was an invalid ARN."));return a})(n)){if(!0===e.ForcePathStyle)throw new Error("Path-style addressing cannot be used with ARN buckets")}else t=n,(!st.test(t)||ct.test(t)||ut.test(t)||-1!==n.indexOf(".")&&!String(e.Endpoint).startsWith("http:")||n.toLowerCase()!==n||n.length<3)&&(e.ForcePathStyle=!0);return e.DisableMultiRegionAccessPoints&&(e.disableMultiRegionAccessPoints=!0,e.DisableMRAP=!0),e})),function(e){return i.apply(this,arguments)})(o)),o}));return function(t,n,r){return e.apply(this,arguments)}}(),gt={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:M.name},mt=(e,t)=>({applyToStack:n=>{n.addRelativeTo((e=>{var{config:t,instructions:n}=e;return(e,r)=>function(){var i=a((function*(i){var o,s;t.endpoint&&function(e){e.__smithy_context?e.__smithy_context.features||(e.__smithy_context.features={}):e.__smithy_context={features:{}},e.__smithy_context.features.ENDPOINT_OVERRIDE="N"}(r);var u,l=yield(u=a((function*(e,t,n,r){var i;n.endpoint||(i=n.serviceConfiguredEndpoint?yield n.serviceConfiguredEndpoint():yield dt(n.serviceId))&&(n.endpoint=()=>Promise.resolve(ht(i)));var o=yield ft(e,t,n);if("function"!=typeof n.endpointProvider)throw new Error("config.endpointProvider is not set.");return n.endpointProvider(o,r)})),function(e,t,n,r){return u.apply(this,arguments)})(i.input,{getEndpointParameterInstructions:()=>n},c({},t),r);r.endpointV2=l,r.authSchemes=null===(o=l.properties)||void 0===o?void 0:o.authSchemes;var d=null===(s=r.authSchemes)||void 0===s?void 0:s[0];if(d){var p;r.signing_region=d.signingRegion,r.signing_service=d.signingName;var h=I(r),f=null==h||null===(p=h.selectedHttpAuthScheme)||void 0===p?void 0:p.httpAuthOption;f&&(f.signingProperties=Object.assign(f.signingProperties||{},{signing_region:d.signingRegion,signingRegion:d.signingRegion,signing_service:d.signingName,signingName:d.signingName,signingRegionSet:d.signingRegionSet},d.properties))}return e(c({},i))}));return function(e){return i.apply(this,arguments)}}()})({config:e,instructions:t}),gt)}});!function(e){e.STANDARD="standard",e.ADAPTIVE="adaptive"}(nt||(nt={}));var vt=nt.STANDARD,yt=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],bt=["TimeoutError","RequestTimeout","RequestTimeoutException"],wt=[500,502,503,504],Et=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],Ct=e=>{var t,n;return 429===(null===(t=e.$metadata)||void 0===t?void 0:t.httpStatusCode)||yt.includes(e.name)||1==(null===(n=e.$retryable)||void 0===n?void 0:n.throttling)},St=function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return((e,t)=>null===(t=e.$metadata)||void 0===t?void 0:t.clockSkewCorrected)(t)||bt.includes(t.name)||Et.includes((null==t?void 0:t.code)||"")||wt.includes((null===(n=t.$metadata)||void 0===n?void 0:n.httpStatusCode)||0)||void 0!==t.cause&&r<=10&&e(t.cause,r+1)};class Tt{constructor(e){var t,n,r,i,o;this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=null!==(t=null==e?void 0:e.beta)&&void 0!==t?t:.7,this.minCapacity=null!==(n=null==e?void 0:e.minCapacity)&&void 0!==n?n:1,this.minFillRate=null!==(r=null==e?void 0:e.minFillRate)&&void 0!==r?r:.5,this.scaleConstant=null!==(i=null==e?void 0:e.scaleConstant)&&void 0!==i?i:.4,this.smooth=null!==(o=null==e?void 0:e.smooth)&&void 0!==o?o:.8;var a=this.getCurrentTimeInSeconds();this.lastThrottleTime=a,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}getSendToken(){var e=this;return a((function*(){return e.acquireTokenBucket(1)}))()}acquireTokenBucket(e){var t=this;return a((function*(){if(t.enabled){if(t.refillTokenBucket(),e>t.currentCapacity){var n=(e-t.currentCapacity)/t.fillRate*1e3;yield new Promise((e=>Tt.setTimeoutFn(e,n)))}t.currentCapacity=t.currentCapacity-e}}))()}refillTokenBucket(){var e=this.getCurrentTimeInSeconds();if(this.lastTimestamp){var t=(e-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+t),this.lastTimestamp=e}else this.lastTimestamp=e}updateClientSendingRate(e){var t;if(this.updateMeasuredRate(),Ct(e)){var n=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=n,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),t=this.cubicThrottle(n),this.enableTokenBucket()}else this.calculateTimeWindow(),t=this.cubicSuccess(this.getCurrentTimeInSeconds());var r=Math.min(t,2*this.measuredTxRate);this.updateTokenBucketRate(r)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(e){return this.getPrecise(e*this.beta)}cubicSuccess(e){return this.getPrecise(this.scaleConstant*Math.pow(e-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(e){this.refillTokenBucket(),this.fillRate=Math.max(e,this.minFillRate),this.maxCapacity=Math.max(e,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){var e=this.getCurrentTimeInSeconds(),t=Math.floor(2*e)/2;if(this.requestCount++,t>this.lastTxRateBucket){var n=this.requestCount/(t-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(n*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=t}}getPrecise(e){return parseFloat(e.toFixed(8))}}Tt.setTimeoutFn=setTimeout;var It="amz-sdk-invocation-id",At="amz-sdk-request",kt=e=>{var{retryDelay:t,retryCount:n,retryCost:r}=e;return{getRetryCount:()=>n,getRetryDelay:()=>Math.min(2e4,t),getRetryCost:()=>r}};class Ot{constructor(e){this.maxAttempts=e,this.mode=nt.STANDARD,this.capacity=500,this.retryBackoffStrategy=(()=>{var e=100;return{computeNextBackoffDelay:t=>Math.floor(Math.min(2e4,Math.random()*2**t*e)),setDelayBase:t=>{e=t}}})(),this.maxAttemptsProvider="function"==typeof e?e:a((function*(){return e}))}acquireInitialRetryToken(e){return a((function*(){return kt({retryDelay:100,retryCount:0})}))()}refreshRetryTokenForRetry(e,t){var n=this;return a((function*(){var r=yield n.getMaxAttempts();if(n.shouldRetry(e,t,r)){var i=t.errorType;n.retryBackoffStrategy.setDelayBase("THROTTLING"===i?500:100);var o=n.retryBackoffStrategy.computeNextBackoffDelay(e.getRetryCount()),a=t.retryAfterHint?Math.max(t.retryAfterHint.getTime()-Date.now()||0,o):o,s=n.getCapacityCost(i);return n.capacity-=s,kt({retryDelay:a,retryCount:e.getRetryCount()+1,retryCost:s})}throw new Error("No retry token available")}))()}recordSuccess(e){var t;this.capacity=Math.max(500,this.capacity+(null!==(t=e.getRetryCost())&&void 0!==t?t:1))}getCapacity(){return this.capacity}getMaxAttempts(){var e=this;return a((function*(){try{return yield e.maxAttemptsProvider()}catch(e){return console.warn("Max attempts provider could not resolve. Using default of 3"),3}}))()}shouldRetry(e,t,n){return e.getRetryCount()+1<n&&this.capacity>=this.getCapacityCost(t.errorType)&&this.isRetryableError(t.errorType)}getCapacityCost(e){return"TRANSIENT"===e?10:5}isRetryableError(e){return"THROTTLING"===e||"TRANSIENT"===e}}class Mt{constructor(e,t){this.maxAttemptsProvider=e,this.mode=nt.ADAPTIVE;var{rateLimiter:n}=null!=t?t:{};this.rateLimiter=null!=n?n:new Tt,this.standardRetryStrategy=new Ot(e)}acquireInitialRetryToken(e){var t=this;return a((function*(){return yield t.rateLimiter.getSendToken(),t.standardRetryStrategy.acquireInitialRetryToken(e)}))()}refreshRetryTokenForRetry(e,t){var n=this;return a((function*(){return n.rateLimiter.updateClientSendingRate(t),n.standardRetryStrategy.refreshRetryTokenForRetry(e,t)}))()}recordSuccess(e){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(e)}}var Nt,Pt={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},Rt=new Uint8Array(16);function _t(){if(!Nt&&!(Nt="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Nt(Rt)}for(var Dt=[],xt=0;xt<256;++xt)Dt.push((xt+256).toString(16).slice(1));var Lt=function(e,t,n){if(Pt.randomUUID&&!t&&!e)return Pt.randomUUID();var r=(e=e||{}).random||(e.rng||_t)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Dt[e[t+0]]+Dt[e[t+1]]+Dt[e[t+2]]+Dt[e[t+3]]+"-"+Dt[e[t+4]]+Dt[e[t+5]]+"-"+Dt[e[t+6]]+Dt[e[t+7]]+"-"+Dt[e[t+8]]+Dt[e[t+9]]+"-"+Dt[e[t+10]]+Dt[e[t+11]]+Dt[e[t+12]]+Dt[e[t+13]]+Dt[e[t+14]]+Dt[e[t+15]]}(r)},Ut={name:"omitRetryHeadersMiddleware",tags:["RETRY","HEADERS","OMIT_RETRY_HEADERS"],relation:"before",toMiddleware:"awsAuthMiddleware",override:!0},Ft=(e,t)=>{var n=[];if(e&&n.push(e),t)for(var r of t)n.push(r);return n},jt=(e,t)=>"".concat(e||"anonymous").concat(t&&t.length>0?" (a.k.a. ".concat(t.join(","),")"):""),Wt=()=>{var e=[],t=[],n=!1,r=new Set,i=n=>{var r;return e.forEach((e=>{n.add(e.middleware,c({},e))})),t.forEach((e=>{n.addRelativeTo(e.middleware,c({},e))})),null!==(r=n.identifyOnResolve)&&void 0!==r&&r.call(n,s.identifyOnResolve()),n},o=e=>{var t=[];return e.before.forEach((e=>{0===e.before.length&&0===e.after.length?t.push(e):t.push(...o(e))})),t.push(e),e.after.reverse().forEach((e=>{0===e.before.length&&0===e.after.length?t.push(e):t.push(...o(e))})),t},a=function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=[],i=[],a={};e.forEach((e=>{var t=c(c({},e),{},{before:[],after:[]});for(var n of Ft(t.name,t.aliases))a[n]=t;r.push(t)})),t.forEach((e=>{var t=c(c({},e),{},{before:[],after:[]});for(var n of Ft(t.name,t.aliases))a[n]=t;i.push(t)})),i.forEach((e=>{if(e.toMiddleware){var t=a[e.toMiddleware];if(void 0===t){if(n)return;throw new Error("".concat(e.toMiddleware," is not found when adding ").concat(jt(e.name,e.aliases)," middleware ").concat(e.relation," ").concat(e.toMiddleware))}"after"===e.relation&&t.after.push(e),"before"===e.relation&&t.before.push(e)}}));var s,u=(s=r,s.sort(((e,t)=>Ht[t.step]-Ht[e.step]||Bt[t.priority||"normal"]-Bt[e.priority||"normal"]))).map(o).reduce(((e,t)=>(e.push(...t),e)),[]);return u},s={add:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{name:i,override:o,aliases:a}=n,s=c({step:"initialize",priority:"normal",middleware:t},n),u=Ft(i,a);if(u.length>0){if(u.some((e=>r.has(e)))){if(!o)throw new Error("Duplicate middleware name '".concat(jt(i,a),"'"));var l=function(t){var n=e.findIndex((e=>{var n;return e.name===t||(null===(n=e.aliases)||void 0===n?void 0:n.some((e=>e===t)))}));if(-1===n)return 1;var r=e[n];if(r.step!==s.step||s.priority!==r.priority)throw new Error('"'.concat(jt(r.name,r.aliases),'" middleware with ').concat(r.priority," priority in ").concat(r.step,' step cannot be overridden by "').concat(jt(i,a),'" middleware with ').concat(s.priority," priority in ").concat(s.step," step."));e.splice(n,1)};for(var d of u)l(d)}for(var p of u)r.add(p)}e.push(s)},addRelativeTo:(e,n)=>{var{name:i,override:o,aliases:a}=n,s=c({middleware:e},n),u=Ft(i,a);if(u.length>0){if(u.some((e=>r.has(e)))){if(!o)throw new Error("Duplicate middleware name '".concat(jt(i,a),"'"));var l=function(e){var n=t.findIndex((t=>{var n;return t.name===e||(null===(n=t.aliases)||void 0===n?void 0:n.some((t=>t===e)))}));if(-1===n)return 1;var r=t[n];if(r.toMiddleware!==s.toMiddleware||r.relation!==s.relation)throw new Error('"'.concat(jt(r.name,r.aliases),'" middleware ').concat(r.relation,' "').concat(r.toMiddleware,'" middleware cannot be overridden by "').concat(jt(i,a),'" middleware ').concat(s.relation,' "').concat(s.toMiddleware,'" middleware.'));t.splice(n,1)};for(var d of u)l(d)}for(var p of u)r.add(p)}t.push(s)},clone:()=>i(Wt()),use:e=>{e.applyToStack(s)},remove:n=>"string"==typeof n?(n=>{var i=!1,o=e=>{var t=Ft(e.name,e.aliases);if(t.includes(n)){for(var o of(i=!0,t))r.delete(o);return!1}return!0};return e=e.filter(o),t=t.filter(o),i})(n):(n=>{var i=!1,o=e=>{if(e.middleware===n){for(var t of(i=!0,Ft(e.name,e.aliases)))r.delete(t);return!1}return!0};return e=e.filter(o),t=t.filter(o),i})(n),removeByTag:n=>{var i=!1,o=e=>{var{tags:t,name:o,aliases:a}=e;if(t&&t.includes(n)){var s=Ft(o,a);for(var c of s)r.delete(c);return i=!0,!1}return!0};return e=e.filter(o),t=t.filter(o),i},concat:e=>{var t,r,o=i(Wt());return o.use(e),o.identifyOnResolve(n||o.identifyOnResolve()||null!==(t=null===(r=e.identifyOnResolve)||void 0===r?void 0:r.call(e))&&void 0!==t&&t),o},applyToStack:i,identify:()=>a(!0).map((e=>{var t,n=null!==(t=e.step)&&void 0!==t?t:e.relation+" "+e.toMiddleware;return jt(e.name,e.aliases)+" - "+n})),identifyOnResolve:e=>("boolean"==typeof e&&(n=e),n),resolve:(e,t)=>{for(var r of a().map((e=>e.middleware)).reverse())e=r(e,t);return n&&console.log(s.identify()),e}};return s},Ht={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},Bt={high:3,normal:2,low:1};class zt{constructor(e){this.config=e,this.middlewareStack=Wt()}send(e,t,n){var r,i="function"!=typeof t?t:void 0,o="function"==typeof t?t:n;if(void 0===i&&!0===this.config.cacheMiddleware){this.handlers||(this.handlers=new WeakMap);var a=this.handlers;a.has(e.constructor)?r=a.get(e.constructor):(r=e.resolveMiddleware(this.middlewareStack,this.config,i),a.set(e.constructor,r))}else delete this.handlers,r=e.resolveMiddleware(this.middlewareStack,this.config,i);if(!o)return r(e).then((e=>e.output));r(e).then((e=>o(null,e.output)),(e=>o(e))).catch((()=>{}))}destroy(){var e,t;null!==(e=this.config)&&void 0!==e&&null!==(e=e.requestHandler)&&void 0!==e&&null!==(t=e.destroy)&&void 0!==t&&t.call(e),delete this.handlers}}class Gt{constructor(){this.middlewareStack=Wt()}static classBuilder(){return new qt}resolveMiddlewareWithContext(e,t,n,r){var{middlewareFn:i,clientName:o,commandName:a,inputFilterSensitiveLog:s,outputFilterSensitiveLog:u,smithyContext:l,additionalContext:d,CommandCtor:p}=r;for(var h of i.bind(this)(p,e,t,n))this.middlewareStack.use(h);var f=e.concat(this.middlewareStack),{logger:g}=t,m=c({logger:g,clientName:o,commandName:a,inputFilterSensitiveLog:s,outputFilterSensitiveLog:u,[y]:c({commandInstance:this},l)},d),{requestHandler:v}=t;return f.resolve((e=>v.handle(e.request,n||{})),m)}}class qt{constructor(){this._init=()=>{},this._ep={},this._middlewareFn=()=>[],this._commandName="",this._clientName="",this._additionalContext={},this._smithyContext={},this._inputFilterSensitiveLog=e=>e,this._outputFilterSensitiveLog=e=>e,this._serializer=null,this._deserializer=null}init(e){this._init=e}ep(e){return this._ep=e,this}m(e){return this._middlewareFn=e,this}s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._smithyContext=c({service:e,operation:t},n),this}c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._additionalContext=e,this}n(e,t){return this._clientName=e,this._commandName=t,this}f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e;return this._inputFilterSensitiveLog=e,this._outputFilterSensitiveLog=t,this}ser(e){return this._serializer=e,this}de(e){return this._deserializer=e,this}build(){var e,t=this;return e=class extends Gt{static getEndpointParameterInstructions(){return t._ep}constructor(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var[i]=n;super(),this.serialize=t._serializer,this.deserialize=t._deserializer,this.input=null!=i?i:{},t._init(this)}resolveMiddleware(n,r,i){return this.resolveMiddlewareWithContext(n,r,i,{CommandCtor:e,middlewareFn:t._middlewareFn,clientName:t._clientName,commandName:t._commandName,inputFilterSensitiveLog:t._inputFilterSensitiveLog,outputFilterSensitiveLog:t._outputFilterSensitiveLog,smithyContext:t._smithyContext,additionalContext:t._additionalContext})}}}}var Vt="***SensitiveInformation***",$t=(Math.ceil(2**127*(2-2**-23)),e=>{if(null!=e){if(Number.isInteger(e)&&!Number.isNaN(e))return e;throw new TypeError("Expected integer, got ".concat(typeof e,": ").concat(e))}}),Jt=(e,t)=>{if(null==e){if(t)throw new TypeError("Expected a non-null value for ".concat(t));throw new TypeError("Expected a non-null value")}return e},Kt=e=>{if(null!=e){if("object"==typeof e&&!Array.isArray(e))return e;var t=Array.isArray(e)?"array":typeof e;throw new TypeError("Expected object, got ".concat(t,": ").concat(e))}},Yt=e=>{if(null!=e){if("string"==typeof e)return e;if(["boolean","number","bigint"].includes(typeof e))return Qt.warn(Xt("Expected string, got ".concat(typeof e,": ").concat(e))),String(e);throw new TypeError("Expected string, got ".concat(typeof e,": ").concat(e))}},Xt=e=>String(new TypeError(e).stack||e).split("\n").slice(0,5).filter((e=>!e.includes("stackTraceWarning"))).join("\n"),Qt={warn:console.warn};class Zt extends Error{constructor(e){super(e.message),Object.setPrototypeOf(this,Zt.prototype),this.name=e.name,this.$fault=e.$fault,this.$metadata=e.$metadata}}var en=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.entries(t).filter((e=>{var[,t]=e;return void 0!==t})).forEach((t=>{var[n,r]=t;null!=e[n]&&""!==e[n]||(e[n]=r)}));var n=e.message||e.Message||"UnknownError";return e.message=n,delete e.Message,e},tn=e=>{switch(e){case"standard":case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}},nn=e=>{var t=[],n=function(){var n=p[r];void 0!==e[n]&&t.push({algorithmId:()=>n,checksumConstructor:()=>e[n]})};for(var r in p)n();return{_checksumAlgorithms:t,addChecksumAlgorithm(e){this._checksumAlgorithms.push(e)},checksumAlgorithms(){return this._checksumAlgorithms}}},rn=e=>null!=e,on=function(e){return Object.assign(new String(e),{deserializeJSON:()=>JSON.parse(String(e)),toString:()=>String(e),toJSON:()=>String(e)})};on.from=e=>e&&"object"==typeof e&&(e instanceof on||"deserializeJSON"in e)?e:"string"==typeof e||Object.getPrototypeOf(e)===String.prototype?on(String(e)):on(JSON.stringify(e)),on.fromObject=on.from;class an{trace(){}debug(){}info(){}warn(){}error(){}}function sn(e,t,n){var r,i;if(void 0===t&&void 0===n)r={},i=e;else{if(r=e,"function"==typeof t)return ln(r,t,i=n);i=t}for(var o of Object.keys(i))Array.isArray(i[o])?dn(r,null,i,o):r[o]=i[o];return r}var cn,un=(e,t)=>{var n={};for(var r in t)dn(n,e,t,r);return n},ln=(e,t,n)=>sn(e,Object.entries(n).reduce(((e,n)=>{var[r,i]=n;return Array.isArray(i)?e[r]=i:e[r]="function"==typeof i?[t,i()]:[t,i],e}),{})),dn=(e,t,n,r)=>{if(null===t){var[i,o]=n[r];if("function"==typeof o){var a,s=void 0===i&&null!=(a=o()),c="function"==typeof i&&!!i(void 0)||"function"!=typeof i&&!!i;s?e[r]=a:c&&(e[r]=o())}else{var u=void 0===i&&null!=o,l="function"==typeof i&&!!i(o)||"function"!=typeof i&&!!i;(u||l)&&(e[r]=o)}}else{var d=n[r];"function"==typeof d&&(d=[,d]);var[p=pn,h=hn,f=r]=d;("function"==typeof p&&p(t[f])||"function"!=typeof p&&p)&&(e[r]=h(t[f]))}},pn=e=>null!=e,hn=e=>e,fn=e=>{if(null==e)return{};if(Array.isArray(e))return e.filter((e=>null!=e)).map(fn);if("object"==typeof e){var t={};for(var n of Object.keys(e))null!=e[n]&&(t[n]=fn(e[n]));return t}return e},gn=e=>(null==e?void 0:e.body)instanceof ReadableStream,mn=e=>{var t={error:e,errorType:vn(e)},n=bn(e.$response);return n&&(t.retryAfterHint=n),t},vn=e=>Ct(e)?"THROTTLING":St(e)?"TRANSIENT":((e,t)=>{if(void 0!==(null===(t=e.$metadata)||void 0===t?void 0:t.httpStatusCode)){var n=e.$metadata.httpStatusCode;return 500<=n&&n<=599&&!St(e)}return!1})(e)?"SERVER_ERROR":"CLIENT_ERROR",yn={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},bn=e=>{if(w.isInstance(e)){var t=Object.keys(e.headers).find((e=>"retry-after"===e.toLowerCase()));if(t){var n=e.headers[t],r=Number(n);return Number.isNaN(r)?new Date(n):new Date(1e3*r)}}},wn=e=>"string"==typeof e?Q(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e),En="X-Amz-Date",Cn="X-Amz-Signature",Sn="X-Amz-Security-Token",Tn="authorization",In=En.toLowerCase(),An=[Tn,In,"date"],kn=Cn.toLowerCase(),On="x-amz-content-sha256",Mn=Sn.toLowerCase(),Nn={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},Pn=/^proxy-/,Rn=/^sec-/,_n="AWS4-HMAC-SHA256",Dn="AWS4-HMAC-SHA256-PAYLOAD",xn="aws4_request",Ln={},Un=[],Fn=(e,t,n)=>"".concat(e,"/").concat(t,"/").concat(n,"/").concat(xn),jn=(e,t,n)=>{var r=new e(t);return r.update(wn(n)),r.digest()},Wn=(e,t,n)=>{var{headers:r}=e,i={};for(var o of Object.keys(r).sort())if(null!=r[o]){var a=o.toLowerCase();(a in Nn||(null==t?void 0:t.has(a))||Pn.test(a)||Rn.test(a))&&(!n||n&&!n.has(a))||(i[a]=r[o].trim().replace(/\s+/g," "))}return i},Hn=function(){var e=a((function*(e,t){var n,{headers:r,body:i}=e;for(var o of Object.keys(r))if(o.toLowerCase()===On)return r[o];if(null==i)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if("string"==typeof i||ArrayBuffer.isView(i)||(n=i,"function"==typeof ArrayBuffer&&n instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(n))){var a=new t;return a.update(wn(i)),he(yield a.digest())}return"UNSIGNED-PAYLOAD"}));return function(t,n){return e.apply(this,arguments)}}();class Bn{format(e){var t=[];for(var n of Object.keys(e)){var r=Q(n);t.push(Uint8Array.from([r.byteLength]),r,this.formatHeaderValue(e[n]))}var i=new Uint8Array(t.reduce(((e,t)=>e+t.byteLength),0)),o=0;for(var a of t)i.set(a,o),o+=a.byteLength;return i}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":var t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":var n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,e.value,!1),new Uint8Array(n.buffer);case"long":var r=new Uint8Array(9);return r[0]=5,r.set(e.value.bytes,1),r;case"binary":var i=new DataView(new ArrayBuffer(3+e.value.byteLength));i.setUint8(0,6),i.setUint16(1,e.value.byteLength,!1);var o=new Uint8Array(i.buffer);return o.set(e.value,3),o;case"string":var a=Q(e.value),s=new DataView(new ArrayBuffer(3+a.byteLength));s.setUint8(0,7),s.setUint16(1,a.byteLength,!1);var c=new Uint8Array(s.buffer);return c.set(a,3),c;case"timestamp":var u=new Uint8Array(9);return u[0]=8,u.set(Gn.fromNumber(e.value.valueOf()).bytes,1),u;case"uuid":if(!zn.test(e.value))throw new Error("Invalid UUID received: ".concat(e.value));var l=new Uint8Array(17);return l[0]=9,l.set(function(e){if(e.length%2!=0)throw new Error("Hex encoded strings must have an even number length");for(var t=new Uint8Array(e.length/2),n=0;n<e.length;n+=2){var r=e.slice(n,n+2).toLowerCase();if(!(r in le))throw new Error("Cannot decode unrecognized sequence ".concat(r," as hexadecimal"));t[n/2]=le[r]}return t}(e.value.replace(/\-/g,"")),1),l}}}!function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"}(cn||(cn={}));var zn=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;class Gn{constructor(e){if(this.bytes=e,8!==e.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>0x8000000000000000||e<-0x8000000000000000)throw new Error("".concat(e," is too large (or, if negative, too small) to represent as an Int64"));for(var t=new Uint8Array(8),n=7,r=Math.abs(Math.round(e));n>-1&&r>0;n--,r/=256)t[n]=r;return e<0&&qn(t),new Gn(t)}valueOf(){var e=this.bytes.slice(0),t=128&e[0];return t&&qn(e),parseInt(he(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}}function qn(e){for(var t=0;t<8;t++)e[t]^=255;for(var n=7;n>-1&&(e[n]++,0===e[n]);n--);}var Vn=e=>{for(var t of(e=b.clone(e),Object.keys(e.headers)))An.indexOf(t.toLowerCase())>-1&&delete e.headers[t];return e};class $n{constructor(e){var{applyChecksum:t,credentials:n,region:r,service:i,sha256:o,uriEscapePath:a=!0}=e;this.headerFormatter=new Bn,this.service=i,this.sha256=o,this.uriEscapePath=a,this.applyChecksum="boolean"!=typeof t||t,this.regionProvider=A(r),this.credentialProvider=A(n)}presign(e){var t=arguments,n=this;return a((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{},{signingDate:i=new Date,expiresIn:o=3600,unsignableHeaders:a,unhoistableHeaders:s,signableHeaders:u,hoistableHeaders:l,signingRegion:d,signingService:p}=r,h=yield n.credentialProvider();n.validateResolvedCredentials(h);var f=null!=d?d:yield n.regionProvider(),{longDate:g,shortDate:m}=Jn(i);if(o>604800)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");var v=Fn(m,f,null!=p?p:n.service),y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{headers:n,query:r={}}=b.clone(e);for(var i of Object.keys(n)){var o,a,s=i.toLowerCase();("x-amz-"===s.slice(0,6)&&(null===(o=t.unhoistableHeaders)||void 0===o||!o.has(s))||(null===(a=t.hoistableHeaders)||void 0===a?void 0:a.has(s)))&&(r[i]=n[i],delete n[i])}return c(c({},e),{},{headers:n,query:r})}(Vn(e),{unhoistableHeaders:s,hoistableHeaders:l});h.sessionToken&&(y.query[Sn]=h.sessionToken),y.query["X-Amz-Algorithm"]=_n,y.query["X-Amz-Credential"]="".concat(h.accessKeyId,"/").concat(v),y.query[En]=g,y.query["X-Amz-Expires"]=o.toString(10);var w=Wn(y,a,u);return y.query["X-Amz-SignedHeaders"]=Kn(w),y.query[Cn]=yield n.getSignature(g,v,n.getSigningKey(h,f,m,p),n.createCanonicalRequest(y,w,yield Hn(e,n.sha256))),y}))()}sign(e,t){var n=this;return a((function*(){return"string"==typeof e?n.signString(e,t):e.headers&&e.payload?n.signEvent(e,t):e.message?n.signMessage(e,t):n.signRequest(e,t)}))()}signEvent(e,t){var n=this;return a((function*(){var{headers:r,payload:i}=e,{signingDate:o=new Date,priorSignature:a,signingRegion:s,signingService:c}=t,u=null!=s?s:yield n.regionProvider(),{shortDate:l,longDate:d}=Jn(o),p=Fn(l,u,null!=c?c:n.service),h=yield Hn({headers:{},body:i},n.sha256),f=new n.sha256;f.update(r);var g=he(yield f.digest()),m=[Dn,d,p,a,g,h].join("\n");return n.signString(m,{signingDate:o,signingRegion:u,signingService:c})}))()}signMessage(e,t){var n=this;return a((function*(){var{signingDate:r=new Date,signingRegion:i,signingService:o}=t;return n.signEvent({headers:n.headerFormatter.format(e.message.headers),payload:e.message.body},{signingDate:r,signingRegion:i,signingService:o,priorSignature:e.priorSignature}).then((t=>({message:e.message,signature:t})))}))()}signString(e){var t=arguments,n=this;return a((function*(){var{signingDate:r=new Date,signingRegion:i,signingService:o}=t.length>1&&void 0!==t[1]?t[1]:{},a=yield n.credentialProvider();n.validateResolvedCredentials(a);var s=null!=i?i:yield n.regionProvider(),{shortDate:c}=Jn(r),u=new n.sha256(yield n.getSigningKey(a,s,c,o));return u.update(wn(e)),he(yield u.digest())}))()}signRequest(e){var t=arguments,n=this;return a((function*(){var{signingDate:r=new Date,signableHeaders:i,unsignableHeaders:o,signingRegion:a,signingService:s}=t.length>1&&void 0!==t[1]?t[1]:{},c=yield n.credentialProvider();n.validateResolvedCredentials(c);var u=null!=a?a:yield n.regionProvider(),l=Vn(e),{longDate:d,shortDate:p}=Jn(r),h=Fn(p,u,null!=s?s:n.service);l.headers[In]=d,c.sessionToken&&(l.headers[Mn]=c.sessionToken);var f=yield Hn(l,n.sha256);!((e,t)=>{for(var n of(e=e.toLowerCase(),Object.keys(t)))if(e===n.toLowerCase())return!0;return!1})(On,l.headers)&&n.applyChecksum&&(l.headers[On]=f);var g=Wn(l,o,i),m=yield n.getSignature(d,h,n.getSigningKey(c,u,p,s),n.createCanonicalRequest(l,g,f));return l.headers[Tn]="".concat(_n," Credential=").concat(c.accessKeyId,"/").concat(h,", SignedHeaders=").concat(Kn(g),", Signature=").concat(m),l}))()}createCanonicalRequest(e,t,n){var r=Object.keys(t).sort();return"".concat(e.method,"\n").concat(this.getCanonicalPath(e),"\n").concat((e=>{var{query:t={}}=e,n=[],r={},i=function(){if(o.toLowerCase()===kn)return 1;var e=ne(o);n.push(e);var i=t[o];"string"==typeof i?r[e]="".concat(e,"=").concat(ne(i)):Array.isArray(i)&&(r[e]=i.slice(0).reduce(((t,n)=>t.concat(["".concat(e,"=").concat(ne(n))])),[]).sort().join("&"))};for(var o of Object.keys(t))i();return n.sort().map((e=>r[e])).filter((e=>e)).join("&")})(e),"\n").concat(r.map((e=>"".concat(e,":").concat(t[e]))).join("\n"),"\n\n").concat(r.join(";"),"\n").concat(n)}createStringToSign(e,t,n){var r=this;return a((function*(){var i=new r.sha256;i.update(wn(n));var o=yield i.digest();return"".concat(_n,"\n").concat(e,"\n").concat(t,"\n").concat(he(o))}))()}getCanonicalPath(e){var{path:t}=e;if(this.uriEscapePath){var n=[];for(var r of t.split("/"))0!==(null==r?void 0:r.length)&&"."!==r&&(".."===r?n.pop():n.push(r));var i="".concat(null!=t&&t.startsWith("/")?"/":"").concat(n.join("/")).concat(n.length>0&&null!=t&&t.endsWith("/")?"/":"");return ne(i).replace(/%2F/g,"/")}return t}getSignature(e,t,n,r){var i=this;return a((function*(){var o=yield i.createStringToSign(e,t,r),a=new i.sha256(yield n);return a.update(wn(o)),he(yield a.digest())}))()}getSigningKey(e,t,n,r){return(i=a((function*(e,t,n,r,i){var o="".concat(n,":").concat(r,":").concat(i,":").concat(he(yield jn(e,t.secretAccessKey,t.accessKeyId)),":").concat(t.sessionToken);if(o in Ln)return Ln[o];for(Un.push(o);Un.length>50;)delete Ln[Un.shift()];var a="AWS4".concat(t.secretAccessKey);for(var s of[n,r,i,xn])a=yield jn(e,a,s);return Ln[o]=a})),function(e,t,n,r,o){return i.apply(this,arguments)})(this.sha256,e,n,t,r||this.service);var i}validateResolvedCredentials(e){if("object"!=typeof e||"string"!=typeof e.accessKeyId||"string"!=typeof e.secretAccessKey)throw new Error("Resolved credential object is not valid")}}var Jn=e=>{var t,n=(t=e,(e=>"number"==typeof e?new Date(1e3*e):"string"==typeof e?Number(e)?new Date(1e3*Number(e)):new Date(e):e)(t).toISOString().replace(/\.\d{3}Z$/,"Z")).replace(/[\-:]/g,"");return{longDate:n,shortDate:n.slice(0,8)}},Kn=e=>Object.keys(e).sort().join(";"),Yn=e=>{var t,n=!1;e.credentials&&(n=!0,t=((e,t,n)=>{if(void 0!==e){var r,i,o,s="function"!=typeof e?a((function*(){return Promise.resolve(e)})):e,c=!1,u=function(){var e=a((function*(e){i||(i=s(e));try{r=yield i,o=!0,c=!1}finally{i=void 0}return r}));return function(t){return e.apply(this,arguments)}}();return void 0===t?function(){var e=a((function*(e){return o&&!(null!=e&&e.forceRefresh)||(r=yield u(e)),r}));return function(t){return e.apply(this,arguments)}}():function(){var e=a((function*(e){return o&&!(null!=e&&e.forceRefresh)||(r=yield u(e)),c?r:n(r)?t(r)?(yield u(e),r):r:(c=!0,r)}));return function(t){return e.apply(this,arguments)}}()}})(e.credentials,be,we)),t||(t=e.credentialDefaultProvider?D(e.credentialDefaultProvider(Object.assign({},e,{parentClientConfig:e}))):a((function*(){throw new Error("`credentials` is missing")})));var r,i=function(){var n=a((function*(){return t({callerClientConfig:e})}));return function(){return n.apply(this,arguments)}}(),{signingEscapePath:o=!0,systemClockOffset:s=e.systemClockOffset||0,sha256:u}=e;return r=e.signer?D(e.signer):e.regionInfoProvider?()=>D(e.region)().then(function(){var t=a((function*(t){return[(yield e.regionInfoProvider(t,{useFipsEndpoint:yield e.useFipsEndpoint(),useDualstackEndpoint:yield e.useDualstackEndpoint()}))||{},t]}));return function(e){return t.apply(this,arguments)}}()).then((t=>{var[n,r]=t,{signingRegion:a,signingService:s}=n;e.signingRegion=e.signingRegion||a||r,e.signingName=e.signingName||s||e.serviceId;var l=c(c({},e),{},{credentials:i,region:e.signingRegion,service:e.signingName,sha256:u,uriEscapePath:o});return new(e.signerConstructor||$n)(l)})):function(){var t=a((function*(t){var n=(t=Object.assign({},{name:"sigv4",signingName:e.signingName||e.defaultSigningName,signingRegion:yield D(e.region)(),properties:{}},t)).signingRegion,r=t.signingName;e.signingRegion=e.signingRegion||n,e.signingName=e.signingName||r||e.serviceId;var a=c(c({},e),{},{credentials:i,region:e.signingRegion,service:e.signingName,sha256:u,uriEscapePath:o});return new(e.signerConstructor||$n)(a)}));return function(e){return t.apply(this,arguments)}}(),c(c({},e),{},{systemClockOffset:s,signingEscapePath:o,credentials:n?a((function*(){return i().then((e=>{return(t=e).$source||(t.$source={}),t.$source.CREDENTIALS_CODE="e",t;var t}))})):i,signer:r})},Xn=function(){var e=a((function*(e,t,n){return{operation:I(t).operation,region:(yield A(e.region)())||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()}}));return function(t,n,r){return e.apply(this,arguments)}}(),Qn=e=>{var t=[];return e.operation,t.push(function(e){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"execute-api",region:e.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}(e)),t},Zn={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}},er="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:e=>(new TextEncoder).encode(e);function tr(e){return e instanceof Uint8Array?e:"string"==typeof e?er(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}function nr(e){return"string"==typeof e?0===e.length:0===e.byteLength}var rr={name:"SHA-256"},ir={name:"HMAC",hash:rr},or=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85]),ar={};function sr(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:ar}var cr=function(){function e(e){this.toHash=new Uint8Array(0),this.secret=e,this.reset()}return e.prototype.update=function(e){if(!nr(e)){var t=tr(e),n=new Uint8Array(this.toHash.byteLength+t.byteLength);n.set(this.toHash,0),n.set(t,this.toHash.byteLength),this.toHash=n}},e.prototype.digest=function(){var e=this;return this.key?this.key.then((function(t){return sr().crypto.subtle.sign(ir,t,e.toHash).then((function(e){return new Uint8Array(e)}))})):nr(this.toHash)?Promise.resolve(or):Promise.resolve().then((function(){return sr().crypto.subtle.digest(rr,e.toHash)})).then((function(e){return Promise.resolve(new Uint8Array(e))}))},e.prototype.reset=function(){var e=this;this.toHash=new Uint8Array(0),this.secret&&void 0!==this.secret&&(this.key=new Promise((function(t,n){sr().crypto.subtle.importKey("raw",tr(e.secret),ir,!1,["sign"]).then(t,n)})),this.key.catch((function(){})))},e}();Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var ur=64,lr=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),dr=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],pr=Math.pow(2,53)-1,hr=function(){function e(){this.state=Int32Array.from(dr),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return e.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var t=0,n=e.byteLength;if(this.bytesHashed+=n,8*this.bytesHashed>pr)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=e[t++],n--,this.bufferLength===ur&&(this.hashBuffer(),this.bufferLength=0)},e.prototype.digest=function(){if(!this.finished){var e=8*this.bytesHashed,t=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(t.setUint8(this.bufferLength++,128),n%ur>=56){for(var r=this.bufferLength;r<ur;r++)t.setUint8(r,0);this.hashBuffer(),this.bufferLength=0}for(r=this.bufferLength;r<56;r++)t.setUint8(r,0);t.setUint32(56,Math.floor(e/4294967296),!0),t.setUint32(60,e),this.hashBuffer(),this.finished=!0}var i=new Uint8Array(32);for(r=0;r<8;r++)i[4*r]=this.state[r]>>>24&255,i[4*r+1]=this.state[r]>>>16&255,i[4*r+2]=this.state[r]>>>8&255,i[4*r+3]=this.state[r]>>>0&255;return i},e.prototype.hashBuffer=function(){for(var e=this.buffer,t=this.state,n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],u=t[7],l=0;l<ur;l++){if(l<16)this.temp[l]=(255&e[4*l])<<24|(255&e[4*l+1])<<16|(255&e[4*l+2])<<8|255&e[4*l+3];else{var d=this.temp[l-2],p=(d>>>17|d<<15)^(d>>>19|d<<13)^d>>>10,h=((d=this.temp[l-15])>>>7|d<<25)^(d>>>18|d<<14)^d>>>3;this.temp[l]=(p+this.temp[l-7]|0)+(h+this.temp[l-16]|0)}var f=(((a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7))+(a&s^~a&c)|0)+(u+(lr[l]+this.temp[l]|0)|0)|0,g=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&r^n&i^r&i)|0;u=c,c=s,s=a,a=o+f|0,o=i,i=r,r=n,n=f+g|0}t[0]+=n,t[1]+=r,t[2]+=i,t[3]+=o,t[4]+=a,t[5]+=s,t[6]+=c,t[7]+=u},e}(),fr=function(){function e(e){this.secret=e,this.hash=new hr,this.reset()}return e.prototype.update=function(e){if(!nr(e)&&!this.error)try{this.hash.update(tr(e))}catch(e){this.error=e}},e.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},e.prototype.digest=function(){return e=this,n=function(){return function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,(function(e){return[2,this.digestSync()]}))},new((t=void 0)||(t=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,a)}s((n=n.apply(e,[])).next())}));var e,t,n},e.prototype.reset=function(){if(this.hash=new hr,this.secret){this.outer=new hr;var e=function(e){var t=tr(e);if(t.byteLength>ur){var n=new hr;n.update(t),t=n.digest()}var r=new Uint8Array(ur);return r.set(t),r}(this.secret),t=new Uint8Array(ur);t.set(e);for(var n=0;n<ur;n++)e[n]^=54,t[n]^=92;for(this.hash.update(e),this.outer.update(t),n=0;n<e.byteLength;n++)e[n]=0}},e}(),gr=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"],mr=function(){function e(e){!function(e){return!(!function(e){return"object"==typeof e&&"object"==typeof e.crypto&&"function"==typeof e.crypto.getRandomValues}(e)||"object"!=typeof e.crypto.subtle)&&(t=e.crypto.subtle)&&gr.every((function(e){return"function"==typeof t[e]}));var t}(sr())?this.hash=new fr(e):this.hash=new cr(e)}return e.prototype.update=function(e,t){this.hash.update(tr(e))},e.prototype.digest=function(){return this.hash.digest()},e.prototype.reset=function(){this.hash.reset()},e}(),vr=o(880),yr=o.n(vr),br=e=>{var{serviceId:t,clientVersion:n}=e;return function(){var e=a((function*(e){var r,i,o,a,s,c,u,l,d="undefined"!=typeof window&&null!==(r=window)&&void 0!==r&&null!==(r=r.navigator)&&void 0!==r&&r.userAgent?yr().parse(window.navigator.userAgent):void 0,p=[["aws-sdk-js",n],["ua","2.1"],["os/".concat((null==d||null===(i=d.os)||void 0===i?void 0:i.name)||"other"),null==d||null===(o=d.os)||void 0===o?void 0:o.version],["lang/js"],["md/browser","".concat(null!==(a=null==d||null===(s=d.browser)||void 0===s?void 0:s.name)&&void 0!==a?a:"unknown","_").concat(null!==(c=null==d||null===(u=d.browser)||void 0===u?void 0:u.version)&&void 0!==c?c:"unknown")]];t&&p.push(["api/".concat(t),n]);var h=yield null==e||null===(l=e.userAgentAppId)||void 0===l?void 0:l.call(e);return h&&p.push(["app/".concat(h)]),p}));return function(t){return e.apply(this,arguments)}}()},wr="function"==typeof TextEncoder?new TextEncoder:null,Er=e=>{if("string"==typeof e){if(wr)return wr.encode(e).byteLength;for(var t=e.length,n=t-1;n>=0;n--){var r=e.charCodeAt(n);r>127&&r<=2047?t++:r>2047&&r<=65535&&(t+=2),r>=56320&&r<=57343&&n--}return t}if("number"==typeof e.byteLength)return e.byteLength;if("number"==typeof e.size)return e.size;throw new Error("Body Length computation failed for ".concat(e))},Cr=e=>new Date(Date.now()+e),Sr=e=>{var t,n,r;return w.isInstance(e)?null!==(t=null===(n=e.headers)||void 0===n?void 0:n.date)&&void 0!==t?t:null===(r=e.headers)||void 0===r?void 0:r.Date:void 0},Tr=(e,t)=>{var n=Date.parse(e);return((e,t)=>Math.abs(Cr(t).getTime()-e)>=3e5)(n,t)?n-Date.now():t},Ir=(e,t)=>{if(!t)throw new Error("Property `".concat(e,"` is not resolved for AWS SDK SigV4Auth"));return t};class Ar{sign(e,t,n){return a((function*(){var t;if(!b.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");var r,i=yield(r=a((function*(e){var t,n=Ir("context",e.context),r=Ir("config",e.config),i=null===(t=n.endpointV2)||void 0===t||null===(t=t.properties)||void 0===t||null===(t=t.authSchemes)||void 0===t?void 0:t[0],o=Ir("signer",r.signer);return{config:r,signer:yield o(i),signingRegion:null==e?void 0:e.signingRegion,signingRegionSet:null==e?void 0:e.signingRegionSet,signingName:null==e?void 0:e.signingName}})),function(e){return r.apply(this,arguments)})(n),{config:o,signer:s}=i,{signingRegion:c,signingName:u}=i,l=n.context;if(null!=l&&null!==(t=l.authSchemes)&&void 0!==t&&t.length){var d,p,[h,f]=l.authSchemes;"sigv4a"===(null==h?void 0:h.name)&&"sigv4"===(null==f?void 0:f.name)&&(c=null!==(d=null==f?void 0:f.signingRegion)&&void 0!==d?d:c,u=null!==(p=null==f?void 0:f.signingName)&&void 0!==p?p:u)}return yield s.sign(e,{signingDate:Cr(o.systemClockOffset),signingRegion:c,signingService:u})}))()}errorHandler(e){return t=>{var n,r=null!==(n=t.ServerTime)&&void 0!==n?n:Sr(t.$response);if(r){var i=Ir("config",e.config),o=i.systemClockOffset;i.systemClockOffset=Tr(r,i.systemClockOffset),i.systemClockOffset!==o&&t.$metadata&&(t.$metadata.clockSkewCorrected=!0)}throw t}}successHandler(e,t){var n=Sr(e);if(n){var r=Ir("config",t.config);r.systemClockOffset=Tr(n,r.systemClockOffset)}}}var kr="required",Or="fn",Mr="argv",Nr="ref",Pr=!0,Rr="isSet",_r="booleanEquals",Dr="error",xr="endpoint",Lr="tree",Ur="PartitionResult",Fr="getAttr",jr={[kr]:!1,type:"String"},Wr={[kr]:!0,default:!1,type:"Boolean"},Hr={[Nr]:"Endpoint"},Br={[Or]:_r,[Mr]:[{[Nr]:"UseFIPS"},!0]},zr={[Or]:_r,[Mr]:[{[Nr]:"UseDualStack"},!0]},Gr={},qr={[Or]:Fr,[Mr]:[{[Nr]:Ur},"supportsFIPS"]},Vr={[Nr]:Ur},$r={[Or]:_r,[Mr]:[!0,{[Or]:Fr,[Mr]:[Vr,"supportsDualStack"]}]},Jr=[Br],Kr=[zr],Yr=[{[Nr]:"Region"}],Xr={version:"1.0",parameters:{Region:jr,UseDualStack:Wr,UseFIPS:Wr,Endpoint:jr},rules:[{conditions:[{[Or]:Rr,[Mr]:[Hr]}],rules:[{conditions:Jr,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:Dr},{conditions:Kr,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:Dr},{endpoint:{url:Hr,properties:Gr,headers:Gr},type:xr}],type:Lr},{conditions:[{[Or]:Rr,[Mr]:Yr}],rules:[{conditions:[{[Or]:"aws.partition",[Mr]:Yr,assign:Ur}],rules:[{conditions:[Br,zr],rules:[{conditions:[{[Or]:_r,[Mr]:[Pr,qr]},$r],rules:[{endpoint:{url:"https://participant.connect-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:Gr,headers:Gr},type:xr}],type:Lr},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:Dr}],type:Lr},{conditions:Jr,rules:[{conditions:[{[Or]:_r,[Mr]:[qr,Pr]}],rules:[{conditions:[{[Or]:"stringEquals",[Mr]:[{[Or]:Fr,[Mr]:[Vr,"name"]},"aws-us-gov"]}],endpoint:{url:"https://participant.connect.{Region}.amazonaws.com",properties:Gr,headers:Gr},type:xr},{endpoint:{url:"https://participant.connect-fips.{Region}.{PartitionResult#dnsSuffix}",properties:Gr,headers:Gr},type:xr}],type:Lr},{error:"FIPS is enabled but this partition does not support FIPS",type:Dr}],type:Lr},{conditions:Kr,rules:[{conditions:[$r],rules:[{endpoint:{url:"https://participant.connect.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:Gr,headers:Gr},type:xr}],type:Lr},{error:"DualStack is enabled but this partition does not support DualStack",type:Dr}],type:Lr},{endpoint:{url:"https://participant.connect.{Region}.{PartitionResult#dnsSuffix}",properties:Gr,headers:Gr},type:xr}],type:Lr}],type:Lr},{error:"Invalid Configuration: Missing Region",type:Dr}]},Qr=new class{constructor(e){var{size:t,params:n}=e;this.data=new Map,this.parameters=[],this.capacity=null!=t?t:50,n&&(this.parameters=n)}get(e,t){var n=this.hash(e);if(!1===n)return t();if(!this.data.has(n)){if(this.data.size>this.capacity+10)for(var r=this.data.keys(),i=0;;){var{value:o,done:a}=r.next();if(this.data.delete(o),a||++i>10)break}this.data.set(n,t())}return this.data.get(n)}size(){return this.data.size}hash(e){var t="",{parameters:n}=this;if(0===n.length)return!1;for(var r of n){var i,o=String(null!==(i=e[r])&&void 0!==i?i:"");if(o.includes("|;"))return!1;t+=o+"|;"}return t}}({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),Zr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Qr.get(e,(()=>((e,t,n,r,i,o)=>{var{endpointParams:a,logger:s}=t,{parameters:c,rules:u}=e;null===(n=t.logger)||void 0===n||null===(r=n.debug)||void 0===r||r.call(n,"".concat(Ae," Initial EndpointParams: ").concat(ke(a)));var l=Object.entries(c).filter((e=>{var[,t]=e;return null!=t.default})).map((e=>{var[t,n]=e;return[t,n.default]}));if(l.length>0)for(var[d,p]of l){var h;a[d]=null!==(h=a[d])&&void 0!==h?h:p}var f=Object.entries(c).filter((e=>{var[,t]=e;return t.required})).map((e=>{var[t]=e;return t}));for(var g of f)if(null==a[g])throw new Oe("Missing required parameter: '".concat(g,"'"));var m=Ge(u,{endpointParams:a,logger:s,referenceRecord:{}});return null!==(i=t.logger)&&void 0!==i&&null!==(o=i.debug)&&void 0!==o&&o.call(i,"".concat(Ae," Resolved endpoint: ").concat(ke(m))),m})(Xr,{endpointParams:e,logger:t.logger})))};Ie.aws=Ve,Error;var ei=["in-region","cross-region","mobile","standard","legacy"],ti=e=>{var t,n,r,i,o,s,u,l,d,p,h,f=function(){var{defaultsMode:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(()=>{var t,n,r,i=function(){var i=a((function*(){n||(n=a((function*(){var t="function"==typeof e?yield e():e;switch(null==t?void 0:t.toLowerCase()){case"auto":return Promise.resolve(((e,t)=>{var n="undefined"!=typeof window&&null!==(e=window)&&void 0!==e&&null!==(e=e.navigator)&&void 0!==e&&e.userAgent?yr().parse(window.navigator.userAgent):void 0,r=null==n||null===(t=n.platform)||void 0===t?void 0:t.type;return"tablet"===r||"mobile"===r})()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(null==t?void 0:t.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error('Invalid parameter for "defaultsMode", expect '.concat(ei.join(", "),", got ").concat(t))}}))());try{t=yield n,r=!0}finally{n=void 0}return t}));return function(){return i.apply(this,arguments)}}();return function(){var e=a((function*(e){return r&&!(null!=e&&e.forceRefresh)||(t=yield i()),t}));return function(t){return e.apply(this,arguments)}}()})()}(e),g=()=>f().then(tn),m=((e,t,n,r,i,o,a,s,c,u,l,d,p)=>({apiVersion:"2018-09-07",base64Decoder:null!==(t=null==e?void 0:e.base64Decoder)&&void 0!==t?t:X,base64Encoder:null!==(n=null==e?void 0:e.base64Encoder)&&void 0!==n?n:Z,disableHostPrefix:null!==(r=null==e?void 0:e.disableHostPrefix)&&void 0!==r&&r,endpointProvider:null!==(i=null==e?void 0:e.endpointProvider)&&void 0!==i?i:Zr,extensions:null!==(o=null==e?void 0:e.extensions)&&void 0!==o?o:[],httpAuthSchemeProvider:null!==(a=null==e?void 0:e.httpAuthSchemeProvider)&&void 0!==a?a:Qn,httpAuthSchemes:null!==(s=null==e?void 0:e.httpAuthSchemes)&&void 0!==s?s:[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new Ar}],logger:null!==(c=null==e?void 0:e.logger)&&void 0!==c?c:new an,serviceId:null!==(u=null==e?void 0:e.serviceId)&&void 0!==u?u:"ConnectParticipant",urlParser:null!==(l=null==e?void 0:e.urlParser)&&void 0!==l?l:pt,utf8Decoder:null!==(d=null==e?void 0:e.utf8Decoder)&&void 0!==d?d:Q,utf8Encoder:null!==(p=null==e?void 0:e.utf8Encoder)&&void 0!==p?p:ee}))(e);return c(c(c({},m),e),{},{runtime:"browser",defaultsMode:f,bodyLengthChecker:null!==(t=null==e?void 0:e.bodyLengthChecker)&&void 0!==t?t:Er,credentialDefaultProvider:null!==(n=null==e?void 0:e.credentialDefaultProvider)&&void 0!==n?n:e=>()=>Promise.reject(new Error("Credential is missing")),defaultUserAgentProvider:null!==(r=null==e?void 0:e.defaultUserAgentProvider)&&void 0!==r?r:br({serviceId:m.serviceId,clientVersion:"3.716.0"}),maxAttempts:null!==(i=null==e?void 0:e.maxAttempts)&&void 0!==i?i:3,region:null!==(o=null==e?void 0:e.region)&&void 0!==o?o:()=>Promise.reject("Region is missing"),requestHandler:se.create(null!==(s=null==e?void 0:e.requestHandler)&&void 0!==s?s:g),retryMode:null!==(u=null==e?void 0:e.retryMode)&&void 0!==u?u:a((function*(){return(yield g()).retryMode||vt})),sha256:null!==(l=null==e?void 0:e.sha256)&&void 0!==l?l:mr,streamCollector:null!==(d=null==e?void 0:e.streamCollector)&&void 0!==d?d:ce,useDualstackEndpoint:null!==(p=null==e?void 0:e.useDualstackEndpoint)&&void 0!==p?p:()=>Promise.resolve(!1),useFipsEndpoint:null!==(h=null==e?void 0:e.useFipsEndpoint)&&void 0!==h?h:()=>Promise.resolve(!1)})},ni=e=>{var t=function(){var t=a((function*(){if(void 0===e.region)throw new Error("Region is missing from runtimeConfig");var t=e.region;return"string"==typeof t?t:t()}));return function(){return t.apply(this,arguments)}}();return{setRegion(e){t=e},region:()=>t}};class ri extends zt{constructor(){for(var e,t,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];var u,l,d,[p]=o,h=function(e,t){var n,r=D(null!==(t=e.userAgentAppId)&&void 0!==t?t:void 0);return c(c({},e),{},{customUserAgent:"string"==typeof e.customUserAgent?[[e.customUserAgent]]:e.customUserAgent,userAgentAppId:(n=a((function*(){var t=yield r();if(!function(e){return void 0===e||"string"==typeof e&&e.length<=50}(t)){var n,i="NoOpLogger"!==(null===(n=e.logger)||void 0===n||null===(n=n.constructor)||void 0===n?void 0:n.name)&&e.logger?e.logger:console;"string"!=typeof t?null==i||i.warn("userAgentAppId must be a string or undefined."):t.length>50&&(null==i||i.warn("The provided userAgentAppId exceeds the maximum length of 50 characters."))}return t})),function(){return n.apply(this,arguments)})})}(c(c({},u=ti(p||{})),{},{useDualstackEndpoint:null!==(e=u.useDualstackEndpoint)&&void 0!==e&&e,useFipsEndpoint:null!==(t=u.useFipsEndpoint)&&void 0!==t&&t,defaultSigningName:"execute-api"})),f=((e,t,n,r)=>{var i,o=null===(t=e.tls)||void 0===t||t,{endpoint:s}=e,u=null!=s?a((function*(){return ht(yield A(s)())})):void 0,l=!!s,d=c(c({},e),{},{endpoint:u,tls:o,isCustomEndpoint:l,useDualstackEndpoint:A(null!==(n=e.useDualstackEndpoint)&&void 0!==n&&n),useFipsEndpoint:A(null!==(r=e.useFipsEndpoint)&&void 0!==r&&r)});return d.serviceConfiguredEndpoint=a((function*(){return e.serviceId&&!i&&(i=dt(e.serviceId)),i})),d})((e=>{var t,n,{region:r,useFipsEndpoint:i}=e;if(!r)throw new Error("Region is missing");return c(c({},e),{},{region:(n=a((function*(){if("string"==typeof r)return it(r);var e=yield r();return it(e)})),function(){return n.apply(this,arguments)}),useFipsEndpoint:(t=a((function*(){var e="string"==typeof r?r:yield r();return!!rt(e)||("function"!=typeof i?Promise.resolve(!!i):i())})),function(){return t.apply(this,arguments)})})})(((e,t)=>{var n,{retryStrategy:r}=e,i=A(null!==(t=e.maxAttempts)&&void 0!==t?t:3);return c(c({},e),{},{maxAttempts:i,retryStrategy:(n=a((function*(){return r||((yield A(e.retryMode)())===nt.ADAPTIVE?new Mt(i):new Ot(i))})),function(){return n.apply(this,arguments)})})})(h))),g=((e,t)=>{var n,r=c(c(c(c({},ni(e)),(e=>c(c({},nn(e)),(e=>{var t=e.retryStrategy;return{setRetryStrategy(e){t=e},retryStrategy:()=>t}})(e)))(e)),(e=>{var t=e.httpHandler;return{setHttpHandler(e){t=e},httpHandler:()=>t,updateHttpClientConfig(e,n){t.updateHttpClientConfig(e,n)},httpHandlerConfigs:()=>t.httpHandlerConfigs()}})(e)),(e=>{var t=e.httpAuthSchemes,n=e.httpAuthSchemeProvider,r=e.credentials;return{setHttpAuthScheme(e){var n=t.findIndex((t=>t.schemeId===e.schemeId));-1===n?t.push(e):t.splice(n,1,e)},httpAuthSchemes:()=>t,setHttpAuthSchemeProvider(e){n=e},httpAuthSchemeProvider:()=>n,setCredentials(e){r=e},credentials:()=>r}})(e));return t.forEach((e=>e.configure(r))),c(c(c(c(c({},e),{region:r.region()}),c(c({},(e=>{var t={};return e.checksumAlgorithms().forEach((e=>{t[e.algorithmId()]=e.checksumConstructor()})),t})(n=r)),(e=>{var t={};return t.retryStrategy=e.retryStrategy(),t})(n))),{httpHandler:r.httpHandler()}),(e=>({httpAuthSchemes:e.httpAuthSchemes(),httpAuthSchemeProvider:e.httpAuthSchemeProvider(),credentials:e.credentials()}))(r))})(c({},Yn(f)),(null==p?void 0:p.extensions)||[]);super(g),this.config=g,this.middlewareStack.use((l=this.config,{applyToStack:e=>{e.add((e=>(t,n)=>function(){var r=a((function*(r){var i,o,s,u,{request:l}=r;if(!b.isInstance(l))return t(r);var d,{headers:p}=l,h=(null==n||null===(i=n.userAgent)||void 0===i?void 0:i.map(et))||[],f=(yield e.defaultUserAgentProvider()).map(et);yield(d=a((function*(e,t,n){var r,i,o=n.request;if("rpc-v2-cbor"===(null==o||null===(r=o.headers)||void 0===r?void 0:r["smithy-protocol"])&&$e(e,"PROTOCOL_RPC_V2_CBOR","M"),"function"==typeof t.retryStrategy){var a,s=yield t.retryStrategy();"function"==typeof s.acquireInitialRetryToken?null!==(a=s.constructor)&&void 0!==a&&null!==(a=a.name)&&void 0!==a&&a.includes("Adaptive")?$e(e,"RETRY_MODE_ADAPTIVE","F"):$e(e,"RETRY_MODE_STANDARD","E"):$e(e,"RETRY_MODE_LEGACY","D")}if("function"==typeof t.accountIdEndpointMode){var c,u,l=e.endpointV2;switch(String(null==l||null===(c=l.url)||void 0===c?void 0:c.hostname).match(Ke)&&$e(e,"ACCOUNT_ID_ENDPOINT","O"),yield null===(u=t.accountIdEndpointMode)||void 0===u?void 0:u.call(t)){case"disabled":$e(e,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":$e(e,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":$e(e,"ACCOUNT_ID_MODE_REQUIRED","R")}}var d=null===(i=e.__smithy_context)||void 0===i||null===(i=i.selectedHttpAuthScheme)||void 0===i?void 0:i.identity;if(null!=d&&d.$source){var p=d;for(var[h,f]of(p.accountId&&$e(e,"RESOLVED_ACCOUNT_ID","T"),Object.entries(null!==(g=p.$source)&&void 0!==g?g:{}))){var g;$e(e,h,f)}}})),function(e,t,n){return d.apply(this,arguments)})(n,e,r);var g=n;f.push("m/".concat(function(e){var t="";for(var n in e){var r=e[n];if(!(t.length+r.length+1<=1024))break;t.length?t+=","+r:t+=r}return t}(Object.assign({},null===(o=n.__smithy_context)||void 0===o?void 0:o.features,null===(s=g.__aws_sdk_context)||void 0===s?void 0:s.features))));var m=(null==e||null===(u=e.customUserAgent)||void 0===u?void 0:u.map(et))||[],v=yield e.userAgentAppId();v&&f.push(et(["app/".concat(v)]));var y=[].concat([...f,...h,...m]).join(" "),w=[...f.filter((e=>e.startsWith("aws-sdk-"))),...m].join(" ");return"browser"!==e.runtime?(w&&(p[Xe]=p[Xe]?"".concat(p[Ye]," ").concat(w):w),p[Ye]=y):p[Xe]=y,t(c(c({},r),{},{request:l}))}));return function(e){return r.apply(this,arguments)}}())(l),tt)}})),this.middlewareStack.use((this.config,{applyToStack:e=>{e.addRelativeTo((e=>function(){var t=a((function*(t){var{request:n}=t;return b.isInstance(n)&&(delete n.headers[It],delete n.headers[At]),e(t)}));return function(e){return t.apply(this,arguments)}}()),Ut)}})),this.middlewareStack.use((e=>({applyToStack:t=>{t.add((e=>(t,n)=>function(){var r=a((function*(r){var i=yield e.retryStrategy(),o=yield e.maxAttempts();if(!(e=>void 0!==e.acquireInitialRetryToken&&void 0!==e.refreshRetryTokenForRetry&&void 0!==e.recordSuccess)(i))return null!=i&&i.mode&&(n.userAgent=[...n.userAgent||[],["cfg/retry-mode",i.mode]]),i.retry(t,r);var a,s=yield i.acquireInitialRetryToken(n.partition_id),c=new Error,u=0,l=0,{request:d}=r,p=b.isInstance(d);for(p&&(d.headers[It]=Lt());;)try{p&&(d.headers[At]="attempt=".concat(u+1,"; max=").concat(o));var{response:h,output:f}=yield t(r);return i.recordSuccess(s),f.$metadata.attempts=u+1,f.$metadata.totalRetryDelay=l,{response:h,output:f}}catch(e){var g,m=mn(e);if(c=(a=e)instanceof Error?a:a instanceof Object?Object.assign(new Error,a):"string"==typeof a?new Error(a):new Error("AWS SDK error wrapper for ".concat(a)),p&&gn(d))throw null!==(g=n.logger instanceof an?console:n.logger)&&void 0!==g&&g.warn("An error was encountered in a non-retryable streaming request."),c;try{s=yield i.refreshRetryTokenForRetry(s,m)}catch(e){throw c.$metadata||(c.$metadata={}),c.$metadata.attempts=u+1,c.$metadata.totalRetryDelay=l,c}u=s.getRetryCount();var v=s.getRetryDelay();l+=v,yield new Promise((e=>setTimeout(e,v)))}}));return function(e){return r.apply(this,arguments)}}())(e),yn)}}))(this.config)),this.middlewareStack.use((e=>({applyToStack:t=>{var n;t.add((n=e.bodyLengthChecker,e=>function(){var t=a((function*(t){var r=t.request;if(b.isInstance(r)){var{body:i,headers:o}=r;if(i&&-1===Object.keys(o).map((e=>e.toLowerCase())).indexOf(ot))try{var a=n(i);r.headers=c(c({},r.headers),{},{[ot]:String(a)})}catch(e){}}return e(c(c({},t),{},{request:r}))}));return function(e){return t.apply(this,arguments)}}()),at)}}))(this.config)),this.middlewareStack.use((e=>({applyToStack:t=>{t.add((e=>t=>function(){var n=a((function*(n){if(!b.isInstance(n.request))return t(n);var{request:r}=n,{handlerProtocol:i=""}=e.requestHandler.metadata||{};if(i.indexOf("h2")>=0&&!r.headers[":authority"])delete r.headers.host,r.headers[":authority"]=r.hostname+(r.port?":"+r.port:"");else if(!r.headers.host){var o=r.hostname;null!=r.port&&(o+=":".concat(r.port)),r.headers.host=o}return t(n)}));return function(e){return n.apply(this,arguments)}}())(e),E)}}))(this.config)),this.middlewareStack.use((this.config,{applyToStack:e=>{e.add(((e,t)=>function(){var n=a((function*(n){try{var o,a=yield e(n),{clientName:s,commandName:c,logger:u,dynamoDbDocumentClientOptions:l={}}=t,{overrideInputFilterSensitiveLog:d,overrideOutputFilterSensitiveLog:p}=l,h=null!=d?d:t.inputFilterSensitiveLog,f=null!=p?p:t.outputFilterSensitiveLog,g=a.output,{$metadata:m}=g,v=i(g,r);return null!=u&&null!==(o=u.info)&&void 0!==o&&o.call(u,{clientName:s,commandName:c,input:h(n.input),output:f(v),metadata:m}),a}catch(e){var y,{clientName:b,commandName:w,logger:E,dynamoDbDocumentClientOptions:C={}}=t,{overrideInputFilterSensitiveLog:S}=C,T=null!=S?S:t.inputFilterSensitiveLog;throw null!=E&&null!==(y=E.error)&&void 0!==y&&y.call(E,{clientName:b,commandName:w,input:T(n.input),error:e,metadata:e.$metadata}),e}}));return function(e){return n.apply(this,arguments)}}()),C)}})),this.middlewareStack.use((e=>({applyToStack:t=>{t.add((e=>t=>function(){var n=a((function*(n){var{request:r}=n;if(!b.isInstance(r)||"node"!==e.runtime||r.headers.hasOwnProperty(S))return t(n);var i=process.env.AWS_LAMBDA_FUNCTION_NAME,o=process.env._X_AMZN_TRACE_ID,a=e=>"string"==typeof e&&e.length>0;return a(i)&&a(o)&&(r.headers[S]=o),t(c(c({},n),{},{request:r}))}));return function(e){return n.apply(this,arguments)}}())(e),T)}}))(this.config)),this.middlewareStack.use(((e,t)=>{var{httpAuthSchemeParametersProvider:n,identityProviderConfigProvider:r}=t;return{applyToStack:t=>{t.addRelativeTo(((e,t)=>(n,r)=>function(){var i=a((function*(i){var o=e.httpAuthSchemeProvider(yield t.httpAuthSchemeParametersProvider(e,r,i.input)),a=function(e){var t=new Map;for(var n of e)t.set(n.schemeId,n);return t}(e.httpAuthSchemes),s=I(r),c=[];for(var u of o){var l,d=a.get(u.schemeId);if(d){var p=d.identityProvider(yield t.identityProviderConfigProvider(e));if(p){var{identityProperties:h={},signingProperties:f={}}=(null===(l=u.propertiesExtractor)||void 0===l?void 0:l.call(u,e,r))||{};u.identityProperties=Object.assign(u.identityProperties||{},h),u.signingProperties=Object.assign(u.signingProperties||{},f),s.selectedHttpAuthScheme={httpAuthOption:u,identity:yield p(u.identityProperties),signer:d.signer};break}c.push("HttpAuthScheme `".concat(u.schemeId,"` did not have an IdentityProvider configured."))}else c.push("HttpAuthScheme `".concat(u.schemeId,"` was not enabled for this service."))}if(!s.selectedHttpAuthScheme)throw new Error(c.join("\n"));return n(i)}));return function(e){return i.apply(this,arguments)}}())(e,{httpAuthSchemeParametersProvider:n,identityProviderConfigProvider:r}),k)}}})(this.config,{httpAuthSchemeParametersProvider:Xn,identityProviderConfigProvider:(d=a((function*(e){return new ye({"aws.auth#sigv4":e.credentials})})),function(e){return d.apply(this,arguments)})})),this.middlewareStack.use((this.config,{applyToStack:e=>{e.addRelativeTo(((e,t)=>function(){var n=a((function*(n){if(!b.isInstance(n.request))return e(n);var r=I(t).selectedHttpAuthScheme;if(!r)throw new Error("No HttpAuthScheme was selected: unable to sign request");var{httpAuthOption:{signingProperties:i={}},identity:o,signer:a}=r,s=yield e(c(c({},n),{},{request:yield a.sign(n.request,o,i)})).catch((a.errorHandler||P)(i));return(a.successHandler||R)(s.response,i),s}));return function(e){return n.apply(this,arguments)}}()),_)}}))}destroy(){super.destroy()}}var ii=(e,t)=>((e,t)=>fe(e,t).then((e=>t.utf8Encoder(e))))(e,t).then((e=>{if(e.length)try{return JSON.parse(e)}catch(t){throw"SyntaxError"===(null==t?void 0:t.name)&&Object.defineProperty(t,"$responseBodyText",{value:e}),t}return{}})),oi=function(){var e=a((function*(e,t){var n,r=yield ii(e,t);return r.message=null!==(n=r.message)&&void 0!==n?n:r.Message,r}));return function(t,n){return e.apply(this,arguments)}}();class ai extends Zt{constructor(e){super(e),Object.setPrototypeOf(this,ai.prototype)}}class si extends ai{constructor(e){super(c({name:"AccessDeniedException",$fault:"client"},e)),this.name="AccessDeniedException",this.$fault="client",Object.setPrototypeOf(this,si.prototype),this.Message=e.Message}}class ci extends ai{constructor(e){super(c({name:"InternalServerException",$fault:"server"},e)),this.name="InternalServerException",this.$fault="server",Object.setPrototypeOf(this,ci.prototype),this.Message=e.Message}}class ui extends ai{constructor(e){super(c({name:"ThrottlingException",$fault:"client"},e)),this.name="ThrottlingException",this.$fault="client",Object.setPrototypeOf(this,ui.prototype),this.Message=e.Message}}class li extends ai{constructor(e){super(c({name:"ValidationException",$fault:"client"},e)),this.name="ValidationException",this.$fault="client",Object.setPrototypeOf(this,li.prototype),this.Message=e.Message}}class di extends ai{constructor(e){super(c({name:"ConflictException",$fault:"client"},e)),this.name="ConflictException",this.$fault="client",Object.setPrototypeOf(this,di.prototype),this.Message=e.Message}}class pi extends ai{constructor(e){super(c({name:"ServiceQuotaExceededException",$fault:"client"},e)),this.name="ServiceQuotaExceededException",this.$fault="client",Object.setPrototypeOf(this,pi.prototype),this.Message=e.Message}}var hi={CONNECTION_CREDENTIALS:"CONNECTION_CREDENTIALS",WEBSOCKET:"WEBSOCKET"},fi={CONTACT:"CONTACT",CONTACT_FLOW:"CONTACT_FLOW",HIERARCHY_GROUP:"HIERARCHY_GROUP",HIERARCHY_LEVEL:"HIERARCHY_LEVEL",INSTANCE:"INSTANCE",PARTICIPANT:"PARTICIPANT",PHONE_NUMBER:"PHONE_NUMBER",USER:"USER"};class gi extends ai{constructor(e){super(c({name:"ResourceNotFoundException",$fault:"client"},e)),this.name="ResourceNotFoundException",this.$fault="client",Object.setPrototypeOf(this,gi.prototype),this.Message=e.Message,this.ResourceId=e.ResourceId,this.ResourceType=e.ResourceType}}var mi,vi={BACKWARD:"BACKWARD",FORWARD:"FORWARD"},yi={ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},bi={APPROVED:"APPROVED",IN_PROGRESS:"IN_PROGRESS",REJECTED:"REJECTED"},wi={AGENT:"AGENT",CUSTOMER:"CUSTOMER",CUSTOM_BOT:"CUSTOM_BOT",SUPERVISOR:"SUPERVISOR",SYSTEM:"SYSTEM"},Ei={ATTACHMENT:"ATTACHMENT",CHAT_ENDED:"CHAT_ENDED",CONNECTION_ACK:"CONNECTION_ACK",EVENT:"EVENT",MESSAGE:"MESSAGE",MESSAGE_DELIVERED:"MESSAGE_DELIVERED",MESSAGE_READ:"MESSAGE_READ",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",TRANSFER_FAILED:"TRANSFER_FAILED",TRANSFER_SUCCEEDED:"TRANSFER_SUCCEEDED",TYPING:"TYPING"},Ci=e=>c(c(c(c({},e),e.InputSchema&&{InputSchema:Vt}),e.Template&&{Template:Vt}),e.Actions&&{Actions:Vt}),Si=e=>c(c(c({},e),e.Name&&{Name:Vt}),e.Content&&{Content:Ci(e.Content)}),Ti=e=>c(c({},e),e.View&&{View:Si(e.View)}),Ii=function(){var e=a((function*(e,t){var n,r=me(e,t),i=sn({},rn,{"content-type":"application/json",[oo]:e[ro]});return r.bp("/participant/cancel-authentication"),n=JSON.stringify(un(e,{SessionId:[]})),r.m("POST").h(i).b(n),r.build()}));return function(t,n){return e.apply(this,arguments)}}(),Ai=function(){var e=a((function*(e,t){var n,r=me(e,t),i=sn({},rn,{"content-type":"application/json",[oo]:e[ro]});return r.bp("/participant/complete-attachment-upload"),n=JSON.stringify(un(e,{AttachmentIds:e=>fn(e),ClientToken:[!0,e=>null!=e?e:Lt()]})),r.m("POST").h(i).b(n),r.build()}));return function(t,n){return e.apply(this,arguments)}}(),ki=function(){var e=a((function*(e,t){var n,r=me(e,t),i=sn({},rn,{"content-type":"application/json",[oo]:e[io]});return r.bp("/participant/connection"),n=JSON.stringify(un(e,{ConnectParticipant:[],Type:e=>fn(e)})),r.m("POST").h(i).b(n),r.build()}));return function(t,n){return e.apply(this,arguments)}}(),Oi=function(){var e=a((function*(e,t){var n=me(e,t),r=sn({},rn,{[oo]:e[ro]});return n.bp("/participant/views/{ViewToken}"),n.p("ViewToken",(()=>e.ViewToken),"{ViewToken}",!1),n.m("GET").h(r).b(void 0),n.build()}));return function(t,n){return e.apply(this,arguments)}}(),Mi=function(){var e=a((function*(e,t){var n,r=me(e,t),i=sn({},rn,{"content-type":"application/json",[oo]:e[ro]});return r.bp("/participant/disconnect"),n=JSON.stringify(un(e,{ClientToken:[!0,e=>null!=e?e:Lt()]})),r.m("POST").h(i).b(n),r.build()}));return function(t,n){return e.apply(this,arguments)}}(),Ni=function(){var e=a((function*(e,t){var n,r=me(e,t),i=sn({},rn,{"content-type":"application/json",[oo]:e[ro]});return r.bp("/participant/attachment"),n=JSON.stringify(un(e,{AttachmentId:[],UrlExpiryInSeconds:[]})),r.m("POST").h(i).b(n),r.build()}));return function(t,n){return e.apply(this,arguments)}}(),Pi=function(){var e=a((function*(e,t){var n,r=me(e,t),i=sn({},rn,{"content-type":"application/json",[oo]:e[ro]});return r.bp("/participant/authentication-url"),n=JSON.stringify(un(e,{RedirectUri:[],SessionId:[]})),r.m("POST").h(i).b(n),r.build()}));return function(t,n){return e.apply(this,arguments)}}(),Ri=function(){var e=a((function*(e,t){var n,r=me(e,t),i=sn({},rn,{"content-type":"application/json",[oo]:e[ro]});return r.bp("/participant/transcript"),n=JSON.stringify(un(e,{ContactId:[],MaxResults:[],NextToken:[],ScanDirection:[],SortOrder:[],StartPosition:e=>fn(e)})),r.m("POST").h(i).b(n),r.build()}));return function(t,n){return e.apply(this,arguments)}}(),_i=function(){var e=a((function*(e,t){var n,r=me(e,t),i=sn({},rn,{"content-type":"application/json",[oo]:e[ro]});return r.bp("/participant/event"),n=JSON.stringify(un(e,{ClientToken:[!0,e=>null!=e?e:Lt()],Content:[],ContentType:[]})),r.m("POST").h(i).b(n),r.build()}));return function(t,n){return e.apply(this,arguments)}}(),Di=function(){var e=a((function*(e,t){var n,r=me(e,t),i=sn({},rn,{"content-type":"application/json",[oo]:e[ro]});return r.bp("/participant/message"),n=JSON.stringify(un(e,{ClientToken:[!0,e=>null!=e?e:Lt()],Content:[],ContentType:[]})),r.m("POST").h(i).b(n),r.build()}));return function(t,n){return e.apply(this,arguments)}}(),xi=function(){var e=a((function*(e,t){var n,r=me(e,t),i=sn({},rn,{"content-type":"application/json",[oo]:e[ro]});return r.bp("/participant/start-attachment-upload"),n=JSON.stringify(un(e,{AttachmentName:[],AttachmentSizeInBytes:[],ClientToken:[!0,e=>null!=e?e:Lt()],ContentType:[]})),r.m("POST").h(i).b(n),r.build()}));return function(t,n){return e.apply(this,arguments)}}(),Li=function(){var e=a((function*(e,t){if(200!==e.statusCode&&e.statusCode>=300)return $i(e,t);var n=sn({$metadata:no(e)});return yield fe(e.body,t),n}));return function(t,n){return e.apply(this,arguments)}}(),Ui=function(){var e=a((function*(e,t){if(200!==e.statusCode&&e.statusCode>=300)return $i(e,t);var n=sn({$metadata:no(e)});return yield fe(e.body,t),n}));return function(t,n){return e.apply(this,arguments)}}(),Fi=function(){var e=a((function*(e,t){if(200!==e.statusCode&&e.statusCode>=300)return $i(e,t);var n=sn({$metadata:no(e)}),r=Jt(Kt(yield ii(e.body,t)),"body"),i=un(r,{ConnectionCredentials:fn,Websocket:fn});return Object.assign(n,i),n}));return function(t,n){return e.apply(this,arguments)}}(),ji=function(){var e=a((function*(e,t){if(200!==e.statusCode&&e.statusCode>=300)return $i(e,t);var n=sn({$metadata:no(e)}),r=Jt(Kt(yield ii(e.body,t)),"body"),i=un(r,{View:fn});return Object.assign(n,i),n}));return function(t,n){return e.apply(this,arguments)}}(),Wi=function(){var e=a((function*(e,t){if(200!==e.statusCode&&e.statusCode>=300)return $i(e,t);var n=sn({$metadata:no(e)});return yield fe(e.body,t),n}));return function(t,n){return e.apply(this,arguments)}}(),Hi=function(){var e=a((function*(e,t){if(200!==e.statusCode&&e.statusCode>=300)return $i(e,t);var n=sn({$metadata:no(e)}),r=Jt(Kt(yield ii(e.body,t)),"body"),i=un(r,{AttachmentSizeInBytes:$t,Url:Yt,UrlExpiry:Yt});return Object.assign(n,i),n}));return function(t,n){return e.apply(this,arguments)}}(),Bi=function(){var e=a((function*(e,t){if(200!==e.statusCode&&e.statusCode>=300)return $i(e,t);var n=sn({$metadata:no(e)}),r=Jt(Kt(yield ii(e.body,t)),"body"),i=un(r,{AuthenticationUrl:Yt});return Object.assign(n,i),n}));return function(t,n){return e.apply(this,arguments)}}(),zi=function(){var e=a((function*(e,t){if(200!==e.statusCode&&e.statusCode>=300)return $i(e,t);var n=sn({$metadata:no(e)}),r=Jt(Kt(yield ii(e.body,t)),"body"),i=un(r,{InitialContactId:Yt,NextToken:Yt,Transcript:fn});return Object.assign(n,i),n}));return function(t,n){return e.apply(this,arguments)}}(),Gi=function(){var e=a((function*(e,t){if(200!==e.statusCode&&e.statusCode>=300)return $i(e,t);var n=sn({$metadata:no(e)}),r=Jt(Kt(yield ii(e.body,t)),"body"),i=un(r,{AbsoluteTime:Yt,Id:Yt});return Object.assign(n,i),n}));return function(t,n){return e.apply(this,arguments)}}(),qi=function(){var e=a((function*(e,t){if(200!==e.statusCode&&e.statusCode>=300)return $i(e,t);var n=sn({$metadata:no(e)}),r=Jt(Kt(yield ii(e.body,t)),"body"),i=un(r,{AbsoluteTime:Yt,Id:Yt});return Object.assign(n,i),n}));return function(t,n){return e.apply(this,arguments)}}(),Vi=function(){var e=a((function*(e,t){if(200!==e.statusCode&&e.statusCode>=300)return $i(e,t);var n=sn({$metadata:no(e)}),r=Jt(Kt(yield ii(e.body,t)),"body"),i=un(r,{AttachmentId:Yt,UploadMetadata:fn});return Object.assign(n,i),n}));return function(t,n){return e.apply(this,arguments)}}(),$i=function(){var e=a((function*(e,t){var n=c(c({},e),{},{body:yield oi(e.body,t)}),r=((e,t)=>{var n,r=e=>{var t=e;return"number"==typeof t&&(t=t.toString()),t.indexOf(",")>=0&&(t=t.split(",")[0]),t.indexOf(":")>=0&&(t=t.split(":")[0]),t.indexOf("#")>=0&&(t=t.split("#")[1]),t},i=(n=e.headers,Object.keys(n).find((e=>e.toLowerCase()==="x-amzn-errortype".toLowerCase())));return void 0!==i?r(e.headers[i]):void 0!==t.code?r(t.code):void 0!==t.__type?r(t.__type):void 0})(e,n.body);switch(r){case"AccessDeniedException":case"com.amazonaws.connectparticipant#AccessDeniedException":throw yield Ki(n,t);case"InternalServerException":case"com.amazonaws.connectparticipant#InternalServerException":throw yield Xi(n,t);case"ThrottlingException":case"com.amazonaws.connectparticipant#ThrottlingException":throw yield eo(n,t);case"ValidationException":case"com.amazonaws.connectparticipant#ValidationException":throw yield to(n,t);case"ConflictException":case"com.amazonaws.connectparticipant#ConflictException":throw yield Yi(n,t);case"ServiceQuotaExceededException":case"com.amazonaws.connectparticipant#ServiceQuotaExceededException":throw yield Zi(n,t);case"ResourceNotFoundException":case"com.amazonaws.connectparticipant#ResourceNotFoundException":throw yield Qi(n,t);default:var i=n.body;return Ji({output:e,parsedBody:i,errorCode:r})}}));return function(t,n){return e.apply(this,arguments)}}(),Ji=(mi=ai,e=>{var{output:t,parsedBody:n,errorCode:r}=e;(e=>{var{output:t,parsedBody:n,exceptionCtor:r,errorCode:i}=e,o=((e,t,n)=>({httpStatusCode:e.statusCode,requestId:null!==(t=null!==(n=e.headers["x-amzn-requestid"])&&void 0!==n?n:e.headers["x-amzn-request-id"])&&void 0!==t?t:e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}))(t),a=o.httpStatusCode?o.httpStatusCode+"":void 0,s=new r({name:(null==n?void 0:n.code)||(null==n?void 0:n.Code)||i||a||"UnknownError",$fault:"client",$metadata:o});throw en(s,n)})({output:t,parsedBody:n,exceptionCtor:mi,errorCode:r})}),Ki=function(){var e=a((function*(e,t){var n=sn({}),r=e.body,i=un(r,{Message:Yt});Object.assign(n,i);var o=new si(c({$metadata:no(e)},n));return en(o,e.body)}));return function(t,n){return e.apply(this,arguments)}}(),Yi=function(){var e=a((function*(e,t){var n=sn({}),r=e.body,i=un(r,{Message:Yt});Object.assign(n,i);var o=new di(c({$metadata:no(e)},n));return en(o,e.body)}));return function(t,n){return e.apply(this,arguments)}}(),Xi=function(){var e=a((function*(e,t){var n=sn({}),r=e.body,i=un(r,{Message:Yt});Object.assign(n,i);var o=new ci(c({$metadata:no(e)},n));return en(o,e.body)}));return function(t,n){return e.apply(this,arguments)}}(),Qi=function(){var e=a((function*(e,t){var n=sn({}),r=e.body,i=un(r,{Message:Yt,ResourceId:Yt,ResourceType:Yt});Object.assign(n,i);var o=new gi(c({$metadata:no(e)},n));return en(o,e.body)}));return function(t,n){return e.apply(this,arguments)}}(),Zi=function(){var e=a((function*(e,t){var n=sn({}),r=e.body,i=un(r,{Message:Yt});Object.assign(n,i);var o=new pi(c({$metadata:no(e)},n));return en(o,e.body)}));return function(t,n){return e.apply(this,arguments)}}(),eo=function(){var e=a((function*(e,t){var n=sn({}),r=e.body,i=un(r,{Message:Yt});Object.assign(n,i);var o=new ui(c({$metadata:no(e)},n));return en(o,e.body)}));return function(t,n){return e.apply(this,arguments)}}(),to=function(){var e=a((function*(e,t){var n=sn({}),r=e.body,i=un(r,{Message:Yt});Object.assign(n,i);var o=new li(c({$metadata:no(e)},n));return en(o,e.body)}));return function(t,n){return e.apply(this,arguments)}}(),no=e=>{var t,n;return{httpStatusCode:e.statusCode,requestId:null!==(t=null!==(n=e.headers["x-amzn-requestid"])&&void 0!==n?n:e.headers["x-amzn-request-id"])&&void 0!==t?t:e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}},ro="ConnectionToken",io="ParticipantToken",oo="x-amz-bearer";class ao extends(Gt.classBuilder().ep(Zn).m((function(e,t,n,r){return[N(n,this.serialize,this.deserialize),mt(n,e.getEndpointParameterInstructions())]})).s("AmazonConnectParticipantServiceLambda","CancelParticipantAuthentication",{}).n("ConnectParticipantClient","CancelParticipantAuthenticationCommand").f(void 0,void 0).ser(Ii).de(Li).build()){}class so extends(Gt.classBuilder().ep(Zn).m((function(e,t,n,r){return[N(n,this.serialize,this.deserialize),mt(n,e.getEndpointParameterInstructions())]})).s("AmazonConnectParticipantServiceLambda","CompleteAttachmentUpload",{}).n("ConnectParticipantClient","CompleteAttachmentUploadCommand").f(void 0,void 0).ser(Ai).de(Ui).build()){}class co extends(Gt.classBuilder().ep(Zn).m((function(e,t,n,r){return[N(n,this.serialize,this.deserialize),mt(n,e.getEndpointParameterInstructions())]})).s("AmazonConnectParticipantServiceLambda","CreateParticipantConnection",{}).n("ConnectParticipantClient","CreateParticipantConnectionCommand").f(void 0,void 0).ser(ki).de(Fi).build()){}class uo extends(Gt.classBuilder().ep(Zn).m((function(e,t,n,r){return[N(n,this.serialize,this.deserialize),mt(n,e.getEndpointParameterInstructions())]})).s("AmazonConnectParticipantServiceLambda","DescribeView",{}).n("ConnectParticipantClient","DescribeViewCommand").f(void 0,Ti).ser(Oi).de(ji).build()){}class lo extends(Gt.classBuilder().ep(Zn).m((function(e,t,n,r){return[N(n,this.serialize,this.deserialize),mt(n,e.getEndpointParameterInstructions())]})).s("AmazonConnectParticipantServiceLambda","DisconnectParticipant",{}).n("ConnectParticipantClient","DisconnectParticipantCommand").f(void 0,void 0).ser(Mi).de(Wi).build()){}class po extends(Gt.classBuilder().ep(Zn).m((function(e,t,n,r){return[N(n,this.serialize,this.deserialize),mt(n,e.getEndpointParameterInstructions())]})).s("AmazonConnectParticipantServiceLambda","GetAttachment",{}).n("ConnectParticipantClient","GetAttachmentCommand").f(void 0,void 0).ser(Ni).de(Hi).build()){}class ho extends(Gt.classBuilder().ep(Zn).m((function(e,t,n,r){return[N(n,this.serialize,this.deserialize),mt(n,e.getEndpointParameterInstructions())]})).s("AmazonConnectParticipantServiceLambda","GetAuthenticationUrl",{}).n("ConnectParticipantClient","GetAuthenticationUrlCommand").f(void 0,void 0).ser(Pi).de(Bi).build()){}class fo extends(Gt.classBuilder().ep(Zn).m((function(e,t,n,r){return[N(n,this.serialize,this.deserialize),mt(n,e.getEndpointParameterInstructions())]})).s("AmazonConnectParticipantServiceLambda","GetTranscript",{}).n("ConnectParticipantClient","GetTranscriptCommand").f(void 0,void 0).ser(Ri).de(zi).build()){}class go extends(Gt.classBuilder().ep(Zn).m((function(e,t,n,r){return[N(n,this.serialize,this.deserialize),mt(n,e.getEndpointParameterInstructions())]})).s("AmazonConnectParticipantServiceLambda","SendEvent",{}).n("ConnectParticipantClient","SendEventCommand").f(void 0,void 0).ser(_i).de(Gi).build()){}class mo extends(Gt.classBuilder().ep(Zn).m((function(e,t,n,r){return[N(n,this.serialize,this.deserialize),mt(n,e.getEndpointParameterInstructions())]})).s("AmazonConnectParticipantServiceLambda","SendMessage",{}).n("ConnectParticipantClient","SendMessageCommand").f(void 0,void 0).ser(Di).de(qi).build()){}class vo extends(Gt.classBuilder().ep(Zn).m((function(e,t,n,r){return[N(n,this.serialize,this.deserialize),mt(n,e.getEndpointParameterInstructions())]})).s("AmazonConnectParticipantServiceLambda","StartAttachmentUpload",{}).n("ConnectParticipantClient","StartAttachmentUploadCommand").f(void 0,void 0).ser(xi).de(Vi).build()){}var yo={CancelParticipantAuthenticationCommand:ao,CompleteAttachmentUploadCommand:so,CreateParticipantConnectionCommand:co,DescribeViewCommand:uo,DisconnectParticipantCommand:lo,GetAttachmentCommand:po,GetAuthenticationUrlCommand:ho,GetTranscriptCommand:fo,SendEventCommand:go,SendMessageCommand:mo,StartAttachmentUploadCommand:vo};class bo extends ri{}((e,t)=>{var n=function(){var n=e[r],i=function(){var e=a((function*(e,t,r){var i=new n(e);if("function"==typeof t)this.send(i,t);else{if("function"!=typeof r)return this.send(i,t);if("object"!=typeof t)throw new Error("Expected http options but got "+typeof t);this.send(i,t||{},r)}}));return function(t,n,r){return e.apply(this,arguments)}}(),o=(r[0].toLowerCase()+r.slice(1)).replace(/Command$/,"");t.prototype[o]=i};for(var r of Object.keys(e))n()})(yo,bo);var wo,Eo,Co,So=(wo=ri,Eo=fo,Co="MaxResults",function(){var e=function(e){return function(){return new d(e.apply(this,arguments))}}((function*(e,t){for(var n,r=e.startingToken||void 0,i=!0,o=arguments.length,a=new Array(o>2?o-2:0),s=2;s<o;s++)a[s-2]=arguments[s];for(;i;){var c;if(t.NextToken=r,Co&&(t[Co]=null!==(c=t[Co])&&void 0!==c?c:e.pageSize),!(e.client instanceof wo))throw new Error("Invalid client, expected instance of ".concat(wo.name));n=yield l(x(Eo,e.client,t,...a)),yield n;var u=r;i=!(!(r=L(n,"NextToken"))||e.stopOnSameToken&&r===u)}}));return function(t,n){return e.apply(this,arguments)}}())})(),s})(),e.exports=t()},858:e=>{var t="Expected a function",n=NaN,r="[object Symbol]",i=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,c=parseInt,u="object"==typeof global&&global&&global.Object===Object&&global,l="object"==typeof self&&self&&self.Object===Object&&self,d=u||l||Function("return this")(),p=Object.prototype.toString,h=Math.max,f=Math.min,g=function(){return d.Date.now()};function m(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function v(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&p.call(e)==r}(e))return n;if(m(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=m(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(i,"");var u=a.test(e);return u||s.test(e)?c(e.slice(2),u?2:8):o.test(e)?n:+e}e.exports=function(e,n,r){var i=!0,o=!0;if("function"!=typeof e)throw new TypeError(t);return m(r)&&(i="leading"in r?!!r.leading:i,o="trailing"in r?!!r.trailing:o),function(e,n,r){var i,o,a,s,c,u,l=0,d=!1,p=!1,y=!0;if("function"!=typeof e)throw new TypeError(t);function b(t){var n=i,r=o;return i=o=void 0,l=t,s=e.apply(r,n)}function w(e){var t=e-u;return void 0===u||t>=n||t<0||p&&e-l>=a}function E(){var e=g();if(w(e))return C(e);c=setTimeout(E,function(e){var t=n-(e-u);return p?f(t,a-(e-l)):t}(e))}function C(e){return c=void 0,y&&i?b(e):(i=o=void 0,s)}function S(){var e=g(),t=w(e);if(i=arguments,o=this,u=e,t){if(void 0===c)return function(e){return l=e,c=setTimeout(E,n),d?b(e):s}(u);if(p)return c=setTimeout(E,n),b(u)}return void 0===c&&(c=setTimeout(E,n)),s}return n=v(n)||0,m(r)&&(d=!!r.leading,a=(p="maxWait"in r)?h(v(r.maxWait)||0,n):a,y="trailing"in r?!!r.trailing:y),S.cancel=function(){void 0!==c&&clearTimeout(c),l=0,i=u=o=c=void 0},S.flush=function(){return void 0===c?s:C(g())},S}(e,n,{leading:i,maxWait:n,trailing:o})}},604:(e,t,n)=>{var r;!function(){"use strict";var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function o(e){return function(e,t){var n,r,a,s,c,u,l,d,p,h=1,f=e.length,g="";for(r=0;r<f;r++)if("string"==typeof e[r])g+=e[r];else if("object"==typeof e[r]){if((s=e[r]).keys)for(n=t[h],a=0;a<s.keys.length;a++){if(null==n)throw new Error(o('[sprintf] Cannot access property "%s" of undefined value "%s"',s.keys[a],s.keys[a-1]));n=n[s.keys[a]]}else n=s.param_no?t[s.param_no]:t[h++];if(i.not_type.test(s.type)&&i.not_primitive.test(s.type)&&n instanceof Function&&(n=n()),i.numeric_arg.test(s.type)&&"number"!=typeof n&&isNaN(n))throw new TypeError(o("[sprintf] expecting number but found %T",n));switch(i.number.test(s.type)&&(d=n>=0),s.type){case"b":n=parseInt(n,10).toString(2);break;case"c":n=String.fromCharCode(parseInt(n,10));break;case"d":case"i":n=parseInt(n,10);break;case"j":n=JSON.stringify(n,null,s.width?parseInt(s.width):0);break;case"e":n=s.precision?parseFloat(n).toExponential(s.precision):parseFloat(n).toExponential();break;case"f":n=s.precision?parseFloat(n).toFixed(s.precision):parseFloat(n);break;case"g":n=s.precision?String(Number(n.toPrecision(s.precision))):parseFloat(n);break;case"o":n=(parseInt(n,10)>>>0).toString(8);break;case"s":n=String(n),n=s.precision?n.substring(0,s.precision):n;break;case"t":n=String(!!n),n=s.precision?n.substring(0,s.precision):n;break;case"T":n=Object.prototype.toString.call(n).slice(8,-1).toLowerCase(),n=s.precision?n.substring(0,s.precision):n;break;case"u":n=parseInt(n,10)>>>0;break;case"v":n=n.valueOf(),n=s.precision?n.substring(0,s.precision):n;break;case"x":n=(parseInt(n,10)>>>0).toString(16);break;case"X":n=(parseInt(n,10)>>>0).toString(16).toUpperCase()}i.json.test(s.type)?g+=n:(!i.number.test(s.type)||d&&!s.sign?p="":(p=d?"+":"-",n=n.toString().replace(i.sign,"")),u=s.pad_char?"0"===s.pad_char?"0":s.pad_char.charAt(1):" ",l=s.width-(p+n).length,c=s.width&&l>0?u.repeat(l):"",g+=s.align?p+n+c:"0"===u?p+c+n:c+p+n)}return g}(function(e){if(s[e])return s[e];for(var t,n=e,r=[],o=0;n;){if(null!==(t=i.text.exec(n)))r.push(t[0]);else if(null!==(t=i.modulo.exec(n)))r.push("%");else{if(null===(t=i.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){o|=1;var a=[],c=t[2],u=[];if(null===(u=i.key.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(a.push(u[1]);""!==(c=c.substring(u[0].length));)if(null!==(u=i.key_access.exec(c)))a.push(u[1]);else{if(null===(u=i.index_access.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");a.push(u[1])}t[2]=a}else o|=2;if(3===o)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}n=n.substring(t[0].length)}return s[e]=r}(e),arguments)}function a(e,t){return o.apply(null,[e].concat(t||[]))}var s=Object.create(null);t.sprintf=o,t.vsprintf=a,"undefined"!=typeof window&&(window.sprintf=o,window.vsprintf=a,void 0===(r=function(){return{sprintf:o,vsprintf:a}}.call(t,n,t,e))||(e.exports=r))}()}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";class e extends Error{constructor(e){super(e),this.name="ValueError"}}class t extends Error{constructor(e){super(e),this.name="UnImplementedMethod"}}class r extends Error{constructor(e,t){super(e),this.name="IllegalArgument",this.argument=t}}Error,Error;var i=n(639),o="MESSAGE_RECEIPTS_ENABLED",a={AGENT:"AGENT",CUSTOMER:"CUSTOMER"},s="API",c={SEND_MESSAGE:"SendMessage",SEND_ATTACHMENT:"SendAttachment",DOWNLOAD_ATTACHMENT:"DownloadAttachment",SEND_EVENT:"SendEvent",GET_TRANSCRIPT:"GetTranscript",DISCONNECT_PARTICIPANT:"DisconnectParticipant",CREATE_PARTICIPANT_CONNECTION:"CreateParticipantConnection",DESCRIBE_VIEW:"DescribeView"},u="InitWebsocket",l={INCOMING_MESSAGE:"INCOMING_MESSAGE",INCOMING_TYPING:"INCOMING_TYPING",INCOMING_READ_RECEIPT:"INCOMING_READ_RECEIPT",INCOMING_DELIVERED_RECEIPT:"INCOMING_DELIVERED_RECEIPT",CONNECTION_ESTABLISHED:"CONNECTION_ESTABLISHED",CONNECTION_LOST:"CONNECTION_LOST",CONNECTION_BROKEN:"CONNECTION_BROKEN",CONNECTION_ACK:"CONNECTION_ACK",CHAT_ENDED:"CHAT_ENDED",MESSAGE_METADATA:"MESSAGEMETADATA",PARTICIPANT_IDLE:"PARTICIPANT_IDLE",PARTICIPANT_RETURNED:"PARTICIPANT_RETURNED",PARTICIPANT_INVITED:"PARTICIPANT_INVITED",AUTODISCONNECTION:"AUTODISCONNECTION",DEEP_HEARTBEAT_SUCCESS:"DEEP_HEARTBEAT_SUCCESS",DEEP_HEARTBEAT_FAILURE:"DEEP_HEARTBEAT_FAILURE",AUTHENTICATION_INITIATED:"AUTHENTICATION_INITIATED",AUTHENTICATION_SUCCESSFUL:"AUTHENTICATION_SUCCESSFUL",AUTHENTICATION_FAILED:"AUTHENTICATION_FAILED",AUTHENTICATION_TIMEOUT:"AUTHENTICATION_TIMEOUT",AUTHENTICATION_EXPIRED:"AUTHENTICATION_EXPIRED",AUTHENTICATION_CANCELED:"AUTHENTICATION_CANCELED",PARTICIPANT_DISPLAY_NAME_UPDATED:"PARTICIPANT_DISPLAY_NAME_UPDATED",CHAT_REHYDRATED:"CHAT_REHYDRATED"},d={textPlain:"text/plain",textMarkdown:"text/markdown",textCsv:"text/csv",applicationDoc:"application/msword",applicationDocx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",applicationJson:"application/json",applicationPdf:"application/pdf",applicationPpt:"application/vnd.ms-powerpoint",applicationPptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",applicationXls:"application/vnd.ms-excel",applicationXlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",authenticationInitiated:"application/vnd.amazonaws.connect.event.authentication.initiated",authenticationSuccessful:"application/vnd.amazonaws.connect.event.authentication.succeeded",authenticationFailed:"application/vnd.amazonaws.connect.event.authentication.failed",authenticationTimeout:"application/vnd.amazonaws.connect.event.authentication.timeout",authenticationExpired:"application/vnd.amazonaws.connect.event.authentication.expired",authenticationCanceled:"application/vnd.amazonaws.connect.event.authentication.cancelled",participantDisplayNameUpdated:"application/vnd.amazonaws.connect.event.participant.displayname.updated",imageJpg:"image/jpeg",imagePng:"image/png",audioWav:"audio/wav",audioXWav:"audio/x-wav",audioVndWave:"audio/vnd.wave",connectionAcknowledged:"application/vnd.amazonaws.connect.event.connection.acknowledged",typing:"application/vnd.amazonaws.connect.event.typing",participantJoined:"application/vnd.amazonaws.connect.event.participant.joined",participantLeft:"application/vnd.amazonaws.connect.event.participant.left",participantActive:"application/vnd.amazonaws.connect.event.participant.active",participantInactive:"application/vnd.amazonaws.connect.event.participant.inactive",transferSucceeded:"application/vnd.amazonaws.connect.event.transfer.succeeded",transferFailed:"application/vnd.amazonaws.connect.event.transfer.failed",chatEnded:"application/vnd.amazonaws.connect.event.chat.ended",interactiveMessage:"application/vnd.amazonaws.connect.message.interactive",interactiveMessageResponse:"application/vnd.amazonaws.connect.message.interactive.response",readReceipt:"application/vnd.amazonaws.connect.event.message.read",deliveredReceipt:"application/vnd.amazonaws.connect.event.message.delivered",participantIdle:"application/vnd.amazonaws.connect.event.participant.idle",participantReturned:"application/vnd.amazonaws.connect.event.participant.returned",participantInvited:"application/vnd.amazonaws.connect.event.participant.invited",autoDisconnection:"application/vnd.amazonaws.connect.event.participant.autodisconnection",chatRehydrated:"application/vnd.amazonaws.connect.event.chat.rehydrated"},p={[d.typing]:l.INCOMING_TYPING,[d.readReceipt]:l.INCOMING_READ_RECEIPT,[d.deliveredReceipt]:l.INCOMING_DELIVERED_RECEIPT,[d.participantIdle]:l.PARTICIPANT_IDLE,[d.authenticationInitiated]:l.AUTHENTICATION_INITIATED,[d.authenticationSuccessful]:l.AUTHENTICATION_SUCCESSFUL,[d.authenticationFailed]:l.AUTHENTICATION_FAILED,[d.authenticationTimeout]:l.AUTHENTICATION_TIMEOUT,[d.authenticationExpired]:l.AUTHENTICATION_EXPIRED,[d.authenticationCanceled]:l.AUTHENTICATION_CANCELED,[d.participantDisplayNameUpdated]:l.PARTICIPANT_DISPLAY_NAME_UPDATED,[d.participantReturned]:l.PARTICIPANT_RETURNED,[d.participantInvited]:l.PARTICIPANT_INVITED,[d.autoDisconnection]:l.AUTODISCONNECTION,[d.chatRehydrated]:l.CHAT_REHYDRATED,default:l.INCOMING_MESSAGE},h=3540,f={AbsoluteTime:"",ContentType:"application/vnd.amazonaws.connect.event.chat.ended",Id:"",Type:"EVENT",InitialContactId:""},g=n(604),m={assertTrue:function(t,n){if(!t)throw new e(n)},assertNotNull:function(e,t){return m.assertTrue(null!=e,(0,g.sprintf)("%s must be provided",t||"A value")),e},now:function(){return(new Date).getTime()},isString:function(e){return"string"==typeof e},randomId:function(){return(0,g.sprintf)("%s-%s",m.now(),Math.random().toString(36).slice(2))},assertIsNonEmptyString:function(e,t){if(!e||"string"!=typeof e)throw new r(t+" is not a non-empty string!")},assertIsList:function(e,t){if(!Array.isArray(e))throw new r(t+" is not an array")},assertIsEnum:function(e,t,n){var i;for(i=0;i<t.length;i++)if(t[i]===e)return;throw new r(n+" passed ("+e+") is not valid. Allowed values are: "+t)},makeEnum:function(e){var t={};return e.forEach((function(e){var n=e.replace(/\.?([a-z]+)_?/g,(function(e,t){return t.toUpperCase()+"_"})).replace(/_$/,"");t[n]=e})),t},contains:function(e,t){return e instanceof Array?null!==m.find(e,(function(e){return e===t})):t in e},find:function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return e[n];return null},containsValue:function(e,t){return e instanceof Array?null!==m.find(e,(function(e){return e===t})):null!==m.find(m.values(e),(function(e){return e===t}))},isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},values:function(e){var t=[];for(var n in m.assertNotNull(e,"map"),e)t.push(e[n]);return t},isObject:function(e){return!("object"!=typeof e||null===e)},assertIsObject:function(e,t){if(!m.isObject(e))throw new r(t+" is not an object!")},delay:e=>new Promise((t=>setTimeout(t,e))),asyncWhileInterval:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=new Date;return t(r)?e(r).catch((i=>{var a=Math.max(0,n-(new Date).valueOf()+o.valueOf());return m.delay(a).then((()=>m.asyncWhileInterval(e,t,n,r+1,i)))})):Promise.reject(i||new Error("async while aborted"))},isAttachmentContentType:function(e){return e===d.applicationPdf||e===d.imageJpg||e===d.imagePng||e===d.applicationDoc||e===d.applicationXls||e===d.applicationPpt||e===d.textCsv||e===d.audioWav}};const v=m;var y={DEBUG:10,INFO:20,WARN:30,ERROR:40,ADVANCED_LOG:50},b=new class{constructor(){this.updateLoggerConfig()}writeToClientLogger(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.hasClientLogger()){var r="string"==typeof t?t:JSON.stringify(t,C()),i="string"==typeof n?n:JSON.stringify(n,C()),o="".concat(function(e){switch(e){case 10:return"DEBUG";case 20:return"INFO";case 30:return"WARN";case 40:return"ERROR";case 50:return"ADVANCED_LOG"}}(e)," ").concat(r," ").concat(i);switch(e){case y.DEBUG:return this._clientLogger.debug(o)||o;case y.INFO:return this._clientLogger.info(o)||o;case y.WARN:return this._clientLogger.warn(o)||o;case y.ERROR:return this._clientLogger.error(o)||o;case y.ADVANCED_LOG:return this._advancedLogWriter&&this._clientLogger[this._advancedLogWriter](o)||o}}}isLevelEnabled(e){return e>=this._level}hasClientLogger(){return null!==this._clientLogger}getLogger(){return new E(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}updateLoggerConfig(e){var t=e||{};this._level=t.level||y.INFO,this._advancedLogWriter="warn",function(e,t){var n=t&&Object.keys(t);if(n&&-1===n.indexOf(e))return console.error("customizedLogger: incorrect value for loggerConfig:advancedLogWriter; use valid values from list ".concat(n," but used ").concat(e)),!1;var r=["warn","info","debug","log"];return!e||-1!==r.indexOf(e)||(console.error("incorrect value for loggerConfig:advancedLogWriter; use valid values from list ".concat(r," but used ").concat(e)),!1)}(t.advancedLogWriter,t.customizedLogger)&&(this._advancedLogWriter=t.advancedLogWriter),(t.customizedLogger&&"object"==typeof t.customizedLogger||t.logger&&"object"==typeof t.logger)&&(this.useClientLogger=!0),this._clientLogger=this.selectLogger(t)}selectLogger(e){return e.customizedLogger&&"object"==typeof e.customizedLogger?e.customizedLogger:e.logger&&"object"==typeof e.logger?e.logger:e.useDefaultLogger?S():null}};class w{debug(){}info(){}warn(){}error(){}}class E extends w{constructor(e){super(),this.options=e||{}}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this._log(y.DEBUG,t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this._log(y.INFO,t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this._log(y.WARN,t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this._log(y.ERROR,t)}advancedLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this._log(y.ADVANCED_LOG,t)}_shouldLog(e){return b.hasClientLogger()&&b.isLevelEnabled(e)}_writeToClientLogger(e,t){var n;return b.writeToClientLogger(e,t,null===(n=this.options)||void 0===n?void 0:n.logMetaData)}_log(e,t){if(this._shouldLog(e)){var n=b.useClientLogger?t:this._convertToSingleStatement(t);return this._writeToClientLogger(e,n)}}_convertToSingleStatement(e){var t=new Date(Date.now()).toISOString(),n="[".concat(t,"]");this.options&&(this.options.prefix?n+=" "+this.options.prefix+":":n+="");for(var r=0;r<e.length;r++){var i=e[r];n+=" "+this._convertToString(i)}return n}_convertToString(e){try{if(!e)return"";if(v.isString(e))return e;if(v.isObject(e)&&v.isFunction(e.toString)){var t=e.toString();if("[object Object]"!==t)return t}return JSON.stringify(e)}catch(t){return console.error("Error while converting argument to string",e,t),""}}}function C(){var e=new WeakSet;return(t,n)=>{if("object"==typeof n&&null!==n){if(e.has(n))return;e.add(n)}return n}}var S=()=>{var e=new w;return e.debug=console.debug.bind(window.console),e.info=console.info.bind(window.console),e.warn=console.warn.bind(window.console),e.error=console.error.bind(window.console),e},T=new class{constructor(){this.stage="prod",this.region="us-west-2",this.regionOverride="",this.cell="1",this.reconnect=!0;var e=this;this.logger=b.getLogger({prefix:"ChatJS-GlobalConfig"}),this.features=new Proxy([],{set:(t,n,r)=>{"test-stage2"!==this.stage&&this.logger.info("new features added, initialValue: "+t[n]+" , newValue: "+r,Array.isArray(t[n]));var i=t[n];return Array.isArray(r)&&r.forEach((t=>{Array.isArray(i)&&-1===i.indexOf(t)&&Array.isArray(e.featureChangeListeners[t])&&(e.featureChangeListeners[t].forEach((e=>e())),e._cleanFeatureChangeListener(t))})),t[n]=r,!0}}),this.setFeatureFlag(o),this.messageReceiptThrottleTime=5e3,this.featureChangeListeners=[],this.customUserAgentSuffix=""}update(e){var t=e||{};this.stage=t.stage||this.stage,this.region=t.region||this.region,this.cell=t.cell||this.cell,this.endpointOverride=t.endpoint||this.endpointOverride,this.reconnect=!1!==t.reconnect&&this.reconnect,this.messageReceiptThrottleTime=t.throttleTime?t.throttleTime:5e3;var n=Array.isArray(t.features)?t.features:this.features.values;this.features.values=Array.isArray(n)?[...n]:new Array,this.customUserAgentSuffix=t.customUserAgentSuffix||this.customUserAgentSuffix}updateStageRegionCell(e){e&&(this.stage=e.stage||this.stage,this.region=e.region||this.region,this.cell=e.cell||this.cell)}getCell(){return this.cell}updateThrottleTime(e){this.messageReceiptThrottleTime=e||this.messageReceiptThrottleTime}updateRegionOverride(e){this.regionOverride=e}getMessageReceiptsThrottleTime(){return this.messageReceiptThrottleTime}getStage(){return this.stage}getRegion(){return this.region}getRegionOverride(){return this.regionOverride}getCustomUserAgentSuffix(){return this.customUserAgentSuffix}getEndpointOverride(){return this.endpointOverride}removeFeatureFlag(e){if(this.isFeatureEnabled(e)){var t=this.features.values.indexOf(e);this.features.values.splice(t,1)}}setFeatureFlag(e){if(!this.isFeatureEnabled(e)){var t=Array.isArray(this.features.values)?this.features.values:[];this.features.values=[...t,e]}}_registerFeatureChangeListener(e,t){this.featureChangeListeners[e]||(this.featureChangeListeners[e]=[]),this.featureChangeListeners[e].push(t)}_cleanFeatureChangeListener(e){delete this.featureChangeListeners[e]}isFeatureEnabled(e,t){return Array.isArray(this.features.values)&&-1!==this.features.values.indexOf(e)?"function"!=typeof t||t():("function"==typeof t&&this._registerFeatureChangeListener(e,t),!1)}},I=n(858),A=n.n(I);const k=JSON.parse('{"UU":"amazon-connect-chatjs","rE":"3.1.0","Jk":{"type":"git","url":"git+https://github.com/amazon-connect/amazon-connect-chatjs.git"}}');function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){N(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function N(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class P{sendMessage(e,n,r){throw new t("sendTextMessage in ChatClient")}sendAttachment(e,n,r){throw new t("sendAttachment in ChatClient")}downloadAttachment(e,n){throw new t("downloadAttachment in ChatClient")}disconnectParticipant(e){throw new t("disconnectParticipant in ChatClient")}sendEvent(e,n,r){throw new t("sendEvent in ChatClient")}createParticipantConnection(e,n){throw new t("createParticipantConnection in ChatClient")}describeView(){throw new t("describeView in ChatClient")}getAuthenticationUrl(){throw new t("getAuthenticationUrl in ChatClient")}cancelParticipantAuthentication(){throw new t("cancelParticipantAuthentication in ChatClient")}}class R extends P{constructor(e){super(),N(this,"throttleEvent",A()(((e,t,n)=>this._submitEvent(e,t,n)),1e4,{trailing:!1,leading:!0}));var t=e.customUserAgentSuffix?"AmazonConnect-ChatJS/".concat(k.rE," ").concat(e.customUserAgentSuffix):"AmazonConnect-ChatJS/".concat(k.rE);this.chatClient=new i.ConnectParticipantClient({credentials:{accessKeyId:"",secretAccessKey:""},endpoint:e.endpoint,region:e.region,customUserAgent:t}),this.invokeUrl=e.endpoint,this.logger=b.getLogger({prefix:"Amazon-Connect-ChatJS-ChatClient",logMetaData:e.logMetaData})}describeView(e,t){var n=this,r={ViewToken:e,ConnectionToken:t},o=new i.DescribeViewCommand(r);return n._sendRequest(o).then((e=>{var t,r;return null===(t=n.logger.info("Successful describe view request"))||void 0===t||null===(r=t.sendInternalLogToServer)||void 0===r||r.call(t),e})).catch((e=>{var t,r;return null===(t=n.logger.error("describeView gave an error response",e))||void 0===t||null===(r=t.sendInternalLogToServer)||void 0===r||r.call(t),Promise.reject(e)}))}cancelParticipantAuthentication(e,t){var n=this,r={ConnectionToken:e,SessionId:t},o=new i.CancelParticipantAuthenticationCommand(r);return n._sendRequest(o).then((e=>{var t,r;return null===(t=n.logger.info("Successful getAuthenticationUrl request"))||void 0===t||null===(r=t.sendInternalLogToServer)||void 0===r||r.call(t),e})).catch((e=>{var t,r;return null===(t=n.logger.error("getAuthenticationUrl gave an error response",e))||void 0===t||null===(r=t.sendInternalLogToServer)||void 0===r||r.call(t),Promise.reject(e)}))}getAuthenticationUrl(e,t,n){var r=this,o={RedirectUri:t,SessionId:n,ConnectionToken:e},a=new i.GetAuthenticationUrlCommand(o);return r._sendRequest(a).then((e=>{var t,n;return null===(t=r.logger.info("Successful getAuthenticationUrl request"))||void 0===t||null===(n=t.sendInternalLogToServer)||void 0===n||n.call(t),e})).catch((e=>{var t,n;return null===(t=r.logger.error("getAuthenticationUrl gave an error response",e))||void 0===t||null===(n=t.sendInternalLogToServer)||void 0===n||n.call(t),Promise.reject(e)}))}createParticipantConnection(e,t,n){var r=this,o={ParticipantToken:e,Type:t,ConnectParticipant:n},a=new i.CreateParticipantConnectionCommand(o);return r._sendRequest(a).then((e=>{var t,n;return null===(t=r.logger.info("Successfully create connection request"))||void 0===t||null===(n=t.sendInternalLogToServer)||void 0===n||n.call(t),e})).catch((e=>{var t,n;return null===(t=r.logger.error("Error when creating connection request ",e))||void 0===t||null===(n=t.sendInternalLogToServer)||void 0===n||n.call(t),Promise.reject(e)}))}disconnectParticipant(e){var t=this,n={ConnectionToken:e},r=new i.DisconnectParticipantCommand(n);return t._sendRequest(r).then((e=>{var n,r;return null===(n=t.logger.info("Successfully disconnect participant"))||void 0===n||null===(r=n.sendInternalLogToServer)||void 0===r||r.call(n),e})).catch((e=>{var n,r;return null===(n=t.logger.error("Error when disconnecting participant ",e))||void 0===n||null===(r=n.sendInternalLogToServer)||void 0===r||r.call(n),Promise.reject(e)}))}getTranscript(e,t){var n={MaxResults:t.maxResults,NextToken:t.nextToken,ScanDirection:t.scanDirection,SortOrder:t.sortOrder,StartPosition:{Id:t.startPosition.id,AbsoluteTime:t.startPosition.absoluteTime,MostRecent:t.startPosition.mostRecent},ConnectionToken:e};t.contactId&&(n.ContactId=t.contactId);var r=new i.GetTranscriptCommand(n);return this._sendRequest(r).then((e=>(this.logger.info("Successfully get transcript"),e))).catch((e=>(this.logger.error("Get transcript error",e),Promise.reject(e))))}sendMessage(e,t,n){var r={Content:t,ContentType:n,ConnectionToken:e},o=new i.SendMessageCommand(r);return this._sendRequest(o).then((e=>{var t,n={id:null===(t=e.data)||void 0===t?void 0:t.Id,contentType:r.ContentType};return this.logger.debug("Successfully send message",n),e})).catch((e=>(this.logger.error("Send message error",e,{contentType:r.ContentType}),Promise.reject(e))))}sendAttachment(e,t,n){var r=this,o={ContentType:t.type,AttachmentName:t.name,AttachmentSizeInBytes:t.size,ConnectionToken:e},a=new i.StartAttachmentUploadCommand(o),s={contentType:t.type,size:t.size};return r._sendRequest(a).then((n=>r._uploadToS3(t,n.data.UploadMetadata).then((()=>{var t,o={AttachmentIds:[n.data.AttachmentId],ConnectionToken:e};this.logger.debug("Successfully upload attachment",M(M({},s),{},{attachmentId:null===(t=n.data)||void 0===t?void 0:t.AttachmentId}));var a=new i.CompleteAttachmentUploadCommand(o);return r._sendRequest(a)})))).catch((e=>(this.logger.error("Upload attachment error",e,s),Promise.reject(e))))}_uploadToS3(e,t){return fetch(t.Url,{method:"PUT",headers:t.HeadersToInclude,body:e})}downloadAttachment(e,t){var n=this,r={AttachmentId:t,ConnectionToken:e},o={attachmentId:t},a=new i.GetAttachmentCommand(r);return n._sendRequest(a).then((e=>(this.logger.debug("Successfully download attachment",o),n._downloadUrl(e.data.Url)))).catch((e=>(this.logger.error("Download attachment error",e,o),Promise.reject(e))))}_downloadUrl(e){return fetch(e).then((e=>e.blob())).catch((e=>Promise.reject(e)))}sendEvent(e,t,n){return t===d.typing?this.throttleEvent(e,t,n):this._submitEvent(e,t,n)}_submitEvent(e,t,n){var r={ConnectionToken:e,ContentType:t,Content:n},o=new i.SendEventCommand(r),a={contentType:t};return this._sendRequest(o).then((e=>{var t;return this.logger.debug("Successfully send event",M(M({},a),{},{id:null===(t=e.data)||void 0===t?void 0:t.Id})),e})).catch((e=>Promise.reject(e)))}_sendRequest(e){return this.chatClient.send(e).then((e=>({data:e}))).catch((e=>{var t={type:e.name,message:e.message,stack:e.stack?e.stack.split("\n"):[],statusCode:e.$metadata?e.$metadata.httpStatusCode:void 0};return Promise.reject(t)}))}}var _=new class{constructor(){this.clientCache={}}getCachedClient(e,t){var n=T.getRegionOverride()||e.region||T.getRegion()||"us-west-2";if(t.region=n,this.clientCache[n])return this.clientCache[n];var r=this._createAwsClient(n,t);return this.clientCache[n]=r,r}_createAwsClient(e,t){var n=T.getEndpointOverride(),r="https://participant.connect.".concat(e,".amazonaws.com");return n&&(r=n),new R({endpoint:r,region:e,logMetaData:t,customUserAgentSuffix:T.getCustomUserAgentSuffix()})}};class D{validateNewControllerDetails(e){return!0}validateSendMessage(e){if(!v.isString(e.message))throw new r(e.message+"is not a valid message");this.validateContentType(e.contentType)}validateContentType(e){v.assertIsEnum(e,Object.values(d),"contentType")}validateConnectChat(e){return!0}validateLogger(e){v.assertIsObject(e,"logger"),["debug","info","warn","error"].forEach((t=>{if(!v.isFunction(e[t]))throw new r(t+" should be a valid function on the passed logger object!")}))}validateSendEvent(e){this.validateContentType(e.contentType)}validateGetMessages(e){return!0}}class x extends D{validateChatDetails(e,t){if(v.assertIsObject(e,"chatDetails"),t===a.AGENT&&!v.isFunction(e.getConnectionToken))throw new r("getConnectionToken was not a function",e.getConnectionToken);if(v.assertIsNonEmptyString(e.contactId,"chatDetails.contactId"),v.assertIsNonEmptyString(e.participantId,"chatDetails.participantId"),t===a.CUSTOMER){if(!e.participantToken)throw new r("participantToken was not provided for a customer session type",e.participantToken);v.assertIsNonEmptyString(e.participantToken,"chatDetails.participantToken")}}validateInitiateChatResponse(){return!0}normalizeChatDetails(e){var t={};return t.contactId=e.ContactId||e.contactId,t.participantId=e.ParticipantId||e.participantId,t.initialContactId=e.InitialContactId||e.initialContactId||t.contactId||t.ContactId,t.getConnectionToken=e.getConnectionToken||e.GetConnectionToken,(e.participantToken||e.ParticipantToken)&&(t.participantToken=e.ParticipantToken||e.participantToken),this.validateChatDetails(t),t}}var L="NeverStarted",U="Starting",F="Connected",j="ConnectionLost",W="Ended",H="DeepHeartbeatSuccess",B="DeepHeartbeatFailure",z="ConnectionLost",G="ConnectionGained",q="Ended",V="IncomingMessage",$="DeepHeartbeatSuccess",J="DeepHeartbeatFailure",K="BackgroundChatEnded";class Y{constructor(e,t){this.connectionDetailsProvider=e,this.isStarted=!1,this.logger=b.getLogger({prefix:"ChatJS-BaseConnectionHelper",logMetaData:t})}startConnectionTokenPolling(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:432e5;if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0]))return this.connectionDetailsProvider.fetchConnectionDetails().then((t=>(this.logger.info("Connection token polling succeeded."),e=this.getTimeToConnectionTokenExpiry(),this.timeout=setTimeout(this.startConnectionTokenPolling.bind(this),e),t))).catch((t=>(this.logger.error("An error occurred when attempting to fetch the connection token during Connection Token Polling",t),this.timeout=setTimeout(this.startConnectionTokenPolling.bind(this),e),t)));this.logger.info("First time polling connection token."),this.timeout=setTimeout(this.startConnectionTokenPolling.bind(this),e)}start(){return this.isStarted?this.getConnectionToken():(this.isStarted=!0,this.startConnectionTokenPolling(!0,this.getTimeToConnectionTokenExpiry()))}end(){clearTimeout(this.timeout)}getConnectionToken(){return this.connectionDetailsProvider.getFetchedConnectionToken()}getConnectionTokenExpiry(){return this.connectionDetailsProvider.getConnectionTokenExpiry()}getTimeToConnectionTokenExpiry(){return new Date(this.getConnectionTokenExpiry()).getTime()-(new Date).getTime()-6e4}}var X="<<all>>",Q=function(e,t,n){this.subMap=e,this.id=v.randomId(),this.eventName=t,this.f=n};Q.prototype.unsubscribe=function(){this.subMap.unsubscribe(this.eventName,this.id)};var Z=function(){this.subIdMap={},this.subEventNameMap={}};Z.prototype.subscribe=function(e,t){var n=new Q(this,e,t);this.subIdMap[n.id]=n;var r=this.subEventNameMap[e]||[];return r.push(n),this.subEventNameMap[e]=r,()=>n.unsubscribe()},Z.prototype.unsubscribe=function(e,t){v.contains(this.subEventNameMap,e)&&(this.subEventNameMap[e]=this.subEventNameMap[e].filter((function(e){return e.id!==t})),this.subEventNameMap[e].length<1&&delete this.subEventNameMap[e]),v.contains(this.subIdMap,t)&&delete this.subIdMap[t]},Z.prototype.getAllSubscriptions=function(){return v.values(this.subEventNameMap).reduce((function(e,t){return e.concat(t)}),[])},Z.prototype.getSubscriptions=function(e){return this.subEventNameMap[e]||[]};var ee=function(e){var t=e||{};this.subMap=new Z,this.logEvents=t.logEvents||!1};ee.prototype.subscribe=function(e,t){return v.assertNotNull(e,"eventName"),v.assertNotNull(t,"f"),v.assertTrue(v.isFunction(t),"f must be a function"),this.subMap.subscribe(e,t)},ee.prototype.subscribeAll=function(e){return v.assertNotNull(e,"f"),v.assertTrue(v.isFunction(e),"f must be a function"),this.subMap.subscribe(X,e)},ee.prototype.getSubscriptions=function(e){return this.subMap.getSubscriptions(e)},ee.prototype.trigger=function(e,t){v.assertNotNull(e,"eventName");var n=this,r=this.subMap.getSubscriptions(X),i=this.subMap.getSubscriptions(e);r.concat(i).forEach((function(r){try{r.f(t||null,e,n)}catch(e){}}))},ee.prototype.triggerAsync=function(e,t){setTimeout((()=>this.trigger(e,t)),0)},ee.prototype.bridge=function(){var e=this;return function(t,n){e.trigger(n,t)}},ee.prototype.unsubscribeAll=function(){this.subMap.getAllSubscriptions().forEach((function(e){e.unsubscribe()}))};var te="Category",ne=new class{constructor(){this.widgetType="CustomChatWidget",this.logger=b.getLogger({prefix:"ChatJS-csmService"}),this.csmInitialized=!1,this.metricsToBePublished=[],this.agentMetricToBePublished=[],this.MAX_RETRY=5}loadCsmScriptAndExecute(){try{var e=document.createElement("script");e.type="text/javascript",e.innerHTML="(function() {\n  const global = self;\n  const csm = global.csm || {};\n  global.csm = csm;\n\n  csm.EVENT_TYPE = {\n    LOG: 'LOG',\n    METRIC: 'METRIC',\n    CONFIG: 'CONFIG',\n    WORKFLOW_EVENT: 'WORKFLOW_EVENT',\n    CUSTOM: 'CUSTOM',\n    CLOSE: 'CLOSE',\n    SET_AUTH: 'SET_AUTH',\n    SET_CONFIG: 'SET_CONFIG',\n  };\n\n  csm.UNIT = {\n    COUNT: 'Count',\n    SECONDS: 'Seconds',\n    MILLISECONDS: 'Milliseconds',\n    MICROSECONDS: 'Microseconds',\n  };\n})();\n\n(function() {\n  const global = self;\n  const csm = global.csm || {};\n  global.csm = csm;\n\n  const MAX_METRIC_DIMENSIONS = 10;\n\n  /** ********* Dimension Classes ***********/\n\n  const Dimension = function(name, value) {\n    csm.Util.assertExist(name, 'name');\n    csm.Util.assertExist(value, 'value');\n\n    this.name = name;\n    this.value = value == null ? 'null' : (value === '' ? ' ' : value.toString());\n  };\n\n\n  /** ********* Metric Classes ***********/\n\n  const Metric = function(metricName, unit, value, dedupeOptions) {\n    csm.Util.assertExist(metricName, 'metricName');\n    csm.Util.assertExist(value, 'value');\n    csm.Util.assertExist(unit, 'unit');\n    csm.Util.assertTrue(csm.Util.isValidUnit(unit));\n    if (dedupeOptions) {\n      csm.Util.assertInObject(dedupeOptions, 'dedupeOptions', 'dedupeIntervalMs');\n    }\n\n    this.metricName = metricName;\n    this.unit = unit;\n    this.value = value;\n    this.timestamp = new Date();\n    this.dimensions = csm.globalDimensions ? csm.Util.deepCopy(csm.globalDimensions): [];\n    this.namespace = csm.configuration.namespace;\n    this.dedupeOptions = dedupeOptions; // optional. { dedupeIntervalMs: (int; required), context: (string; optional) }\n\n    // Currently, CloudWatch can't aggregate metrics by a subset of dimensions.\n    // To bypass this limitation, we introduce the optional dimensions concept to CSM.\n    // The CSM metric publisher will publish a default metric without optional dimension\n    // For each optional dimension, the CSM metric publisher publishes an extra metric with that dimension.\n    this.optionalDimensions = csm.globalOptionalDimensions ? csm.Util.deepCopy(csm.globalOptionalDimensions): [];\n  };\n\n  Metric.prototype.addDimension = function(name, value) {\n    this._addDimensionHelper(this.dimensions, name, value);\n  };\n\n  Metric.prototype.addOptionalDimension = function(name, value) {\n    this._addDimensionHelper(this.optionalDimensions, name, value);\n  };\n\n  Metric.prototype._addDimensionHelper = function(targetDimensions, name, value) {\n    // CloudWatch metric allows maximum 10 dimensions\n    // http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/CloudWatch.html#putMetricData-property\n    if ((this.dimensions.length + this.optionalDimensions.length) >= MAX_METRIC_DIMENSIONS) {\n      throw new csm.ExceedDimensionLimitException(name);\n    }\n\n    const existing = targetDimensions.find(function(dimension) {\n      return dimension.name === name;\n    });\n\n    if (existing) {\n      existing.value = value == null ? 'null' : (value === '' ? ' ' : value.toString());\n    } else {\n      targetDimensions.push(new Dimension(name, value));\n    }\n  };\n\n\n  /** ********* Telemetry Classes ***********/\n\n  const WorkflowEvent = function(params) {\n    this.timestamp = params.timestamp || new Date().getTime();\n    this.workflowType = params.workflow.type;\n    this.instanceId = params.workflow.instanceId;\n    this.userId = params.userId;\n    this.organizationId = params.organizationId;\n    this.accountId = params.accountId;\n    this.event = params.event;\n    this.appName = params.appName;\n    this.data = [];\n\n    // Convert 'data' map into the KeyValuePairList structure expected by the Lambda API\n    for (const key in params.data) {\n      if (Object.prototype.hasOwnProperty.call(params.data, key)) {\n        this.data.push({'key': key, 'value': params.data[key]});\n      }\n    }\n  };\n\n  /** ********* Exceptions ***********/\n\n  const NullOrUndefinedException = function(paramName) {\n    this.name = 'NullOrUndefinedException';\n    this.message = paramName + ' is null or undefined. ';\n  };\n  NullOrUndefinedException.prototype.toString = function() {\n    return this.name + ': ' + this.message;\n  };\n\n  const AssertTrueException = function() {\n    this.name = 'AssertTrueException';\n    this.message = 'Assertion failed. ';\n  };\n  AssertTrueException.prototype.toString = function() {\n    return this.name + ': ' + this.message;\n  };\n\n  const ExceedDimensionLimitException = function(dimensionName) {\n    this.name = 'ExceedDimensionLimitException';\n    this.message = 'Could not add dimension \\'' + dimensionName + '\\'. Metric has maximum 10 dimensions. ';\n  };\n  ExceedDimensionLimitException.prototype.toString = function() {\n    return this.name + ': ' + this.message;\n  };\n\n  const InitializationException = function() {\n    this.name = 'InitializationException';\n    this.message = 'Initialization failed. ';\n  };\n  InitializationException.prototype.toString = function() {\n    return this.name + ': ' + this.message;\n  };\n\n\n  csm.Dimension = Dimension;\n  csm.Metric = Metric;\n  csm.WorkflowEvent = WorkflowEvent;\n  csm.NullOrUndefinedException = NullOrUndefinedException;\n  csm.AssertTrueException = AssertTrueException;\n  csm.InitializationException = InitializationException;\n  csm.ExceedDimensionLimitException = ExceedDimensionLimitException;\n})();\n\n(function() {\n  const global = self;\n  const csm = global.csm || {};\n  global.csm = csm;\n\n  const validTimeUnits = [csm.UNIT.SECONDS, csm.UNIT.MILLISECONDS, csm.UNIT.MICROSECONDS];\n  const validUnits = validTimeUnits.concat(csm.UNIT.COUNT);\n\n  const Util = {\n    assertExist: function(value, paramName) {\n      if (value === null || value === undefined) {\n        throw new csm.NullOrUndefinedException(paramName);\n      }\n    },\n    assertTrue: function(value) {\n      if (!value) {\n        throw new csm.AssertTrueException();\n      }\n    },\n    assertInObject: function(obj, objName, key) {\n      if (obj === null || obj === undefined || typeof obj !== 'object') {\n        throw new csm.NullOrUndefinedException(objName);\n      }\n      if (key === null || key === undefined || !obj[key]) {\n        throw new csm.NullOrUndefinedException(`${objName}[${key}]`);\n      }\n    },\n    isValidUnit: function(unit) {\n      return validUnits.includes(unit);\n    },\n    isValidTimeUnit: function(unit) {\n      return validTimeUnits.includes(unit);\n    },\n    isEmpty: function(value) {\n      if (value !== null && typeof val === 'object') {\n        return Objects.keys(value).length === 0;\n      }\n      return !value;\n    },\n    deepCopy: function(obj) {\n      // NOTE: this will fail if obj has a circular reference\n      return JSON.parse(JSON.stringify(obj));\n    },\n\n    /**\n     * This function is used before setting the page location for default metrics and logs,\n     * and the APIs that set page location\n     * Can be overridden by calling csm.API.setPageLocationTransformer(function(){})\n     * @param {string}        pathname path for page location\n     * @return {string}       pathname provided\n     */\n    pageLocationTransformer: function(pathname) {\n      return pathname;\n    },\n\n    /**\n     * As of now, our service public claims only support for Firefox and Chrome\n     * Reference https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent\n     *\n     * This function will only return firefox, chrome and others\n     *\n     * Best practice as indicated in MDN, \"Avoiding user agent detection\"\n     */\n    getBrowserDetails: function() {\n      const userAgent = window.navigator.userAgent;\n      const details = {};\n      if (userAgent.includes('Firefox') && !userAgent.includes('Seamonkey')) {\n        details.name = 'Firefox';\n        details.version = getBrowserVersion('Firefox');\n      } else if (userAgent.includes('Chrome') && !userAgent.includes('Chromium')) {\n        details.name = 'Chrome';\n        details.version = getBrowserVersion('Chrome');\n      }\n    },\n\n    randomId: function() {\n      return new Date().getTime() + '-' + Math.random().toString(36).slice(2);\n    },\n\n    getOrigin: function() {\n      return document.location.origin;\n    },\n\n    getReferrerUrl: function() {\n      const referrer = document.referrer || '';\n      return this.getURLOrigin(referrer);\n    },\n\n    getWindowParent: function() {\n      let parentLocation = '';\n      try {\n        parentLocation = window.parent.location.href;\n      } catch (e) {\n        parentLocation = '';\n      }\n      return parentLocation;\n    },\n\n    getURLOrigin: function(urlValue) {\n      let origin = '';\n      const originArray = urlValue.split( '/' );\n      if (originArray.length >= 3) {\n        const protocol = originArray[0];\n        const host = originArray[2];\n        origin = protocol + '//' + host;\n      }\n      return origin;\n    },\n\n  };\n\n  const getBrowserVersion = function(browserName) {\n    const userAgent = window.navigator.userAgent;\n    const browserNameIndex = userAgent.indexOf(browserName);\n    const nextSpaceIndex = userAgent.indexOf(' ', browserNameIndex);\n    if (nextSpaceIndex === -1) {\n      return userAgent.substring(browserNameIndex + browserName.length + 1, userAgent.length);\n    } else {\n      return userAgent.substring(browserNameIndex + browserName.length + 1, nextSpaceIndex);\n    }\n  };\n\n  csm.Util = Util;\n})();\n\n(function() {\n  const global = window;\n  const csm = global.csm || {};\n  global.csm = csm;\n\n  csm.globalDimensions = []; // These dimensions are added to all captured metrics.\n  csm.globalOptionalDimensions = [];\n  csm.initFailureDimensions = [];\n\n  const API = {\n    getWorkflow: function(workflowType, instanceId, data) {\n      return csm.workflow(workflowType, instanceId, data);\n    },\n\n    addMetric: function(metric) {\n      csm.Util.assertExist(metric, 'metric');\n      csm.putMetric(metric);\n    },\n\n    addMetricWithDedupe: function(metric, dedupeIntervalMs, context) {\n      csm.Util.assertExist(metric, 'metric');\n      csm.Util.assertExist(metric, 'dedupeIntervalMs');\n      // context is optional; if present it will only dedupe on metrics with the same context. ex.) tabId\n      metric.dedupeOptions = {dedupeIntervalMs, context: context || 'global'};\n      csm.putMetric(metric);\n    },\n\n    addCount: function(metricName, count) {\n      csm.Util.assertExist(metricName, 'metricName');\n      csm.Util.assertExist(count, 'count');\n\n      const metric = new csm.Metric(metricName, csm.UNIT.COUNT, count);\n      csm.putMetric(metric);\n    },\n\n    addCountWithPageLocation: function(metricName) {\n      csm.Util.assertExist(metricName, 'metricName');\n\n      const metric = new csm.Metric(metricName, csm.UNIT.COUNT, 1.0);\n      metric.addDimension('WindowLocation', csm.Util.pageLocationTransformer(window.location.pathname));\n      csm.putMetric(metric);\n    },\n\n    addError: function(metricName, count) {\n      csm.Util.assertExist(metricName, 'metricName');\n\n      if (count === undefined || count == null) {\n        count = 1.0;\n      }\n      const metric = new csm.Metric(metricName, csm.UNIT.COUNT, count);\n      metric.addDimension('Metric', 'Error');\n      csm.putMetric(metric);\n    },\n\n    addSuccess: function(metricName) {\n      API.addError(metricName, 0);\n    },\n\n    addTime: function(metricName, time, unit) {\n      csm.Util.assertExist(metricName, 'metricName');\n      csm.Util.assertExist(time, 'time');\n\n      let timeUnit = csm.UNIT.MILLISECONDS;\n      if (unit && csm.Util.isValidTimeUnit(unit)) {\n        timeUnit = unit;\n      }\n      const metric = new csm.Metric(metricName, timeUnit, time);\n      metric.addDimension('Metric', 'Time');\n      csm.putMetric(metric);\n    },\n\n    addTimeWithPageLocation: function(metricName, time, unit) {\n      csm.Util.assertExist(metricName, 'metricName');\n      csm.Util.assertExist(time, 'time');\n\n      let timeUnit = csm.UNIT.MILLISECONDS;\n      if (unit && csm.Util.isValidTimeUnit(unit)) {\n        timeUnit = unit;\n      }\n      const metric = new csm.Metric(metricName, timeUnit, time);\n      metric.addDimension('WindowLocation', csm.Util.pageLocationTransformer(window.location.pathname));\n      csm.putMetric(metric);\n    },\n\n    pageReady: function() {\n      if (window.performance && window.performance.now) {\n        const pageLoadTime = window.performance.now();\n        const metric = new csm.Metric('PageReadyLatency', csm.UNIT.MILLISECONDS, pageLoadTime);\n        metric.addDimension('WindowLocation', csm.Util.pageLocationTransformer(window.location.pathname));\n        csm.putMetric(metric);\n      }\n    },\n\n    setPageLocationTransformer: function(transformFunc) {\n      csm.Util.assertExist(transformFunc, 'transformFunc');\n      csm.Util.assertTrue((typeof transformFunc) === 'function');\n      csm.Util.pageLocationTransformer = transformFunc;\n    },\n\n    setGlobalDimensions: function(dimensions) {\n      csm.Util.assertExist(dimensions, 'dimensions');\n      csm.globalDimensions = dimensions;\n    },\n\n    setGlobalOptionalDimensions: function(dimensions) {\n      csm.Util.assertExist(dimensions, 'dimensions');\n      csm.globalOptionalDimensions = dimensions;\n    },\n\n    setInitFailureDimensions: function(dimensions) {\n      csm.Util.assertExist(dimensions, 'dimensions');\n      csm.initFailureDimensions = dimensions;\n    },\n\n    putCustom: function(endpoint, headers, data) {\n      csm.Util.assertExist(data, 'data');\n      csm.Util.assertExist(endpoint, 'endpoint');\n      csm.Util.assertExist(headers, 'headers');\n      csm.putCustom(endpoint, headers, data);\n    },\n\n    setAuthParams: function(authParams) {\n      csm.setAuthParams(authParams);\n    },\n\n    setConfig: function(key, value) {\n      csm.Util.assertExist(key, 'key');\n      csm.Util.assertExist(value, 'value');\n      if (!csm.configuration[key]) {\n        csm.setConfig(key, value); // set configuration variables such as accountId, instanceId, userId\n      }\n    },\n  };\n\n  csm.API = API;\n})();\n\n(function() {\n  const global = window;\n  const csm = global.csm || {};\n  global.csm = csm;\n\n  const WORKFLOW_KEY_PREFIX = 'csm.workflow';\n\n  /**\n   * Calculates the local storage key used to store a workflow of the specified type.\n   * @param {string} type of workflow\n   * @return {string} storage key\n   */\n  const getWorkflowKeyForType = function(type) {\n    return [\n      WORKFLOW_KEY_PREFIX,\n      type,\n    ].join('.');\n  };\n\n  /**\n   * Constructor for new Workflow objects.\n   *\n   * If you need to be able to share a workflow across tabs, it is recommended\n   * to use \"csm.workflow\" to create/hydrate your workflows instead.\n   * @param {string} type of workflow\n   * @param {string} instanceId of workflow\n   * @param {JSON} data blob associated with workflow\n   */\n  const Workflow = function(type, instanceId, data) {\n    this.type = type;\n    this.instanceId = instanceId || csm.Util.randomId();\n    this.instanceSpecified = instanceId || false;\n    this.eventMap = {};\n    this.data = data || {};\n\n    // Merge global dimensions into the data map.\n    const dimensionData = {};\n    csm.globalDimensions.forEach(function(dimension) {\n      dimensionData[dimension.name] = dimension.value;\n    });\n    csm.globalOptionalDimensions.forEach(function(dimension) {\n      dimensionData[dimension.name] = dimension.value;\n    });\n    this.data = this._mergeData(dimensionData);\n  };\n\n  /**\n   * Create a new workflow or rehydrate an existing shared workflow.\n   *\n   * @param {string} type The type of workflow to be created.\n   * @param {string} instanceId The instanceId of the workflow.  If not provided, it will be\n   *      assigned a random ID and will not be automatically saved to local storage.\n   *      If provided, we will attempt to load an existing workflow of the same type\n   *      from local storage and rehydrate it.\n   * @param {JSON} data An optional map of key/value pairs to be added as data to every\n   *      workflow event created with this workflow.\n   * @return {Workflow} workflow event\n   * NOTE: Only one workflow of each type can be stored at the same time, to avoid\n   *       overloading localStorage with unused workflow records.\n   */\n  csm.workflow = function(type, instanceId, data) {\n    let workflow = new Workflow(type, instanceId, data);\n\n    if (instanceId) {\n      const savedWorkflow = csm._loadWorkflow(type);\n      if (savedWorkflow && savedWorkflow.instanceId === instanceId) {\n        workflow = savedWorkflow;\n        workflow.addData(data || {});\n      }\n    }\n\n    return workflow;\n  };\n\n  csm._loadWorkflow = function(type) {\n    let workflow = null;\n    const workflowJson = localStorage.getItem(getWorkflowKeyForType(type));\n    const workflowStruct = workflowJson ? JSON.parse(workflowJson) : null;\n    if (workflowStruct) {\n      workflow = new Workflow(type, workflowStruct.instanceId);\n      workflow.eventMap = workflowStruct.eventMap;\n    }\n    return workflow;\n  };\n\n  /**\n   * Creates a new workflow event and returns it.  Then this workflow event is sent upstream\n   * to the CSMSharedWorker where it is provided to the backend.\n   *\n   * If an instanceId was specified when the workflow was created, this will also save the workflow\n   * and all of its events to localStorage.\n   *\n   * @param {string} event The name of the event that occurred.\n   * @param {JSON} data An optional free-form key attribute pair of metadata items that will be stored\n   *      and reported backstream with the workflow event.\n   * @return {WorkflowEvent} workflowEvent\n   */\n  Workflow.prototype.event = function(event, data) {\n    const mergedData = this._mergeData(data || {});\n    const workflowEvent = new csm.WorkflowEvent({\n      workflow: this,\n      event: event,\n      data: mergedData,\n      userId: csm.configuration.userId || '',\n      organizationId: csm.configuration.organizationId || '',\n      accountId: csm.configuration.accountId || '',\n      appName: csm.configuration.namespace || '',\n    });\n    csm.putWorkflowEvent(workflowEvent);\n    this.eventMap[event] = workflowEvent;\n    if (this.instanceSpecified) {\n      this.save();\n    }\n    return workflowEvent;\n  };\n\n  /**\n   * Creates a new workflow event and returns it, if the same event is not happened in ths past\n   * dedupeIntervalMs milliseconds.\n   * @param {string} event The name of the event that occurred.\n   * @param {JSON} data An optional free-form key attribute pair of metadata items that will be stored\n   * and reported backstream with the workflow event.\n   * @param {int} dedupeIntervalMs defaults to 200 MS\n   * @return {WorkflowEvent} workflowEvent\n   */\n  Workflow.prototype.eventWithDedupe = function(event, data, dedupeIntervalMs) {\n    const pastEvent = this.getPastEvent(event);\n    const now = new Date().getTime();\n    const interval = dedupeIntervalMs || 200;\n\n    // Crafting the expected workflow event data result\n    const mergedData = this._mergeData(data);\n    const expectedData = [];\n    for (const key in mergedData) {\n      if (Object.prototype.hasOwnProperty.call(mergedData, key)) {\n        expectedData.push({'key': key, 'value': mergedData[key]});\n      }\n    }\n\n    // Deduplicate same events that happened within interval\n    if (!pastEvent || (pastEvent && JSON.stringify(pastEvent.data) !== JSON.stringify(expectedData)) ||\n        (pastEvent && (now - pastEvent.timestamp > interval))) {\n      return this.event(event, data);\n    }\n    return null;\n  };\n\n  /**\n   * Get a past event if it exists in this workflow, otherwise returns null.\n   * This can be helpful to emit metrics in real time based on the differences\n   * between workflow event timestamps, especially for workflows shared across tabs.\n   * @param {string} event key to see if workflow exists for this event\n   * @return {WorkflowEvent} workflow event retrieved\n   */\n  Workflow.prototype.getPastEvent = function(event) {\n    return event in this.eventMap ? this.eventMap[event] : null;\n  };\n\n  /**\n   * Save the workflow to local storage. This only happens automatically when an\n   * instanceId is specified on workflow creation, however if this method is called\n   * explicitly by the client, the randomly generated workflow instance id can be\n   * used to retrieve the workflow later and automatic save on events will be enabled.\n   */\n  Workflow.prototype.save = function() {\n    this.instanceSpecified = true;\n    localStorage.setItem(getWorkflowKeyForType(this.type), JSON.stringify(this));\n  };\n\n  /**\n   * Remove this workflow if it is the saved instance for this workflow type in localStorage.\n   */\n  Workflow.prototype.close = function() {\n    const storedWorkflow = csm._loadWorkflow(this.type);\n    if (storedWorkflow && storedWorkflow.instanceId === this.instanceId) {\n      localStorage.removeItem(getWorkflowKeyForType(this.type));\n    }\n  };\n\n  Workflow.prototype.addData = function(data) {\n    for (const key in data) {\n      if (Object.prototype.hasOwnProperty.call(data, key)) {\n        this.data[key] = data[key];\n      }\n    }\n  };\n\n  Workflow.prototype._mergeData = function(data) {\n    const mergedData = {};\n    let key = null;\n    for (key in this.data) {\n      if (Object.prototype.hasOwnProperty.call(this.data, key)) {\n        mergedData[key] = this.data[key] == null ? 'null' : (this.data[key] === '' ? ' ' : this.data[key].toString());\n      }\n    }\n    for (key in data) {\n      if (Object.prototype.hasOwnProperty.call(data, key)) {\n        mergedData[key] = data[key] == null ? 'null' : (data[key] === '' ? ' ' : data[key].toString());\n      }\n    }\n    return mergedData;\n  };\n})();\n\n(function() {\n  const global = window;\n  const csm = global.csm || {};\n  global.csm = csm;\n\n  let worker = null;\n  let portId = null;\n\n  const MAX_INIT_MILLISECONDS = 5000;\n  const preInitTaskQueue = [];\n  csm.configuration = {};\n\n  /**\n   * Initialize CSM variables\n   * @param {object} params for CSM\n   * @params.namespace Define your metric namespace used in CloudWatch metrics\n   * @params.sharedWorkerUrl Specify the relative url to the connect-csm-worker.js file in your service\n   * @params.endpoint Specify an LDAS endpoint to use.\n   * @params.dryRunMode When CSM is initialized with dry run mode, it won't actually publish metrics.\n   * @params.defaultMetrics Enable default metrics. Default to false.\n   */\n  csm.initCSM = function(params) {\n    csm.Util.assertExist(params.namespace, 'namespace');\n    csm.Util.assertExist(params.sharedWorkerUrl, 'sharedWorkerUrl');\n    csm.Util.assertExist(params.endpoint, 'endpoint');\n\n    try {\n      console.log('Starting csm shared worker with', params.sharedWorkerUrl);\n      worker = new SharedWorker(params.sharedWorkerUrl, 'CSM_SharedWorker');\n      worker.port.start();\n    } catch (e) {\n      console.log('Failed to initialize csm shared worker with', params.sharedWorkerUrl);\n      console.log(e.message);\n    }\n\n    /**\n     * Configure shared worker\n     */\n    csm.configuration = {\n      namespace: params.namespace,\n      userId: params.userId || '',\n      accountId: params.accountId || '',\n      organizationId: params.organizationId || '',\n      endpointUrl: params.endpoint || null,\n      batchSettings: params.batchSettings || null,\n      addPageVisibilityDimension: params.addPageVisibilityDimension || false,\n      addUrlDataDimensions: params.addUrlDataDimensions || false,\n      dryRunMode: params.dryRunMode || false, // When csm is in dryRunMode it won't actually publish metrics to CSM\n    };\n\n    postEventToWorker(csm.EVENT_TYPE.CONFIG, csm.configuration);\n\n    /**\n     * Receive message from shared worker\n     * @param {MessageEvent} messageEvent from shared worker\n     */\n    worker.port.onmessage = function(messageEvent) {\n      const messageType = messageEvent.data.type;\n      onMessageFromWorker(messageType, messageEvent.data);\n    };\n\n    /**\n     * Inform shared worker window closed\n     */\n    global.onbeforeunload = function() {\n      worker.port.postMessage(\n          {\n            type: csm.EVENT_TYPE.CLOSE,\n            portId: portId,\n          },\n      );\n    };\n\n    /**\n     * Check if initialization success\n     */\n    global.setTimeout(function() {\n      if (!isCSMInitialized()) {\n        console.log('[FATAL] CSM initialization failed! Please make sure the sharedWorkerUrl is reachable.');\n      }\n    }, MAX_INIT_MILLISECONDS);\n\n    // Emit out of the box metrics\n    if (params.defaultMetrics) {\n      emitDefaultMetrics();\n    }\n  };\n  // Final processing before sending to SharedWorker\n  const processMetric = function(metric) {\n    if (csm.configuration.addPageVisibilityDimension && document.visibilityState) {\n      metric.addOptionalDimension('VisibilityState', document.visibilityState);\n    }\n  };\n\n  const processWorkflowEvent = function(event) {\n    if (csm.configuration.addUrlDataDimensions) {\n      event.data.push({'key': 'ReferrerUrl', 'value': csm.Util.getReferrerUrl()});\n      event.data.push({'key': 'Origin', 'value': csm.Util.getOrigin()});\n      event.data.push({'key': 'WindowParent', 'value': csm.Util.getWindowParent()});\n    }\n    if (['initFailure', 'initializationLatencyInfo'].includes(event.event)) {\n      csm.initFailureDimensions.forEach((dimension) => {\n        Object.keys(dimension).forEach((key) => {\n          event.data.push({'key': key, 'value': dimension[key]});\n        });\n      });\n    }\n    return event;\n  };\n\n  csm.putMetric = function(metric) {\n    processMetric(metric);\n    postEventToWorker(csm.EVENT_TYPE.METRIC, metric);\n  };\n\n  csm.putLog = function(log) {\n    postEventToWorker(csm.EVENT_TYPE.LOG, log);\n  };\n\n  csm.putWorkflowEvent = function(event) {\n    const processedEvent = processWorkflowEvent(event);\n    postEventToWorker(csm.EVENT_TYPE.WORKFLOW_EVENT, processedEvent);\n  };\n\n  csm.putCustom = function(endpoint, headers, data) {\n    postEventToWorker(csm.EVENT_TYPE.CUSTOM, data, endpoint, headers);\n  };\n\n  csm.setAuthParams = function(authParams) {\n    postEventToWorker(csm.EVENT_TYPE.SET_AUTH, authParams);\n  };\n\n  csm.setConfig = function(key, value) {\n    csm.configuration[key] = value;\n    postEventToWorker(csm.EVENT_TYPE.SET_CONFIG, {key, value});\n  };\n  /** **********************  PRIVATE METHODS  ************************/\n\n  const onMessageFromWorker = function(messageType, data) {\n    if (messageType === csm.EVENT_TYPE.CONFIG) {\n      portId = data.portId;\n      onCSMInitialized();\n    }\n  };\n\n  const onCSMInitialized = function() {\n    // Purge the preInitTaskQueue\n    preInitTaskQueue.forEach(function(task) {\n      postEventToWorker(task.type, task.message, task.endpoint, task.headers);\n    });\n\n    // TODO:  Capture on errors and publish log to shared worker\n    /**\n            window.onerror = function(message, fileName, lineNumber, columnNumber, errorstack) {\n                var log = new csm.Log(message, fileName, lineNumber, columnNumber, errorstack.stack);\n                csm.putLog(log);\n            };\n        */\n  };\n\n  /**\n   * Emit out of the box metrics automatically\n   *\n   * TODO allow configuration\n   */\n  const emitDefaultMetrics = function() {\n    window.addEventListener('load', function() {\n      // loadEventEnd is avaliable after the onload function finished\n      // https://www.w3.org/TR/navigation-timing-2/#processing-model\n      // https://developer.mozilla.org/en-US/docs/Web/API/PerformanceNavigationTiming\n      global.setTimeout(function() {\n        try {\n          const perfData = window.performance.getEntriesByType('navigation')[0];\n          const pageLoadTime = perfData.loadEventEnd - perfData.startTime;\n          const connectTime = perfData.responseEnd - perfData.requestStart;\n          const domRenderTime = perfData.domComplete - perfData.domInteractive;\n          csm.API.addCountWithPageLocation('PageLoad');\n          csm.API.addTimeWithPageLocation('PageLoadTime', pageLoadTime);\n          csm.API.addTimeWithPageLocation('ConnectTime', connectTime);\n          csm.API.addTimeWithPageLocation('DomRenderTime', domRenderTime);\n        } catch (err) {\n          console.log('Error emitting default metrics', err);\n        }\n      }, 0);\n    });\n  };\n\n  /**\n   * Try posting message to shared worker\n   * If shared worker hasn't been initialized, put the task to queue to be clean up once initialized\n   * @param {csm.EVENT_TYPE} eventType for CSM\n   * @param {object} message event following type of eventType\n   * @param {string} [endpoint] optional parameter for putCustom function (put any data to specified endpoint)\n   * @param {object} [headers] optional parameter for putCustom function\n   */\n  const postEventToWorker = function(eventType, message, endpoint, headers) {\n    if (eventType === csm.EVENT_TYPE.CONFIG || isCSMInitialized()) {\n      worker.port.postMessage(\n          {\n            type: eventType,\n            portId: portId,\n            message: message,\n            endpoint: endpoint,\n            headers: headers,\n          },\n      );\n    } else {\n      preInitTaskQueue.push({\n        type: eventType,\n        message: message,\n        endpoint: endpoint,\n        headers: headers,\n      });\n    }\n  };\n\n  const isCSMInitialized = function() {\n    return portId !== null;\n  };\n})()",document.head.appendChild(e),this.initializeCSM()}catch(e){this.logger.error("Load csm script error: ",e)}}initializeCSM(){try{if(this.csmInitialized)return;var e=T.getRegionOverride()||T.getRegion(),t=T.getCell(),n="(function() {\n  const global = self;\n  const csm = global.csm || {};\n  global.csm = csm;\n\n  csm.EVENT_TYPE = {\n    LOG: 'LOG',\n    METRIC: 'METRIC',\n    CONFIG: 'CONFIG',\n    WORKFLOW_EVENT: 'WORKFLOW_EVENT',\n    CUSTOM: 'CUSTOM',\n    CLOSE: 'CLOSE',\n    SET_AUTH: 'SET_AUTH',\n    SET_CONFIG: 'SET_CONFIG',\n  };\n\n  csm.UNIT = {\n    COUNT: 'Count',\n    SECONDS: 'Seconds',\n    MILLISECONDS: 'Milliseconds',\n    MICROSECONDS: 'Microseconds',\n  };\n})();\n\n(function() {\n  const global = self;\n  const csm = global.csm || {};\n  global.csm = csm;\n\n  const MAX_METRIC_DIMENSIONS = 10;\n\n  /** ********* Dimension Classes ***********/\n\n  const Dimension = function(name, value) {\n    csm.Util.assertExist(name, 'name');\n    csm.Util.assertExist(value, 'value');\n\n    this.name = name;\n    this.value = value == null ? 'null' : (value === '' ? ' ' : value.toString());\n  };\n\n\n  /** ********* Metric Classes ***********/\n\n  const Metric = function(metricName, unit, value, dedupeOptions) {\n    csm.Util.assertExist(metricName, 'metricName');\n    csm.Util.assertExist(value, 'value');\n    csm.Util.assertExist(unit, 'unit');\n    csm.Util.assertTrue(csm.Util.isValidUnit(unit));\n    if (dedupeOptions) {\n      csm.Util.assertInObject(dedupeOptions, 'dedupeOptions', 'dedupeIntervalMs');\n    }\n\n    this.metricName = metricName;\n    this.unit = unit;\n    this.value = value;\n    this.timestamp = new Date();\n    this.dimensions = csm.globalDimensions ? csm.Util.deepCopy(csm.globalDimensions): [];\n    this.namespace = csm.configuration.namespace;\n    this.dedupeOptions = dedupeOptions; // optional. { dedupeIntervalMs: (int; required), context: (string; optional) }\n\n    // Currently, CloudWatch can't aggregate metrics by a subset of dimensions.\n    // To bypass this limitation, we introduce the optional dimensions concept to CSM.\n    // The CSM metric publisher will publish a default metric without optional dimension\n    // For each optional dimension, the CSM metric publisher publishes an extra metric with that dimension.\n    this.optionalDimensions = csm.globalOptionalDimensions ? csm.Util.deepCopy(csm.globalOptionalDimensions): [];\n  };\n\n  Metric.prototype.addDimension = function(name, value) {\n    this._addDimensionHelper(this.dimensions, name, value);\n  };\n\n  Metric.prototype.addOptionalDimension = function(name, value) {\n    this._addDimensionHelper(this.optionalDimensions, name, value);\n  };\n\n  Metric.prototype._addDimensionHelper = function(targetDimensions, name, value) {\n    // CloudWatch metric allows maximum 10 dimensions\n    // http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/CloudWatch.html#putMetricData-property\n    if ((this.dimensions.length + this.optionalDimensions.length) >= MAX_METRIC_DIMENSIONS) {\n      throw new csm.ExceedDimensionLimitException(name);\n    }\n\n    const existing = targetDimensions.find(function(dimension) {\n      return dimension.name === name;\n    });\n\n    if (existing) {\n      existing.value = value == null ? 'null' : (value === '' ? ' ' : value.toString());\n    } else {\n      targetDimensions.push(new Dimension(name, value));\n    }\n  };\n\n\n  /** ********* Telemetry Classes ***********/\n\n  const WorkflowEvent = function(params) {\n    this.timestamp = params.timestamp || new Date().getTime();\n    this.workflowType = params.workflow.type;\n    this.instanceId = params.workflow.instanceId;\n    this.userId = params.userId;\n    this.organizationId = params.organizationId;\n    this.accountId = params.accountId;\n    this.event = params.event;\n    this.appName = params.appName;\n    this.data = [];\n\n    // Convert 'data' map into the KeyValuePairList structure expected by the Lambda API\n    for (const key in params.data) {\n      if (Object.prototype.hasOwnProperty.call(params.data, key)) {\n        this.data.push({'key': key, 'value': params.data[key]});\n      }\n    }\n  };\n\n  /** ********* Exceptions ***********/\n\n  const NullOrUndefinedException = function(paramName) {\n    this.name = 'NullOrUndefinedException';\n    this.message = paramName + ' is null or undefined. ';\n  };\n  NullOrUndefinedException.prototype.toString = function() {\n    return this.name + ': ' + this.message;\n  };\n\n  const AssertTrueException = function() {\n    this.name = 'AssertTrueException';\n    this.message = 'Assertion failed. ';\n  };\n  AssertTrueException.prototype.toString = function() {\n    return this.name + ': ' + this.message;\n  };\n\n  const ExceedDimensionLimitException = function(dimensionName) {\n    this.name = 'ExceedDimensionLimitException';\n    this.message = 'Could not add dimension ' + dimensionName + ' . Metric has maximum 10 dimensions. ';\n  };\n  ExceedDimensionLimitException.prototype.toString = function() {\n    return this.name + ': ' + this.message;\n  };\n\n  const InitializationException = function() {\n    this.name = 'InitializationException';\n    this.message = 'Initialization failed. ';\n  };\n  InitializationException.prototype.toString = function() {\n    return this.name + ': ' + this.message;\n  };\n\n\n  csm.Dimension = Dimension;\n  csm.Metric = Metric;\n  csm.WorkflowEvent = WorkflowEvent;\n  csm.NullOrUndefinedException = NullOrUndefinedException;\n  csm.AssertTrueException = AssertTrueException;\n  csm.InitializationException = InitializationException;\n  csm.ExceedDimensionLimitException = ExceedDimensionLimitException;\n})();\n\n(function() {\n  const global = self;\n  const csm = global.csm || {};\n  global.csm = csm;\n\n  const validTimeUnits = [csm.UNIT.SECONDS, csm.UNIT.MILLISECONDS, csm.UNIT.MICROSECONDS];\n  const validUnits = validTimeUnits.concat(csm.UNIT.COUNT);\n\n  const Util = {\n    assertExist: function(value, paramName) {\n      if (value === null || value === undefined) {\n        throw new csm.NullOrUndefinedException(paramName);\n      }\n    },\n    assertTrue: function(value) {\n      if (!value) {\n        throw new csm.AssertTrueException();\n      }\n    },\n    assertInObject: function(obj, objName, key) {\n      if (obj === null || obj === undefined || typeof obj !== 'object') {\n        throw new csm.NullOrUndefinedException(objName);\n      }\n      if (key === null || key === undefined || !obj[key]) {\n        throw new csm.NullOrUndefinedException(`${objName}[${key}]`);\n      }\n    },\n    isValidUnit: function(unit) {\n      return validUnits.includes(unit);\n    },\n    isValidTimeUnit: function(unit) {\n      return validTimeUnits.includes(unit);\n    },\n    isEmpty: function(value) {\n      if (value !== null && typeof val === 'object') {\n        return Objects.keys(value).length === 0;\n      }\n      return !value;\n    },\n    deepCopy: function(obj) {\n      // NOTE: this will fail if obj has a circular reference\n      return JSON.parse(JSON.stringify(obj));\n    },\n\n    /**\n     * This function is used before setting the page location for default metrics and logs,\n     * and the APIs that set page location\n     * Can be overridden by calling csm.API.setPageLocationTransformer(function(){})\n     * @param {string}        pathname path for page location\n     * @return {string}       pathname provided\n     */\n    pageLocationTransformer: function(pathname) {\n      return pathname;\n    },\n\n    /**\n     * As of now, our service public claims only support for Firefox and Chrome\n     * Reference https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent\n     *\n     * This function will only return firefox, chrome and others\n     *\n     * Best practice as indicated in MDN, \"Avoiding user agent detection\"\n     */\n    getBrowserDetails: function() {\n      const userAgent = window.navigator.userAgent;\n      const details = {};\n      if (userAgent.includes('Firefox') && !userAgent.includes('Seamonkey')) {\n        details.name = 'Firefox';\n        details.version = getBrowserVersion('Firefox');\n      } else if (userAgent.includes('Chrome') && !userAgent.includes('Chromium')) {\n        details.name = 'Chrome';\n        details.version = getBrowserVersion('Chrome');\n      }\n    },\n\n    randomId: function() {\n      return new Date().getTime() + '-' + Math.random().toString(36).slice(2);\n    },\n\n    getOrigin: function() {\n      return document.location.origin;\n    },\n\n    getReferrerUrl: function() {\n      const referrer = document.referrer || '';\n      return this.getURLOrigin(referrer);\n    },\n\n    getWindowParent: function() {\n      let parentLocation = '';\n      try {\n        parentLocation = window.parent.location.href;\n      } catch (e) {\n        parentLocation = '';\n      }\n      return parentLocation;\n    },\n\n    getURLOrigin: function(urlValue) {\n      let origin = '';\n      const originArray = urlValue.split( '/' );\n      if (originArray.length >= 3) {\n        const protocol = originArray[0];\n        const host = originArray[2];\n        origin = protocol + '//' + host;\n      }\n      return origin;\n    },\n\n  };\n\n  const getBrowserVersion = function(browserName) {\n    const userAgent = window.navigator.userAgent;\n    const browserNameIndex = userAgent.indexOf(browserName);\n    const nextSpaceIndex = userAgent.indexOf(' ', browserNameIndex);\n    if (nextSpaceIndex === -1) {\n      return userAgent.substring(browserNameIndex + browserName.length + 1, userAgent.length);\n    } else {\n      return userAgent.substring(browserNameIndex + browserName.length + 1, nextSpaceIndex);\n    }\n  };\n\n  csm.Util = Util;\n})();\n\n(function() {\n  const XHR_DONE_READY_STATE = 4; // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState\n\n  const global = self;\n  const configuration = {};\n  const batchSettings = {\n    maxMetricsSize: 30,\n    maxWorkflowEventsSize: 30,\n    putMetricsIntervalMs: 30000,\n    putWorkflowEventsIntervalMs: 2000,\n  };\n  const metricLists = {}; // metricList per CloudWatch Namespace\n  const metricMap = {};\n  const ports = {};\n  let workflowEvents = {workflowEventList: []};\n\n  // SharedWorker wiki:  https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker\n  onconnect = function(connectEvent) {\n    const port = connectEvent.ports[0];\n\n    port.onmessage = function(event) {\n      const data = event.data;\n      const messageType = data.type;\n      const message = data.message;\n      const endpoint = data.endpoint;\n      const headers = data.headers;\n\n      if (data.portId && !(data.portId in ports)) {\n        // This could happen when a user tries to close a tab which has a pop up alert to confirm closing,\n        // and the user decides to cancel closing\n        // This triggers before unload event while the tab or window is not closed actually\n        ports[data.portId] = port;\n      }\n\n      const {METRIC, WORKFLOW_EVENT, CUSTOM, CONFIG, SET_AUTH, SET_CONFIG, CLOSE} = csm.EVENT_TYPE;\n      switch (messageType) {\n        case METRIC: {\n          csm.Util.assertInObject(message, 'message', 'namespace');\n          const namespace = message.namespace;\n          if (shouldDedupe(message)) break;\n          addMetricEventToMap(message);\n          if (metricLists[namespace]) {\n            metricLists[namespace].push(message);\n          } else {\n            metricLists[namespace] = [message];\n          }\n          if (metricLists[namespace].length >= batchSettings.maxMetricsSize) {\n            putMetricsForNamespace(namespace);\n          }\n          break;\n        }\n        case WORKFLOW_EVENT: {\n          workflowEvents.workflowEventList.push(message);\n          if (workflowEvents.length >= batchSettings.maxWorkflowEventsSize) {\n            putWorkflowEvents();\n          }\n          break;\n        }\n        case CUSTOM: {\n          putCustom(endpoint, headers, message);\n          break;\n        }\n        case CONFIG: {\n          const portId = Object.keys(ports).length + 1; // portId starts from 1\n          ports[portId] = port;\n          for (const setting of Object.keys(message)) {\n            if (!csm.Util.isEmpty(message[setting])) {\n              configuration[setting] = message[setting];\n            }\n          }\n\n          // set optional batch settings\n          if (configuration.batchSettings) {\n            for (const setting of Object.keys(configuration.batchSettings)) {\n              batchSettings[setting] = configuration.batchSettings[setting];\n            }\n          }\n          // send metrics and workflow events at set intervals\n          putMetrics();\n          putWorkflowEvents();\n          global.setInterval(putMetrics, batchSettings.putMetricsIntervalMs);\n          global.setInterval(putWorkflowEvents, batchSettings.putWorkflowEventsIntervalMs);\n\n          port.postMessage(\n              {\n                type: csm.EVENT_TYPE.CONFIG,\n                portId: portId,\n              },\n          );\n          break;\n        }\n        case SET_AUTH: {\n          configuration.authParams = message;\n          authenticate();\n          break;\n        }\n        case SET_CONFIG: {\n          configuration[message.key] = message.value;\n          break;\n        }\n        case CLOSE: {\n          delete ports[data.portId];\n          if (Object.keys(ports).length === 0) {\n            putMetrics();\n            putWorkflowEvents();\n          }\n          break;\n        }\n        default:\n          break;\n      }\n    };\n  };\n\n  const shouldDedupe = function(metric) {\n    try {\n      const pastMetric = getPastMetricEvent(metric);\n      return pastMetric && metric.dedupeOptions &&\n        (metric.timestamp - pastMetric.timestamp < metric.dedupeOptions.dedupeIntervalMs);\n    } catch (err) {\n      console.error('Error in shouldDedupe', err);\n      return false;\n    }\n  };\n\n  const getPastMetricEvent = function(metric) {\n    try {\n      return metricMap[getMetricEventKey(metric)];\n    } catch (err) {\n      // ignore err - no previous metrics found\n      return null;\n    }\n  };\n\n  const addMetricEventToMap = function(metric) {\n    try {\n      metricMap[getMetricEventKey(metric)] = metric;\n    } catch (err) {\n      console.error('Failed to add event to metricMap', err);\n    }\n    csm.metricMap = metricMap;\n  };\n\n  const getMetricEventKey = function(metric) {\n    const {namespace, metricName, unit, dedupeOptions} = metric;\n    let context = 'global';\n    if (dedupeOptions && dedupeOptions.context) {\n      context = dedupeOptions.context;\n    }\n    return `${namespace}-${metricName}-${unit}-${context}`;\n  };\n\n  const authenticate = function() {\n    postRequest(configuration.endpointUrl + '/auth', {authParams: configuration.authParams},\n        {\n          success: function(response) {\n            if (response && response.jwtToken) {\n              configuration.authParams.jwtToken = response.jwtToken;\n            }\n          },\n          failure: function(response) {\n            broadcastMessage('[ERROR] csm auth failed!');\n            broadcastMessage('Response : ' + response);\n          },\n        }, {'x-api-key': 'auth-method-level-key'});\n  };\n\n  /**\n   * Put metrics to service when:\n   * a) metricList size is at maxMetricsSize\n   * b) every putMetricsIntervalMs time if the metricList is not empty\n   * c) worker is closed\n   *\n   * Timer is reset, and metricList emptied after each putMetrics call\n   */\n  const putMetrics = function() {\n    for (const namespace of Object.keys(metricLists)) {\n      putMetricsForNamespace(namespace);\n    }\n  };\n\n  const putMetricsForNamespace = function(namespace) {\n    csm.Util.assertInObject(metricLists, 'metricLists', namespace);\n    const metricList = metricLists[namespace];\n\n    if (metricList.length > 0 && !configuration.dryRunMode && configuration.endpointUrl) {\n      postRequest(configuration.endpointUrl + '/put-metrics', {\n        metricNamespace: namespace,\n        metricList: metricList,\n        authParams: configuration.authParams,\n        accountId: configuration.accountId,\n        organizationId: configuration.organizationId,\n        agentResourceId: configuration.userId,\n      }, {\n        success: function(response) {\n          if (response) {\n            broadcastMessage('PutMetrics response : ' + response);\n            if (response.unsetToken) {\n              delete configuration.authParams.jwtToken;\n              authenticate();\n            }\n          }\n        },\n        failure: function(response) {\n          broadcastMessage('[ERROR] Put metrics to service failed! ');\n        },\n      });\n    }\n    metricLists[namespace] = [];\n  };\n\n  /**\n   * Put metrics to service every two seconds if there are events to be put.\n   */\n  const putWorkflowEvents = function() {\n    if (workflowEvents.workflowEventList.length > 0 && !configuration.dryRunMode && configuration.endpointUrl) {\n      workflowEvents.authParams = configuration.authParams;\n      postRequest(configuration.endpointUrl + '/put-workflow-events', workflowEvents,\n          {\n            success: function(response) {\n              if (response) {\n                if (response.workflowEventList && response.workflowEventList.length > 0) {\n                  broadcastMessage('[WARN] There are ' + response.length + ' workflow events that failed to publish');\n                  broadcastMessage('Response : ' + response);\n                }\n                if (response.unsetToken) {\n                  delete configuration.authParams.jwtToken;\n                  authenticate();\n                }\n              }\n            },\n            failure: function(response) {\n              broadcastMessage('[ERROR] Put workflow events to service failed! ');\n            },\n          });\n    }\n\n    workflowEvents = {workflowEventList: []};\n  };\n\n  /**\n   * Put data to custom endpoint on demand\n   * @param {string} endpoint\n   * @param {object} headers\n   * @param {object} data to send to endpoint\n   */\n  const putCustom = function(endpoint, headers, data) {\n    if (!configuration.dryRunMode && endpoint && data) {\n      postRequest(endpoint, data, {\n        success: function(response) {\n          if (response) {\n            broadcastMessage('Response : ' + response);\n          }\n        },\n        failure: function(response) {\n          broadcastMessage('[ERROR] Failed to put custom data! ');\n        },\n      }, headers);\n    }\n  };\n\n  /**\n   * Broadcast message to all tabs\n   * @param {string} message to post to all the tabs\n   */\n  const broadcastMessage = function(message) {\n    for (const portId in ports) {\n      if (Object.prototype.hasOwnProperty.call(ports, portId)) {\n        ports[portId].postMessage(message);\n      }\n    }\n  };\n\n  const postRequest = function(url, data, callbacks, headers) {\n    csm.Util.assertExist(url, 'url');\n    csm.Util.assertExist(data, 'data');\n\n    callbacks = callbacks || {};\n    callbacks.success = callbacks.success || function() {};\n    callbacks.failure = callbacks.failure || function() {};\n\n    const request = new XMLHttpRequest(); // new HttpRequest instance\n    request.onreadystatechange = function() {\n      const errorList = request.response ? JSON.parse(request.response): [];\n      if (request.readyState === XHR_DONE_READY_STATE) { // request finished and response is ready\n        if (request.status === 200) {\n          callbacks.success(errorList);\n        } else {\n          broadcastMessage('AJAX request failed with status: ' + request.status);\n          callbacks.failure(errorList);\n        }\n      }\n    };\n\n    request.open('POST', url);\n    if (headers && typeof headers === 'object') {\n      Object.keys(headers).forEach((header) => request.setRequestHeader(header, headers[header]));\n    } else {\n      request.setRequestHeader('Content-Type', 'application/json');\n    }\n    request.send(JSON.stringify(data));\n  };\n})()".replace(/\\/g,""),r=URL.createObjectURL(new Blob([n],{type:"text/javascript"})),i=(e=>"https://ieluqbvv.telemetry.connect.".concat(e,".amazonaws.com/prod"))(e),o={endpoint:i,namespace:"chat-widget",sharedWorkerUrl:r};csm.initCSM(o),this.logger.info("CSMService is initialized in ".concat(e," cell-").concat(t)),this.csmInitialized=!0,this.metricsToBePublished&&(this.metricsToBePublished.forEach((e=>{csm.API.addMetric(e)})),this.metricsToBePublished=null)}catch(e){this.logger.error("Failed to initialize csm: ",e)}}updateCsmConfig(e){this.widgetType="object"!=typeof e||null===e||Array.isArray(e)?this.widgetType:e.widgetType}_hasCSMFailedToImport(){return"undefined"==typeof csm}getDefaultDimensions(){return[{name:"WidgetType",value:this.widgetType}]}addMetric(e){if(!this._hasCSMFailedToImport())if(this.csmInitialized)try{csm.API.addMetric(e)}catch(e){this.logger.error("Failed to addMetric csm: ",e)}else this.metricsToBePublished&&(this.metricsToBePublished.push(e),this.logger.info("CSMService is not initialized yet. Adding metrics to queue to be published once CSMService is initialized"))}setDimensions(e,t){t.forEach((t=>{e.addDimension(t.name,t.value)}))}addLatencyMetric(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!this._hasCSMFailedToImport())try{var i=new csm.Metric(e,csm.UNIT.MILLISECONDS,t),o=[...this.getDefaultDimensions(),{name:"Metric",value:"Latency"},{name:te,value:n},...r];this.setDimensions(i,o),this.addMetric(i),this.logger.debug("Successfully published latency API metrics for method ".concat(e))}catch(e){this.logger.error("Failed to addLatencyMetric csm: ",e)}}addLatencyMetricWithStartTime(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=(new Date).getTime()-t;this.addLatencyMetric(e,i,n,r),this.logger.debug("Successfully published latency API metrics for method ".concat(e))}addCountAndErrorMetric(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!this._hasCSMFailedToImport())try{var i=[...this.getDefaultDimensions(),{name:te,value:t},...r],o=new csm.Metric(e,csm.UNIT.COUNT,1);this.setDimensions(o,[...i,{name:"Metric",value:"Count"}]);var a=n?1:0,s=new csm.Metric(e,csm.UNIT.COUNT,a);this.setDimensions(s,[...i,{name:"Metric",value:"Error"}]),this.addMetric(o),this.addMetric(s),this.logger.debug("Successfully published count and error metrics for method ".concat(e))}catch(e){this.logger.error("Failed to addCountAndErrorMetric csm: ",e)}}addCountMetric(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!this._hasCSMFailedToImport())try{var r=[...this.getDefaultDimensions(),{name:te,value:t},{name:"Metric",value:"Count"},...n],i=new csm.Metric(e,csm.UNIT.COUNT,1);this.setDimensions(i,r),this.addMetric(i),this.logger.debug("Successfully published count metrics for method ".concat(e))}catch(e){this.logger.error("Failed to addCountMetric csm: ",e)}}addAgentCountMetric(e,t){if(!this._hasCSMFailedToImport())try{var n=this;csm&&csm.API.addCount&&e?(csm.API.addCount(e,t),n.MAX_RETRY=5):(e&&this.agentMetricToBePublished.push({metricName:e,count:t}),setTimeout((()=>{csm&&csm.API.addCount?(this.agentMetricToBePublished.forEach((e=>{csm.API.addCount(e.metricName,e.count)})),this.agentMetricToBePublished=[]):n.MAX_RETRY>0&&(n.MAX_RETRY-=1,n.addAgentCountMetric())}),3e3))}catch(e){this.logger.error("Failed to addAgentCountMetric csm: ",e)}}};function re(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}class ie{constructor(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.chatClient=t,this.participantToken=e||null,this.connectionDetails=null,this.connectionToken=null,this.connectionTokenExpiry=null,this.sessionType=n,this.getConnectionToken=r}getFetchedConnectionToken(){return this.connectionToken}getConnectionTokenExpiry(){return this.connectionTokenExpiry}getConnectionDetails(){return this.connectionDetails}fetchConnectionDetails(){return this._fetchConnectionDetails().then((e=>e))}_handleCreateParticipantConnectionResponse(e,t){return this.connectionDetails={url:e.Websocket.Url,expiry:e.Websocket.ConnectionExpiry,transportLifeTimeInSeconds:h,connectionAcknowledged:t,connectionToken:e.ConnectionCredentials.ConnectionToken,connectionTokenExpiry:e.ConnectionCredentials.Expiry},this.connectionToken=e.ConnectionCredentials.ConnectionToken,this.connectionTokenExpiry=e.ConnectionCredentials.Expiry,this.connectionDetails}_handleGetConnectionTokenResponse(e){return this.connectionDetails={url:null,expiry:null,connectionToken:e.participantToken,connectionTokenExpiry:e.expiry,transportLifeTimeInSeconds:h,connectionAcknowledged:!1},this.connectionToken=e.participantToken,this.connectionTokenExpiry=e.expiry,Promise.resolve(this.connectionDetails)}callCreateParticipantConnection(){var{Type:e=!0,ConnectParticipant:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(new Date).getTime();return this.chatClient.createParticipantConnection(this.participantToken,e?["WEBSOCKET","CONNECTION_CREDENTIALS"]:null,t||null).then((r=>{if(e)return this._addParticipantConnectionMetric(n),this._handleCreateParticipantConnectionResponse(r.data,t)})).catch((t=>(e&&this._addParticipantConnectionMetric(n,!0),Promise.reject({reason:"Failed to fetch connectionDetails with createParticipantConnection",_debug:t}))))}_addParticipantConnectionMetric(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];ne.addLatencyMetricWithStartTime(c.CREATE_PARTICIPANT_CONNECTION,e,s),ne.addCountAndErrorMetric(c.CREATE_PARTICIPANT_CONNECTION,s,t)}_fetchConnectionDetails(){var e,t=this;return(e=function*(){return t.sessionType===a.CUSTOMER?t.callCreateParticipantConnection():t.sessionType===a.AGENT?t.getConnectionToken().then((e=>t._handleGetConnectionTokenResponse(e.chatTokenTransport))).catch((()=>t.callCreateParticipantConnection({Type:!0,ConnectParticipant:!0}).catch((e=>{throw new Error({type:"CONN_ACK_FAILED",errorMessage:e})})))):Promise.reject({reason:"Failed to fetch connectionDetails.",_debug:new r("Failed to fetch connectionDetails.")})},function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){re(o,r,i,a,s,"next",e)}function s(e){re(o,r,i,a,s,"throw",e)}a(void 0)}))})()}}var oe=void 0!==oe?oe:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};oe.connect=oe.connect||{};var ae=connect.WebSocketManager;(()=>{var e={975:(e,t,n)=>{var r;!function(){var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function o(e){return function(e,t){var n,r,a,s,c,u,l,d,p,h=1,f=e.length,g="";for(r=0;r<f;r++)if("string"==typeof e[r])g+=e[r];else if("object"==typeof e[r]){if((s=e[r]).keys)for(n=t[h],a=0;a<s.keys.length;a++){if(null==n)throw new Error(o('[sprintf] Cannot access property "%s" of undefined value "%s"',s.keys[a],s.keys[a-1]));n=n[s.keys[a]]}else n=s.param_no?t[s.param_no]:t[h++];if(i.not_type.test(s.type)&&i.not_primitive.test(s.type)&&n instanceof Function&&(n=n()),i.numeric_arg.test(s.type)&&"number"!=typeof n&&isNaN(n))throw new TypeError(o("[sprintf] expecting number but found %T",n));switch(i.number.test(s.type)&&(d=n>=0),s.type){case"b":n=parseInt(n,10).toString(2);break;case"c":n=String.fromCharCode(parseInt(n,10));break;case"d":case"i":n=parseInt(n,10);break;case"j":n=JSON.stringify(n,null,s.width?parseInt(s.width):0);break;case"e":n=s.precision?parseFloat(n).toExponential(s.precision):parseFloat(n).toExponential();break;case"f":n=s.precision?parseFloat(n).toFixed(s.precision):parseFloat(n);break;case"g":n=s.precision?String(Number(n.toPrecision(s.precision))):parseFloat(n);break;case"o":n=(parseInt(n,10)>>>0).toString(8);break;case"s":n=String(n),n=s.precision?n.substring(0,s.precision):n;break;case"t":n=String(!!n),n=s.precision?n.substring(0,s.precision):n;break;case"T":n=Object.prototype.toString.call(n).slice(8,-1).toLowerCase(),n=s.precision?n.substring(0,s.precision):n;break;case"u":n=parseInt(n,10)>>>0;break;case"v":n=n.valueOf(),n=s.precision?n.substring(0,s.precision):n;break;case"x":n=(parseInt(n,10)>>>0).toString(16);break;case"X":n=(parseInt(n,10)>>>0).toString(16).toUpperCase()}i.json.test(s.type)?g+=n:(!i.number.test(s.type)||d&&!s.sign?p="":(p=d?"+":"-",n=n.toString().replace(i.sign,"")),u=s.pad_char?"0"===s.pad_char?"0":s.pad_char.charAt(1):" ",l=s.width-(p+n).length,c=s.width&&l>0?u.repeat(l):"",g+=s.align?p+n+c:"0"===u?p+c+n:c+p+n)}return g}(function(e){if(s[e])return s[e];for(var t,n=e,r=[],o=0;n;){if(null!==(t=i.text.exec(n)))r.push(t[0]);else if(null!==(t=i.modulo.exec(n)))r.push("%");else{if(null===(t=i.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){o|=1;var a=[],c=t[2],u=[];if(null===(u=i.key.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(a.push(u[1]);""!==(c=c.substring(u[0].length));)if(null!==(u=i.key_access.exec(c)))a.push(u[1]);else{if(null===(u=i.index_access.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");a.push(u[1])}t[2]=a}else o|=2;if(3===o)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}n=n.substring(t[0].length)}return s[e]=r}(e),arguments)}function a(e,t){return o.apply(null,[e].concat(t||[]))}var s=Object.create(null);t.sprintf=o,t.vsprintf=a,"undefined"!=typeof window&&(window.sprintf=o,window.vsprintf=a,void 0===(r=function(){return{sprintf:o,vsprintf:a}}.call(t,n,t,e))||(e.exports=r))}()}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}(()=>{function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}var t=n(975),r="AMZ_WEB_SOCKET_MANAGER:",i="aws/subscribe",o="aws/heartbeat",a="aws/ping",s="disconnected",c={assertTrue:function(e,t){if(!e)throw new Error(t)},assertNotNull:function(n,r){return c.assertTrue(null!==n&&void 0!==e(n),(0,t.sprintf)("%s must be provided",r||"A value")),n},isNonEmptyString:function(e){return"string"==typeof e&&e.length>0},assertIsList:function(e,t){if(!Array.isArray(e))throw new Error(t+" is not an array")},isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},isObject:function(t){return!("object"!==e(t)||null===t)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e}},u=new RegExp("^(wss://)\\w*"),l=new RegExp("^(ws://127.0.0.1:)");c.validWSUrl=function(e){return u.test(e)||l.test(e)},c.getSubscriptionResponse=function(e,t,n){return{topic:e,content:{status:t?"success":"failure",topics:n}}},c.assertIsObject=function(e,t){if(!c.isObject(e))throw new Error(t+" is not an object!")},c.addJitter=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;t=Math.min(t,1);var n=Math.random()>.5?1:-1;return Math.floor(e+n*e*Math.random()*t)},c.isNetworkOnline=function(){return navigator.onLine},c.isNetworkFailure=function(e){return!(!e._debug||!e._debug.type)&&"NetworkingError"===e._debug.type},c.isMobile=function(){return/Android|webOS|Mobi|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},c.isMobileDisconnectFailure=function(e){var t,n;return c.isMobile()&&"TypeError"===(null==e||null===(t=e._debug)||void 0===t?void 0:t.type)&&"Load failed"===(null==e||null===(n=e._debug)||void 0===n?void 0:n.message)},c.isMobileFetchFailure=function(e){var t,n;return c.isMobile()&&"TypeError"===(null==e||null===(t=e._debug)||void 0===t?void 0:t.type)&&"Failed to fetch"===(null==e||null===(n=e._debug)||void 0===n?void 0:n.message)};var d=c;function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(t){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=h(t);if(n){var o=h(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,r)}}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var w=function(){function e(){g(this,e)}return v(e,[{key:"debug",value:function(e){}},{key:"info",value:function(e){}},{key:"warn",value:function(e){}},{key:"error",value:function(e){}},{key:"advancedLog",value:function(e){}}]),e}(),E=r,C={DEBUG:10,INFO:20,WARN:30,ERROR:40,ADVANCED_LOG:50},S=function(){function t(e){g(this,t),this.logMetaData=e||"",this.updateLoggerConfig()}return v(t,[{key:"hasLogMetaData",value:function(){return!!this.logMetaData}},{key:"writeToClientLogger",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(this.hasClientLogger()){var n="string"==typeof t?t:JSON.stringify(t,A()),r="string"==typeof this.logMetaData?this.logMetaData:JSON.stringify(this.logMetaData,A()),i="".concat(function(e){switch(e){case 10:return"DEBUG";case 20:return"INFO";case 30:return"WARN";case 40:return"ERROR";case 50:return"ADVANCED_LOG"}}(e)," ").concat(n);switch(r&&(i+=" ".concat(r)),e){case C.DEBUG:return this._clientLogger.debug(i)||i;case C.INFO:return this._clientLogger.info(i)||i;case C.WARN:return this._clientLogger.warn(i)||i;case C.ERROR:return this._clientLogger.error(i)||i;case C.ADVANCED_LOG:return this._advancedLogWriter?this._clientLogger[this._advancedLogWriter](i)||i:""}}}},{key:"isLevelEnabled",value:function(e){return e>=this._level}},{key:"hasClientLogger",value:function(){return null!==this._clientLogger}},{key:"getLogger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.prefix||E;return e.logMetaData&&this.setLogMetaData(e.logMetaData),new I(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({prefix:t,logMetaData:this.logMetaData},e))}},{key:"setLogMetaData",value:function(e){this.logMetaData=e}},{key:"updateLoggerConfig",value:function(t){var n=t||{};this._level=n.level||C.INFO,this._advancedLogWriter="warn",n.advancedLogWriter&&(this._advancedLogWriter=n.advancedLogWriter),n.customizedLogger&&"object"===e(n.customizedLogger)?this.useClientLogger=!0:this.useClientLogger=!1,this._clientLogger=n.logger||this.selectLogger(n),this._logsDestination="NULL",n.debug&&(this._logsDestination="DEBUG"),n.logger&&(this._logsDestination="CLIENT_LOGGER")}},{key:"selectLogger",value:function(t){return t.customizedLogger&&"object"===e(t.customizedLogger)?t.customizedLogger:t.useDefaultLogger?k():null}}]),t}(),T=function(){function e(){g(this,e)}return v(e,[{key:"debug",value:function(){}},{key:"info",value:function(){}},{key:"warn",value:function(){}},{key:"error",value:function(){}},{key:"advancedLog",value:function(){}}]),e}(),I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(n,e);var t=y(n);function n(e,r){var i;return g(this,n),(i=t.call(this)).options=r||{},i.prefix=r.prefix||E,i.excludeTimestamp=r.excludeTimestamp,i.logManager=e,i}return v(n,[{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this._log(C.DEBUG,t)}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this._log(C.INFO,t)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this._log(C.WARN,t)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this._log(C.ERROR,t)}},{key:"advancedLog",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this._log(C.ADVANCED_LOG,t)}},{key:"_shouldLog",value:function(e){return this.logManager.hasClientLogger()&&this.logManager.isLevelEnabled(e)}},{key:"_writeToClientLogger",value:function(e,t){return this.logManager.writeToClientLogger(e,t)}},{key:"_log",value:function(e,t){if(this._shouldLog(e)){var n=this.logManager.useClientLogger?t:this._convertToSingleStatement(t);return this._writeToClientLogger(e,n)}}},{key:"_convertToSingleStatement",value:function(e){var t=new Date(Date.now()).toISOString(),n=this.excludeTimestamp?"":"[".concat(t,"] ");(this.prefix||this.options.prefix)&&(n+=(this.options.prefix||this.prefix)+":");for(var r=0;r<e.length;r++){var i=e[r];n+=this._convertToString(i)+" "}return n}},{key:"_convertToString",value:function(e){try{if(!e)return"";if(d.isString(e))return e;if(d.isObject(e)&&d.isFunction(e.toString)){var t=e.toString();if(!t.startsWith("[object"))return t}return JSON.stringify(e)}catch(t){return console.error("Error while converting argument to string",e,t),""}}}]),n}(T);function A(){var t=new WeakSet;return function(n,r){if("object"===e(r)&&null!==r){if(t.has(r))return;t.add(r)}return r}}var k=function(){var e=new T;return e.debug=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.debug.apply(window.console,[].concat(t))},e.info=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.info.apply(window.console,[].concat(t))},e.warn=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.warn.apply(window.console,[].concat(t))},e.error=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.error.apply(window.console,[].concat(t))},e},O=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3;g(this,e),this.numAttempts=0,this.executor=t,this.hasActiveReconnection=!1,this.defaultRetry=n}return v(e,[{key:"retry",value:function(e){var t=this;this.hasActiveReconnection||(this.hasActiveReconnection=!0,setTimeout((function(){t._execute(e)}),this._getDelay()))}},{key:"_execute",value:function(e){this.hasActiveReconnection=!1,this.executor(e),this.numAttempts++}},{key:"connected",value:function(){this.numAttempts=0}},{key:"_getDelay",value:function(){var e=Math.pow(2,this.numAttempts)*this.defaultRetry;return e<=3e4?e:3e4}},{key:"getIsConnected",value:function(){return!this.numAttempts}}]),e}(),M=null,N=function(){var e,t=M.getLogger({prefix:r,excludeTimestamp:!0}),n=d.isNetworkOnline(),c={primary:null,secondary:null},u={reconnectWebSocket:!0,websocketInitFailed:!1,exponentialBackOffTime:1e3,exponentialTimeoutHandle:null,lifeTimeTimeoutHandle:null,webSocketInitCheckerTimeoutId:null,connState:null},l={connectWebSocketRetryCount:0,connectionAttemptStartTime:null,noOpenConnectionsTimestamp:null},p={pendingResponse:!1,intervalHandle:null},h={pendingResponse:!1,intervalHandle:null},f={initFailure:new Set,getWebSocketTransport:null,subscriptionUpdate:new Set,subscriptionFailure:new Set,topic:new Map,allMessage:new Set,connectionGain:new Set,connectionLost:new Set,connectionOpen:new Set,connectionClose:new Set,deepHeartbeatSuccess:new Set,deepHeartbeatFailure:new Set,topicFailure:new Set},g={connConfig:null,promiseHandle:null,promiseCompleted:!0},m={subscribed:new Set,pending:new Set,subscriptionHistory:new Set},v={responseCheckIntervalId:null,requestCompleted:!0,reSubscribeIntervalId:null,consecutiveFailedSubscribeAttempts:0,consecutiveNoResponseRequest:0},y=!1,b=new O((function(e){q(e).catch((function(){}))}));d.isMobile()&&null!==(e=window)&&void 0!==e&&e.document&&window.document.addEventListener("visibilitychange",(function(){b.getIsConnected()&&("hidden"===window.document.visibilityState?y=!0:setTimeout((function(){y=!1,A(c.primary)||A(c.secondary)||q().catch((function(){}))}),500))}));var w=new Set([i,"aws/unsubscribe",o,a]),E=setInterval((function(){if(n!==d.isNetworkOnline()){if(!(n=d.isNetworkOnline()))return void J(t.advancedLog("Network offline"));var e=N();n&&(!e||I(e,WebSocket.CLOSING)||I(e,WebSocket.CLOSED))&&(J(t.advancedLog("Network online, connecting to WebSocket server")),q().catch((function(){})))}}),250),C=function(e,n){e.forEach((function(e){try{e(n)}catch(e){J(t.error("Error executing callback",e))}}))},S=function(e){if(null===e)return"NULL";switch(e.readyState){case WebSocket.CONNECTING:return"CONNECTING";case WebSocket.OPEN:return"OPEN";case WebSocket.CLOSING:return"CLOSING";case WebSocket.CLOSED:return"CLOSED";default:return"UNDEFINED"}},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";J(t.debug("["+e+"] Primary WebSocket: "+S(c.primary)+" | Secondary WebSocket: "+S(c.secondary)))},I=function(e,t){return e&&e.readyState===t},A=function(e){return I(e,WebSocket.OPEN)},k=function(e){return null===e||void 0===e.readyState||I(e,WebSocket.CLOSED)},N=function(){return null!==c.secondary?c.secondary:c.primary},P=function(){return A(N())},R=function(){if(h.pendingResponse&&(J(t.debug("aws/ping deep heartbeat response not received")),C(f.deepHeartbeatFailure,{timestamp:Date.now(),error:"aws/ping response is not received"}),clearInterval(h.intervalHandle),h.pendingResponse=!1),p.pendingResponse)return J(t.warn("Heartbeat response not received")),clearInterval(p.intervalHandle),p.intervalHandle=null,p.pendingResponse=!1,void q().catch((function(){}));P()?(J(t.debug("Sending aws/ping deep heartbeat")),N().send(z(a)),h.pendingResponse=!0,J(t.debug("Sending heartbeat")),N().send(z(o)),p.pendingResponse=!0):(J(t.debug("Failed to send aws/ping deep heartbeat since WebSocket is not open")),C(f.deepHeartbeatFailure,{timestamp:Date.now(),error:"Unable to send message to aws/ping because websocket connection is not established."}),J(t.warn("Failed to send heartbeat since WebSocket is not open")),T("sendHeartBeat"),q().catch((function(){})))},_=function(){J(t.advancedLog("Reset Websocket state")),u.exponentialBackOffTime=1e3,p.pendingResponse=!1,h.pendingResponse=!1,u.reconnectWebSocket=!0,clearTimeout(u.lifeTimeTimeoutHandle),clearInterval(p.intervalHandle),clearInterval(h.intervalHandle),clearTimeout(u.exponentialTimeoutHandle),clearTimeout(u.webSocketInitCheckerTimeoutId),p.intervalHandle=null},D=function(){v.consecutiveFailedSubscribeAttempts=0,v.consecutiveNoResponseRequest=0,clearInterval(v.responseCheckIntervalId),clearInterval(v.reSubscribeIntervalId)},x=function(){l.connectWebSocketRetryCount=0,l.connectionAttemptStartTime=null,l.noOpenConnectionsTimestamp=null},L=function(){b.connected();try{J(t.advancedLog("WebSocket connection established!")),T("webSocketOnOpen"),null!==u.connState&&u.connState!==s||C(f.connectionGain),u.connState="connected";var e=Date.now();C(f.connectionOpen,{connectWebSocketRetryCount:l.connectWebSocketRetryCount,connectionAttemptStartTime:l.connectionAttemptStartTime,noOpenConnectionsTimestamp:l.noOpenConnectionsTimestamp,connectionEstablishedTime:e,timeToConnect:e-l.connectionAttemptStartTime,timeWithoutConnection:l.noOpenConnectionsTimestamp?e-l.noOpenConnectionsTimestamp:null}),x(),_(),N().openTimestamp=Date.now(),0===m.subscribed.size&&A(c.secondary)&&W(c.primary,"[Primary WebSocket] Closing WebSocket"),(m.subscribed.size>0||m.pending.size>0)&&(A(c.secondary)&&J(t.info("Subscribing secondary websocket to topics of primary websocket")),m.subscribed.forEach((function(e){m.subscriptionHistory.add(e),m.pending.add(e)})),m.subscribed.clear(),j()),R(),null!==p.intervalHandle&&clearInterval(p.intervalHandle),p.intervalHandle=setInterval(R,1e4);var n=1e3*g.connConfig.webSocketTransport.transportLifeTimeInSeconds;J(t.debug("Scheduling WebSocket manager reconnection, after delay "+n+" ms")),u.lifeTimeTimeoutHandle=setTimeout((function(){J(t.debug("Starting scheduled WebSocket manager reconnection")),q().catch((function(){}))}),n)}catch(e){J(t.error("Error after establishing WebSocket connection",e))}},U=function(e){T("webSocketOnError"),J(t.advancedLog("WebSocketManager Error, error_event: ",JSON.stringify(e))),b.getIsConnected()?q().catch((function(){})):b.retry()},F=function(e){if(void 0!==e.data&&""!==e.data){var n=JSON.parse(e.data);switch(n.topic){case i:if(J(t.debug("Subscription Message received from webSocket server")),v.requestCompleted=!0,v.consecutiveNoResponseRequest=0,"success"===n.content.status)v.consecutiveFailedSubscribeAttempts=0,n.content.topics.forEach((function(e){m.subscriptionHistory.delete(e),m.pending.delete(e),m.subscribed.add(e)})),0===m.subscriptionHistory.size?A(c.secondary)&&(J(t.debug("Successfully subscribed secondary websocket to all topics of primary websocket")),W(c.primary,"[Primary WebSocket] Closing WebSocket")):j(),C(f.subscriptionUpdate,n);else{if(clearInterval(v.reSubscribeIntervalId),++v.consecutiveFailedSubscribeAttempts,5===v.consecutiveFailedSubscribeAttempts)return C(f.subscriptionFailure,n),void(v.consecutiveFailedSubscribeAttempts=0);v.reSubscribeIntervalId=setInterval((function(){j()}),500)}break;case o:J(t.debug("Heartbeat response received")),p.pendingResponse=!1,null===p.intervalHandle&&(p.intervalHandle=setInterval(R,1e4));break;case a:J(t.debug("aws/ping deep heartbeat received")),h.pendingResponse=!1,200===n.statusCode?C(f.deepHeartbeatSuccess,{timestamp:Date.now()}):C(f.deepHeartbeatFailure,{timestamp:Date.now(),statusCode:n.statusCode,statusContent:n.statusContent});break;default:if(n.topic){if(J(t.advancedLog("Message received for topic ",n.topic)),A(c.primary)&&A(c.secondary)&&0===m.subscriptionHistory.size&&this===c.primary)return void J(t.warn("Ignoring Message for Topic "+n.topic+", to avoid duplicates"));if(0===f.allMessage.size&&0===f.topic.size)return void J(t.warn("No registered callback listener for Topic",n.topic));J(t.advancedLog("WebsocketManager invoke callbacks for topic success ",n.topic)),C(f.allMessage,n),f.topic.has(n.topic)&&C(f.topic.get(n.topic),n)}else n.message?(J(t.advancedLog("WebSocketManager Message Error",n)),C(f.topicFailure,{timestamp:Date.now(),errorMessage:n.message,connectionId:n.connectionId,requestId:n.requestId})):J(t.advancedLog("Invalid incoming message",n))}}else J(t.warn("An empty message has been received on Websocket. Ignoring"))},j=function e(){if(v.consecutiveNoResponseRequest>3)return J(t.warn("Ignoring subscribePendingTopics since we have exhausted max subscription retries with no response")),void C(f.subscriptionFailure,d.getSubscriptionResponse(i,!1,Array.from(m.pending)));P()?0!==Array.from(m.pending).length&&(clearInterval(v.responseCheckIntervalId),N().send(z(i,{topics:Array.from(m.pending)})),v.requestCompleted=!1,v.responseCheckIntervalId=setInterval((function(){v.requestCompleted||(++v.consecutiveNoResponseRequest,e())}),1e3)):J(t.warn("Ignoring subscribePendingTopics call since Default WebSocket is not open"))},W=function(e,n){I(e,WebSocket.CONNECTING)||I(e,WebSocket.OPEN)?e.close(1e3,n):J(t.warn("Ignoring WebSocket Close request, WebSocket State: "+S(e)))},H=function(e){W(c.primary,"[Primary] WebSocket "+e),W(c.secondary,"[Secondary] WebSocket "+e)},B=function(e){_(),D(),J(t.advancedLog("WebSocket Initialization failed - Terminating and cleaning subscriptions",e)),u.websocketInitFailed=!0,H("Terminating WebSocket Manager"),clearInterval(E),C(f.initFailure,{connectWebSocketRetryCount:l.connectWebSocketRetryCount,connectionAttemptStartTime:l.connectionAttemptStartTime,reason:e}),x()},z=function(e,t){return JSON.stringify({topic:e,content:t})},G=function(e){return!!(d.isObject(e)&&d.isObject(e.webSocketTransport)&&d.isNonEmptyString(e.webSocketTransport.url)&&d.validWSUrl(e.webSocketTransport.url)&&1e3*e.webSocketTransport.transportLifeTimeInSeconds>=3e5)||(J(t.error("Invalid WebSocket Connection Configuration",e)),!1)},q=function(){return y?(J(t.debug("Chat widget backgrounded. Ignoring getWebSocketConnConfig requests until chat widget foregrounded.")),Promise.resolve()):d.isNetworkOnline()?u.websocketInitFailed?(J(t.debug("WebSocket Init had failed, ignoring this getWebSocketConnConfig request")),Promise.resolve({webSocketConnectionFailed:!0})):g.promiseCompleted?(_(),J(t.advancedLog("Fetching new WebSocket connection configuration")),l.connectionAttemptStartTime=l.connectionAttemptStartTime||Date.now(),g.promiseCompleted=!1,g.promiseHandle=f.getWebSocketTransport(),g.promiseHandle.then((function(e){return g.promiseCompleted=!0,J(t.advancedLog("Successfully fetched webSocket connection configuration")),G(e)?(g.connConfig=e,g.connConfig.urlConnValidTime=Date.now()+85e3,V()):(B("Invalid WebSocket connection configuration: "+e),{webSocketConnectionFailed:!0})}),(function(e){return g.promiseCompleted=!0,J(t.advancedLog("Failed to fetch webSocket connection configuration",e)),d.isNetworkFailure(e)||d.isMobileDisconnectFailure(e)||d.isMobileFetchFailure(e)?(J(t.advancedLog("Retrying fetching new WebSocket connection configuration",e)),b.retry()):B("Failed to fetch webSocket connection configuration: "+JSON.stringify(e)),{webSocketConnectionFailed:!0}}))):(J(t.debug("There is an ongoing getWebSocketConnConfig request, this request will be ignored")),Promise.resolve({webSocketConnectionFailed:!0})):(J(t.advancedLog("Network offline, ignoring this getWebSocketConnConfig request")),Promise.resolve({webSocketConnectionFailed:!0}))},V=function e(){if(u.websocketInitFailed)return J(t.info("web-socket initializing had failed, aborting re-init")),{webSocketConnectionFailed:!0};if(!d.isNetworkOnline())return J(t.warn("System is offline aborting web-socket init")),{webSocketConnectionFailed:!0};J(t.advancedLog("Initializing Websocket Manager")),T("initWebSocket");try{if(G(g.connConfig)){var n=null;return A(c.primary)?(J(t.debug("Primary Socket connection is already open")),I(c.secondary,WebSocket.CONNECTING)||(J(t.debug("Establishing a secondary web-socket connection")),b.numAttempts=0,c.secondary=$()),n=c.secondary):(I(c.primary,WebSocket.CONNECTING)||(J(t.debug("Establishing a primary web-socket connection")),c.primary=$()),n=c.primary),u.webSocketInitCheckerTimeoutId=setTimeout((function(){A(n)||function(){l.connectWebSocketRetryCount++;var n=d.addJitter(u.exponentialBackOffTime,.3);Date.now()+n<=g.connConfig.urlConnValidTime?(J(t.advancedLog("Scheduling WebSocket reinitialization, after delay "+n+" ms")),u.exponentialTimeoutHandle=setTimeout((function(){return e()}),n),u.exponentialBackOffTime*=2):(J(t.advancedLog("WebSocket URL cannot be used to establish connection")),q().catch((function(){})))}()}),1e3),{webSocketConnectionFailed:!1}}}catch(n){return J(t.error("Error Initializing web-socket-manager",n)),B("Failed to initialize new WebSocket: "+n.message),{webSocketConnectionFailed:!0}}},$=function(){var e=new WebSocket(g.connConfig.webSocketTransport.url);return e.addEventListener("open",L),e.addEventListener("message",F),e.addEventListener("error",U),e.addEventListener("close",(function(n){return function(e,n){var r={openTimestamp:n.openTimestamp,closeTimestamp:Date.now(),connectionDuration:Date.now()-n.openTimestamp,code:e.code,reason:e.reason,wasClean:e.wasClean},i="Close Code: ".concat(r.code," - Reason: ").concat(r.reason," - WasClean: ").concat(r.wasClean),o="OpenTimestamp: ".concat(r.openTimestamp," - CloseTimestamp: ").concat(r.closeTimestamp," - ConnectionDuration: ").concat(r.connectionDuration);J(t.advancedLog("WebSocket connection is closed. ",i)),J(t.advancedLog("Closed WebSocket connection duration: ",o)),T("webSocketOnClose before-cleanup"),C(f.connectionClose,r),k(c.primary)&&(c.primary=null),k(c.secondary)&&(c.secondary=null),u.reconnectWebSocket&&(A(c.primary)||A(c.secondary)?k(c.primary)&&A(c.secondary)&&(J(t.debug("[Primary] WebSocket Cleanly Closed")),c.primary=c.secondary,c.secondary=null):(J(t.warn("Neither primary websocket and nor secondary websocket have open connections, attempting to re-establish connection")),u.connState===s?J(t.info("Ignoring connectionLost callback invocation")):(C(f.connectionLost,{openTimestamp:n.openTimestamp,closeTimestamp:Date.now(),connectionDuration:Date.now()-n.openTimestamp,code:e.code,reason:e.reason}),l.noOpenConnectionsTimestamp=Date.now()),u.connState=s,q().catch((function(){}))),T("webSocketOnClose after-cleanup"))}(n,e)})),e},J=function(e){return e&&"function"==typeof e.sendInternalLogToServer&&e.sendInternalLogToServer(),e};this.init=function(e){if(d.assertTrue(d.isFunction(e),"transportHandle must be a function"),null===f.getWebSocketTransport)return f.getWebSocketTransport=e,q();J(t.warn("Web Socket Manager was already initialized"))},this.onInitFailure=function(e){return J(t.advancedLog("Initializing Websocket Manager Failure callback registered")),d.assertTrue(d.isFunction(e),"cb must be a function"),f.initFailure.add(e),u.websocketInitFailed&&e(),function(){return f.initFailure.delete(e)}},this.onConnectionOpen=function(e){return J(t.advancedLog("Websocket connection open callback registered")),d.assertTrue(d.isFunction(e),"cb must be a function"),f.connectionOpen.add(e),function(){return f.connectionOpen.delete(e)}},this.onConnectionClose=function(e){return J(t.advancedLog("Websocket connection close callback registered")),d.assertTrue(d.isFunction(e),"cb must be a function"),f.connectionClose.add(e),function(){return f.connectionClose.delete(e)}},this.onConnectionGain=function(e){return J(t.advancedLog("Websocket connection gain callback registered")),d.assertTrue(d.isFunction(e),"cb must be a function"),f.connectionGain.add(e),P()&&e(),function(){return f.connectionGain.delete(e)}},this.onConnectionLost=function(e){return J(t.advancedLog("Websocket connection lost callback registered")),d.assertTrue(d.isFunction(e),"cb must be a function"),f.connectionLost.add(e),u.connState===s&&e(),function(){return f.connectionLost.delete(e)}},this.onSubscriptionUpdate=function(e){return d.assertTrue(d.isFunction(e),"cb must be a function"),f.subscriptionUpdate.add(e),function(){return f.subscriptionUpdate.delete(e)}},this.onSubscriptionFailure=function(e){return J(t.advancedLog("Websocket subscription failure callback registered")),d.assertTrue(d.isFunction(e),"cb must be a function"),f.subscriptionFailure.add(e),function(){return f.subscriptionFailure.delete(e)}},this.onMessage=function(e,t){return d.assertNotNull(e,"topicName"),d.assertTrue(d.isFunction(t),"cb must be a function"),f.topic.has(e)?f.topic.get(e).add(t):f.topic.set(e,new Set([t])),function(){return f.topic.get(e).delete(t)}},this.onAllMessage=function(e){return d.assertTrue(d.isFunction(e),"cb must be a function"),f.allMessage.add(e),function(){return f.allMessage.delete(e)}},this.subscribeTopics=function(e){d.assertNotNull(e,"topics"),d.assertIsList(e),e.forEach((function(e){m.subscribed.has(e)||m.pending.add(e)})),v.consecutiveNoResponseRequest=0,j()},this.sendMessage=function(e){if(d.assertIsObject(e,"payload"),void 0===e.topic||w.has(e.topic))J(t.warn("Cannot send message, Invalid topic: "+e.topic));else{try{e=JSON.stringify(e)}catch(n){return void J(t.warn("Error stringify message",e))}P()?N().send(e):J(t.warn("Cannot send message, web socket connection is not open"))}},this.onDeepHeartbeatSuccess=function(e){return J(t.advancedLog("Websocket deep heartbeat success callback registered")),d.assertTrue(d.isFunction(e),"cb must be a function"),f.deepHeartbeatSuccess.add(e),function(){return f.deepHeartbeatSuccess.delete(e)}},this.onDeepHeartbeatFailure=function(e){return J(t.advancedLog("Websocket deep heartbeat failure callback registered")),d.assertTrue(d.isFunction(e),"cb must be a function"),f.deepHeartbeatFailure.add(e),function(){return f.deepHeartbeatFailure.delete(e)}},this.onTopicFailure=function(e){return J(t.advancedLog("Websocket topic failure callback registered")),d.assertTrue(d.isFunction(e),"cb must be a function"),f.topicFailure.add(e),function(){return f.topicFailure.delete(e)}},this.closeWebSocket=function(){_(),D(),u.reconnectWebSocket=!1,clearInterval(E),H("User request to close WebSocket")},this.terminateWebSocketManager=B},P={create:function(e){return M||(M=new S(e)),M.hasLogMetaData()||M.setLogMetaData(e),new N},setGlobalConfig:function(e){var t=e&&e.loggerConfig;M||(M=new S),M.updateLoggerConfig(t);var n=e&&e.webSocketManagerConfig,r=n&&n.isNetworkOnline;r&&"function"==typeof r&&(d.isNetworkOnline=r)},LogLevel:C,Logger:w};oe.connect=oe.connect||{},connect.WebSocketManager=P})()})();var se=connect.WebSocketManager;connect.WebSocketManager=ae||se;const ce=se;class ue extends Y{constructor(e,t,n,r,i,o){super(n,i),this.customerConnection=!r,this.customerConnection?(ue.customerBaseInstances[e]||(ue.customerBaseInstances[e]=new le(n,void 0,i,o)),this.baseInstance=ue.customerBaseInstances[e]):(ue.agentBaseInstance&&ue.agentBaseInstance.getWebsocketManager()!==r&&(ue.agentBaseInstance.end(),ue.agentBaseInstance=null),ue.agentBaseInstance||(ue.agentBaseInstance=new le(void 0,r,i)),this.baseInstance=ue.agentBaseInstance),this.contactId=e,this.initialContactId=t,this.status=null,this.eventBus=new ee,this.subscriptions=[this.baseInstance.onEnded(this.handleEnded.bind(this)),this.baseInstance.onConnectionGain(this.handleConnectionGain.bind(this)),this.baseInstance.onConnectionLost(this.handleConnectionLost.bind(this)),this.baseInstance.onMessage(this.handleMessage.bind(this)),this.baseInstance.onDeepHeartbeatSuccess(this.handleDeepHeartbeatSuccess.bind(this)),this.baseInstance.onDeepHeartbeatFailure(this.handleDeepHeartbeatFailure.bind(this)),this.baseInstance.onBackgroundChatEnded(this.handleBackgroundChatEnded.bind(this))]}start(){return super.start(),this.baseInstance.start()}end(){super.end(),this.eventBus.unsubscribeAll(),this.subscriptions.forEach((e=>e())),this.status=W,this.tryCleanup()}tryCleanup(){this.customerConnection&&!this.baseInstance.hasMessageSubscribers()&&(this.baseInstance.end(),delete ue.customerBaseInstances[this.contactId])}getStatus(){return this.status||this.baseInstance.getStatus()}onEnded(e){return this.eventBus.subscribe(q,e)}handleEnded(){this.eventBus.trigger(q,{})}onConnectionGain(e){return this.eventBus.subscribe(G,e)}handleConnectionGain(){this.eventBus.trigger(G,{})}onConnectionLost(e){return this.eventBus.subscribe(z,e)}handleConnectionLost(){this.eventBus.trigger(z,{})}onDeepHeartbeatSuccess(e){return this.eventBus.subscribe($,e)}handleDeepHeartbeatSuccess(){this.eventBus.trigger($,{})}onDeepHeartbeatFailure(e){return this.eventBus.subscribe(J,e)}handleDeepHeartbeatFailure(){this.eventBus.trigger(J,{})}onMessage(e){return this.eventBus.subscribe(V,e)}onBackgroundChatEnded(e){return this.eventBus.subscribe(K,e)}handleBackgroundChatEnded(){this.eventBus.trigger(K,{})}handleMessage(e){e.InitialContactId!==this.initialContactId&&e.ContactId!==this.contactId&&e.Type!==l.MESSAGE_METADATA||this.eventBus.trigger(V,e)}}ue.customerBaseInstances={},ue.agentBaseInstance=null;class le{constructor(e,t,n,r){this.status=L,this.eventBus=new ee,this.logger=b.getLogger({prefix:"ChatJS-LPCConnectionHelperBase",logMetaData:n}),this.initialConnectionDetails=r,this.initWebsocketManager(t,e,n)}initWebsocketManager(e,t,n){var r,i,o,a;if(this.websocketManager=e||ce.create(n),this.websocketManager.subscribeTopics(["aws/chat"]),this.subscriptions=[this.websocketManager.onMessage("aws/chat",this.handleMessage.bind(this)),this.websocketManager.onConnectionGain(this.handleConnectionGain.bind(this)),this.websocketManager.onConnectionLost(this.handleConnectionLost.bind(this)),this.websocketManager.onInitFailure(this.handleEnded.bind(this)),null===(r=(i=this.websocketManager).onDeepHeartbeatSuccess)||void 0===r?void 0:r.call(i,this.handleDeepHeartbeatSuccess.bind(this)),null===(o=(a=this.websocketManager).onDeepHeartbeatFailure)||void 0===o?void 0:o.call(a,this.handleDeepHeartbeatFailure.bind(this))],this.logger.info("Initializing websocket manager."),!e){var s=(new Date).getTime();this.websocketManager.init((()=>this._getConnectionDetails(t,this.initialConnectionDetails,s).then((e=>(this.initialConnectionDetails=null,e)))))}}_getConnectionDetails(e,t,n){if(null!==t&&"object"==typeof t&&t.expiry&&t.connectionTokenExpiry){var r={expiry:t.expiry,transportLifeTimeInSeconds:h};return this.logger.debug("Websocket manager initialized. Connection details:",r),Promise.resolve({webSocketTransport:{url:t.url,expiry:t.expiry,transportLifeTimeInSeconds:h}})}return e.fetchConnectionDetails().then((e=>{var t={webSocketTransport:{url:e.url,expiry:e.expiry,transportLifeTimeInSeconds:h}},r={expiry:e.expiry,transportLifeTimeInSeconds:h};return this.logger.debug("Websocket manager initialized. Connection details:",r),this._addWebsocketInitCSMMetric(n),t})).catch((e=>{var t;throw this.logger.error("Initializing Websocket Manager failed:",e),this.status===j&&403===(null==e||null===(t=e._debug)||void 0===t?void 0:t.statusCode)&&this.handleBackgroundChatEnded(),this._addWebsocketInitCSMMetric(n,!0),e}))}_addWebsocketInitCSMMetric(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];ne.addLatencyMetric(u,e,s),ne.addCountAndErrorMetric(u,s,t)}end(){this.websocketManager.closeWebSocket&&this.websocketManager.closeWebSocket(),this.eventBus.unsubscribeAll(),this.subscriptions.forEach((e=>e())),this.logger.info("Websocket closed. All event subscriptions are cleared.")}start(){return this.status===L&&(this.status=U),Promise.resolve({websocketStatus:this.status})}onEnded(e){return this.eventBus.subscribe(q,e)}handleEnded(){this.status=W,this.eventBus.trigger(q,{}),ne.addCountMetric("WebsocketEnded",s),this.logger.info("Websocket connection ended.")}onConnectionGain(e){return this.eventBus.subscribe(G,e)}handleConnectionGain(){this.status=F,this.eventBus.trigger(G,{}),ne.addCountMetric("WebsocketConnectionGained",s),this.logger.info("Websocket connection gained.")}onConnectionLost(e){return this.eventBus.subscribe(z,e)}handleConnectionLost(){this.status=j,this.eventBus.trigger(z,{}),ne.addCountMetric("WebsocketConnectionLost",s),this.logger.info("Websocket connection lost.")}onMessage(e){return this.eventBus.subscribe(V,e)}handleMessage(e){var t;try{t=JSON.parse(e.content),this.eventBus.trigger(V,t),ne.addCountMetric("WebsocketIncomingMessage",s),this.logger.info("this.eventBus trigger Websocket incoming message",V,t)}catch(e){this._sendInternalLogToServer(this.logger.error("Wrong message format"))}}onBackgroundChatEnded(e){return this.eventBus.subscribe(K,e)}handleBackgroundChatEnded(){this.eventBus.trigger(K)}getStatus(){return this.status}getWebsocketManager(){return this.websocketManager}hasMessageSubscribers(){return this.eventBus.getSubscriptions(V).length>0}_sendInternalLogToServer(e){return e&&"function"==typeof e.sendInternalLogToServer&&e.sendInternalLogToServer(),e}onDeepHeartbeatSuccess(e){return this.eventBus.subscribe($,e)}handleDeepHeartbeatSuccess(){this.status=H,this.eventBus.trigger($,{}),ne.addCountMetric("WebsocketDeepHeartbeatSuccess",s),this.logger.info("Websocket deep heartbeat success.")}onDeepHeartbeatFailure(e){return this.eventBus.subscribe(J,e)}handleDeepHeartbeatFailure(){this.status=B,this.eventBus.trigger(J,{}),ne.addCountMetric("WebsocketDeepHeartbeatFailure",s),this.logger.info("Websocket deep heartbeat failure.")}}const de=ue;function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function he(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class fe{constructor(e){this.logger=b.getLogger({prefix:"ChatJS-MessageReceiptUtil",logMetaData:e}),this.timeout=null,this.timeoutId=null,this.readSet=new Set,this.deliveredSet=new Set,this.readPromiseMap=new Map,this.deliveredPromiseMap=new Map,this.lastReadArgs=null,this.throttleInitialEventsToPrioritizeRead=null,this.throttleSendEventApiCall=null}isMessageReceipt(e,t){return-1!==[l.INCOMING_READ_RECEIPT,l.INCOMING_DELIVERED_RECEIPT].indexOf(e)||t.Type===l.MESSAGE_METADATA}getEventTypeFromMessageMetaData(e){return Array.isArray(e.Receipts)&&e.Receipts[0]&&e.Receipts[0].ReadTimestamp?l.INCOMING_READ_RECEIPT:e.Receipts[0].DeliveredTimestamp?l.INCOMING_DELIVERED_RECEIPT:null}shouldShowMessageReceiptForCurrentParticipantId(e,t){return e!==(t.MessageMetadata&&Array.isArray(t.MessageMetadata.Receipts)&&t.MessageMetadata.Receipts[0]&&t.MessageMetadata.Receipts[0].RecipientParticipantId)}prioritizeAndSendMessageReceipt(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];try{var o,a,s=this,c=r[3],u="string"==typeof r[2]?JSON.parse(r[2]):r[2],d="object"==typeof u?u.messageId:"";if(s.readSet.has(d)||c===l.INCOMING_DELIVERED_RECEIPT&&s.deliveredSet.has(d)||!d)return this.logger.info("Event already fired ".concat(d,": sending messageReceipt ").concat(c)),Promise.resolve({message:"Event already fired"});var p=new Promise((function(e,t){o=e,a=t}));return c===l.INCOMING_DELIVERED_RECEIPT?s.deliveredPromiseMap.set(d,[o,a]):s.readPromiseMap.set(d,[o,a]),s.throttleInitialEventsToPrioritizeRead=function(){return c===l.INCOMING_DELIVERED_RECEIPT&&(s.deliveredSet.add(d),s.readSet.has(d))?(s.resolveDeliveredPromises(d,"Event already fired"),o({message:"Event already fired"})):s.readSet.has(d)?(s.resolveReadPromises(d,"Event already fired"),o({message:"Event already fired"})):(c===l.INCOMING_READ_RECEIPT&&s.readSet.add(d),u.disableThrottle?(this.logger.info("throttleFn disabled for ".concat(d,": sending messageReceipt ").concat(c)),o(t.call(e,...r))):(s.logger.debug("call next throttleFn sendMessageReceipts",r),void s.sendMessageReceipts.call(s,e,t,...r)))},s.timeout||(s.timeout=setTimeout((function(){s.timeout=null,s.throttleInitialEventsToPrioritizeRead()}),300)),c!==l.INCOMING_READ_RECEIPT||s.readSet.has(d)||(clearTimeout(s.timeout),s.timeout=null,s.throttleInitialEventsToPrioritizeRead()),p}catch(e){return Promise.reject(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(n),!0).forEach((function(t){he(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({message:"Failed to send messageReceipt",args:r},e))}}sendMessageReceipts(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var o=this,a=r[4]||T.getMessageReceiptsThrottleTime(),s=r[3],c=("string"==typeof r[2]?JSON.parse(r[2]):r[2]).messageId;this.lastReadArgs=s===l.INCOMING_READ_RECEIPT?r:this.lastReadArgs,o.throttleSendEventApiCall=function(){try{if(s===l.INCOMING_READ_RECEIPT){var n=t.call(e,...r);o.resolveReadPromises(c,n),o.logger.debug("send Read event:",t,r)}else{var i=[t.call(e,...r)],a=this.lastReadArgs?"string"==typeof this.lastReadArgs[2]?JSON.parse(this.lastReadArgs[2]):this.lastReadArgs[2]:null,u=a&&a.messageId;o.readPromiseMap.has(u)&&i.push(t.call(e,...this.lastReadArgs)),o.logger.debug("send Delivered event:",r,"read event:",this.lastReadArgs),Promise.allSettled(i).then((e=>{o.resolveDeliveredPromises(c,e[0].value||e[0].reason,"rejected"===e[0].status),u&&e.length>1&&o.resolveReadPromises(u,e[1].value||e[1].reason,"rejected"===e[1].status)}))}}catch(e){o.logger.error("send message receipt failed",e),o.resolveReadPromises(c,e,!0),o.resolveDeliveredPromises(c,e,!0)}},o.timeoutId||(o.timeoutId=setTimeout((function(){o.timeoutId=null,o.throttleSendEventApiCall()}),a))}resolveDeliveredPromises(e,t,n){return this.resolvePromises(this.deliveredPromiseMap,e,t,n)}resolveReadPromises(e,t,n){return this.resolvePromises(this.readPromiseMap,e,t,n)}resolvePromises(e,t,n,r){var i=Array.from(e.keys()),o=i.indexOf(t);if(-1!==o)for(var a=0;a<=o;a++){var s,c=null===(s=e.get(i[a]))||void 0===s?void 0:s[r?1:0];"function"==typeof c&&(e.delete(i[a]),c(n))}else this.logger.debug("Promise for messageId: ".concat(t," already resolved"))}rehydrateReceiptMappers(e,t){var n=this;return r=>{if(n.logger.debug("rehydrate chat",null==r?void 0:r.data),t){var{Transcript:i=[]}=(null==r?void 0:r.data)||{};i.forEach((e=>{if((null==e?void 0:e.Type)===l.MESSAGE_METADATA){var t,n,r=null==e||null===(t=e.MessageMetadata)||void 0===t||null===(t=t.Receipts)||void 0===t?void 0:t[0],i=null==e||null===(n=e.MessageMetadata)||void 0===n?void 0:n.MessageId;null!=r&&r.ReadTimestamp&&this.readSet.add(i),null!=r&&r.DeliveredTimestamp&&this.deliveredSet.add(i)}}))}return e(r)}}}function ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function me(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ve="Broken";class ye{constructor(e){this.argsValidator=new x,this.pubsub=new ee,this.sessionType=e.sessionType,this.getConnectionToken=e.chatDetails.getConnectionToken,this.connectionDetails=e.chatDetails.connectionDetails,this.initialContactId=e.chatDetails.initialContactId,this.contactId=e.chatDetails.contactId,this.participantId=e.chatDetails.participantId,this.chatClient=e.chatClient,this.participantToken=e.chatDetails.participantToken,this.websocketManager=e.websocketManager,this._participantDisconnected=!1,this.sessionMetadata={},this.connectionDetailsProvider=null,this.logger=b.getLogger({prefix:"ChatJS-ChatController",logMetaData:e.logMetaData}),this.logMetaData=e.logMetaData,this.messageReceiptUtil=new fe(e.logMetaData),this.hasChatEnded=!1,this.logger.info("Browser info:",window.navigator.userAgent)}subscribe(e,t){this.pubsub.subscribe(e,t),this._sendInternalLogToServer(this.logger.info("Subscribed successfully to event:",e))}handleRequestSuccess(e,t,n,r){return i=>{var o=r?[{name:"ContentType",value:r}]:[];return ne.addLatencyMetricWithStartTime(t,n,s,o),ne.addCountAndErrorMetric(t,s,!1,o),i.metadata=e,i}}handleRequestFailure(e,t,n,r){return i=>{var o=r?[{name:"ContentType",value:r}]:[];return ne.addLatencyMetricWithStartTime(t,n,s,o),ne.addCountAndErrorMetric(t,s,!0,o),i.metadata=e,Promise.reject(i)}}sendMessage(e){if(!this._validateConnectionStatus("sendMessage"))return Promise.reject("Failed to call sendMessage, No active connection");var t=(new Date).getTime(),n=e.metadata||null;this.argsValidator.validateSendMessage(e);var r=this.connectionHelper.getConnectionToken();return this.chatClient.sendMessage(r,e.message,e.contentType).then(this.handleRequestSuccess(n,c.SEND_MESSAGE,t,e.contentType)).catch(this.handleRequestFailure(n,c.SEND_MESSAGE,t,e.contentType))}sendAttachment(e){if(!this._validateConnectionStatus("sendAttachment"))return Promise.reject("Failed to call sendAttachment, No active connection");var t=(new Date).getTime(),n=e.metadata||null,r=this.connectionHelper.getConnectionToken();return this.chatClient.sendAttachment(r,e.attachment,e.metadata).then(this.handleRequestSuccess(n,c.SEND_ATTACHMENT,t,e.attachment.type)).catch(this.handleRequestFailure(n,c.SEND_ATTACHMENT,t,e.attachment.type))}downloadAttachment(e){if(!this._validateConnectionStatus("downloadAttachment"))return Promise.reject("Failed to call downloadAttachment, No active connection");var t=(new Date).getTime(),n=e.metadata||null,r=this.connectionHelper.getConnectionToken();return this.chatClient.downloadAttachment(r,e.attachmentId).then(this.handleRequestSuccess(n,c.DOWNLOAD_ATTACHMENT,t)).catch(this.handleRequestFailure(n,c.DOWNLOAD_ATTACHMENT,t))}sendEventIfChatHasNotEnded(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.hasChatEnded?(this.logger.warn("Ignoring sendEvent API bec chat has ended",...t),Promise.resolve()):this.chatClient.sendEvent(...t)}sendEvent(e){if(!this._validateConnectionStatus("sendEvent"))return Promise.reject("Failed to call sendEvent, No active connection");var t=(new Date).getTime(),n=e.metadata||null;this.argsValidator.validateSendEvent(e);var r=this.connectionHelper.getConnectionToken(),i=e.content||null,a=be(e.contentType),s="string"==typeof i?JSON.parse(i):i;return this.messageReceiptUtil.isMessageReceipt(a,e)?T.isFeatureEnabled(o)&&s.messageId?this.messageReceiptUtil.prioritizeAndSendMessageReceipt(this.chatClient,this.sendEventIfChatHasNotEnded.bind(this),r,e.contentType,i,a,T.getMessageReceiptsThrottleTime()).then(this.handleRequestSuccess(n,c.SEND_EVENT,t,e.contentType)).catch(this.handleRequestFailure(n,c.SEND_EVENT,t,e.contentType)):(this.logger.warn("Ignoring messageReceipt: ".concat(T.isFeatureEnabled(o)&&"missing messageId"),e),Promise.reject({errorMessage:"Ignoring messageReceipt: ".concat(T.isFeatureEnabled(o)&&"missing messageId"),data:e})):this.chatClient.sendEvent(r,e.contentType,i).then(this.handleRequestSuccess(n,c.SEND_EVENT,t,e.contentType)).catch(this.handleRequestFailure(n,c.SEND_EVENT,t,e.contentType))}getTranscript(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._validateConnectionStatus("getTranscript"))return Promise.reject("Failed to call getTranscript, No active connection");var t=(new Date).getTime(),n=e.metadata||null,r={startPosition:e.startPosition||{},scanDirection:e.scanDirection||"BACKWARD",sortOrder:e.sortOrder||"ASCENDING",maxResults:e.maxResults||15};e.nextToken&&(r.nextToken=e.nextToken),e.contactId&&(r.contactId=e.contactId);var i=this.connectionHelper.getConnectionToken();return this.chatClient.getTranscript(i,r).then(this.messageReceiptUtil.rehydrateReceiptMappers(this.handleRequestSuccess(n,c.GET_TRANSCRIPT,t),T.isFeatureEnabled(o))).catch(this.handleRequestFailure(n,c.GET_TRANSCRIPT,t))}connect(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.sessionMetadata=e.metadata||null,this.argsValidator.validateConnectChat(e),!this.connectionDetailsProvider)return this.connectionDetailsProvider=this._getConnectionDetailsProvider(),this.connectionDetailsProvider.fetchConnectionDetails().then((e=>this._initConnectionHelper(this.connectionDetailsProvider,e))).then((e=>this._onConnectSuccess(e,this.connectionDetailsProvider))).catch((e=>this._onConnectFailure(e)));this.logger.warn("Ignoring duplicate call to connect. Method can only be invoked once",e)}_initConnectionHelper(e,t){return this.connectionHelper=new de(this.contactId,this.initialContactId,e,this.websocketManager,this.logMetaData,t),this.connectionDetails=t,this.connectionHelper.onEnded(this._handleEndedConnection.bind(this)),this.connectionHelper.onConnectionLost(this._handleLostConnection.bind(this)),this.connectionHelper.onConnectionGain(this._handleGainedConnection.bind(this)),this.connectionHelper.onMessage(this._handleIncomingMessage.bind(this)),this.connectionHelper.onDeepHeartbeatSuccess(this._handleDeepHeartbeatSuccess.bind(this)),this.connectionHelper.onDeepHeartbeatFailure(this._handleDeepHeartbeatFailure.bind(this)),this.connectionHelper.onBackgroundChatEnded(this._handleBackgroundChatEnded.bind(this)),this.connectionHelper.start()}_getConnectionDetailsProvider(){return new ie(this.participantToken,this.chatClient,this.sessionType,this.getConnectionToken)}_handleEndedConnection(e){this._forwardChatEvent(l.CONNECTION_BROKEN,{data:e,chatDetails:this.getChatDetails()}),this.breakConnection()}_handleLostConnection(e){this._forwardChatEvent(l.CONNECTION_LOST,{data:e,chatDetails:this.getChatDetails()})}_handleGainedConnection(e){this.hasChatEnded=!1,this._forwardChatEvent(l.CONNECTION_ESTABLISHED,{data:e,chatDetails:this.getChatDetails()})}_handleDeepHeartbeatSuccess(e){this._forwardChatEvent(l.DEEP_HEARTBEAT_SUCCESS,{data:e,chatDetails:this.getChatDetails()})}_handleDeepHeartbeatFailure(e){this._forwardChatEvent(l.DEEP_HEARTBEAT_FAILURE,{data:e,chatDetails:this.getChatDetails()})}_handleBackgroundChatEnded(){this._handleIncomingMessage(f)}_handleIncomingMessage(e){try{var t=be(null==e?void 0:e.ContentType);if(this.messageReceiptUtil.isMessageReceipt(t,e)&&(!(t=this.messageReceiptUtil.getEventTypeFromMessageMetaData(null==e?void 0:e.MessageMetadata))||!this.messageReceiptUtil.shouldShowMessageReceiptForCurrentParticipantId(this.participantId,e)))return;this._forwardChatEvent(t,{data:e,chatDetails:this.getChatDetails()}),e.ContentType===d.chatEnded&&(this.hasChatEnded=!0,this._forwardChatEvent(l.CHAT_ENDED,{data:null,chatDetails:this.getChatDetails()}),this.breakConnection()),e.ContentType===d.transferSucceeded&&this.sessionType!==a.CUSTOMER&&this.breakConnection()}catch(t){this._sendInternalLogToServer(this.logger.error("Error occured while handling message from Connection. eventData:",e," Causing exception:",t))}}_forwardChatEvent(e,t){this.pubsub.triggerAsync(e,t)}_onConnectSuccess(e,t){var n;this._sendInternalLogToServer(this.logger.info("Connect successful!")),this.logger.warn("onConnectionSuccess response",e);var r={_debug:e,connectSuccess:!0,connectCalled:!0,metadata:this.sessionMetadata},i=Object.assign({chatDetails:this.getChatDetails()},r);this.pubsub.triggerAsync(l.CONNECTION_ESTABLISHED,i);var o=null===(n=t.getConnectionDetails())||void 0===n?void 0:n.connectionAcknowledged;return this._shouldAcknowledgeContact()&&!o&&(ne.addAgentCountMetric("CREATE_PARTICIPANT_CONACK_CALL_COUNT",1),t.callCreateParticipantConnection({Type:!1,ConnectParticipant:!0}).catch((e=>{this.logger.warn("ConnectParticipant failed to acknowledge Agent connection in CreateParticipantConnection: ",e),ne.addAgentCountMetric("CREATE_PARTICIPANT_CONACK_FAILURE",1)}))),this.logger.warn("onConnectionSuccess responseObject",r),r}_onConnectFailure(e){var t={_debug:e,connectSuccess:!1,connectCalled:!0,metadata:this.sessionMetadata};return this._sendInternalLogToServer(this.logger.error("Connect Failed. Error: ",t)),Promise.reject(t)}_shouldAcknowledgeContact(){return this.sessionType===a.AGENT}breakConnection(){return this.connectionHelper?this.connectionHelper.end():Promise.resolve()}cleanUpOnParticipantDisconnect(){this.pubsub.unsubscribeAll()}disconnectParticipant(){if(!this._validateConnectionStatus("disconnectParticipant"))return Promise.reject("Failed to call disconnectParticipant, No active connection");var e=(new Date).getTime(),t=this.connectionHelper.getConnectionToken();return this.chatClient.disconnectParticipant(t).then((t=>(this._sendInternalLogToServer(this.logger.info("Disconnect participant successfully")),this._participantDisconnected=!0,this.cleanUpOnParticipantDisconnect(),this.breakConnection(),ne.addLatencyMetricWithStartTime(c.DISCONNECT_PARTICIPANT,e,s),ne.addCountAndErrorMetric(c.DISCONNECT_PARTICIPANT,s,!1),t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(n),!0).forEach((function(t){me(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t||{}),t)),(t=>(this._sendInternalLogToServer(this.logger.error("Disconnect participant failed. Error:",t)),ne.addLatencyMetricWithStartTime(c.DISCONNECT_PARTICIPANT,e,s),ne.addCountAndErrorMetric(c.DISCONNECT_PARTICIPANT,s,!0),Promise.reject(t))))}getChatDetails(){return{initialContactId:this.initialContactId,contactId:this.contactId,participantId:this.participantId,participantToken:this.participantToken,connectionDetails:this.connectionDetails}}describeView(e){var t=(new Date).getTime(),n=e.metadata||null,r=this.connectionHelper.getConnectionToken();return this.chatClient.describeView(e.viewToken,r).then(this.handleRequestSuccess(n,c.DESCRIBE_VIEW,t)).catch(this.handleRequestFailure(n,c.DESCRIBE_VIEW,t))}getAuthenticationUrl(e){var t=(new Date).getTime(),n=e.metadata||null,r=this.connectionHelper.getConnectionToken();return this.chatClient.getAuthenticationUrl(r,e.redirectUri,e.sessionId).then(this.handleRequestSuccess(n,c.GET_AUTHENTICATION_URL,t)).catch(this.handleRequestFailure(n,c.GET_AUTHENTICATION_URL,t))}cancelParticipantAuthentication(e){var t=(new Date).getTime(),n=e.metadata||null,r=this.connectionHelper.getConnectionToken();return this.chatClient.cancelParticipantAuthentication(r,e.sessionId).then(this.handleRequestSuccess(n,c.CANCEL_AUTHENTICATION,t)).catch(this.handleRequestFailure(n,c.CANCEL_AUTHENTICATION,t))}_convertConnectionHelperStatus(e){switch(e){case L:return"NeverEstablished";case U:return"Establishing";case W:case j:return ve;case F:case H:return"Established";case B:return ve}this._sendInternalLogToServer(this.logger.error("Reached invalid state. Unknown connectionHelperStatus: ",e))}getConnectionStatus(){return this._convertConnectionHelperStatus(this.connectionHelper.getStatus())}_sendInternalLogToServer(e){return e&&"function"==typeof e.sendInternalLogToServer&&e.sendInternalLogToServer(),e}_validateConnectionStatus(e){return this.connectionHelper?!this._participantDisconnected||(this.logger.error("Cannot call ".concat(e," when participant is disconnected")),!1):(this.logger.error("Cannot call ".concat(e," before calling connect()")),!1)}}var be=e=>p[e]||p.default,we=b.getLogger({prefix:"ChatJS-GlobalConfig"});class Ee{createAgentChatController(e,n){throw new t("createAgentChatController in ChatControllerFactory.")}createCustomerChatController(e,n){throw new t("createCustomerChatController in ChatControllerFactory.")}}class Ce{constructor(e){this.controller=e}onMessage(e){this.controller.subscribe(l.INCOMING_MESSAGE,e)}onTyping(e){this.controller.subscribe(l.INCOMING_TYPING,e)}onReadReceipt(e){this.controller.subscribe(l.INCOMING_READ_RECEIPT,e)}onDeliveredReceipt(e){this.controller.subscribe(l.INCOMING_DELIVERED_RECEIPT,e)}onConnectionBroken(e){this.controller.subscribe(l.CONNECTION_BROKEN,e)}onConnectionEstablished(e){this.controller.subscribe(l.CONNECTION_ESTABLISHED,e)}onEnded(e){this.controller.subscribe(l.CHAT_ENDED,e)}onParticipantIdle(e){this.controller.subscribe(l.PARTICIPANT_IDLE,e)}onParticipantReturned(e){this.controller.subscribe(l.PARTICIPANT_RETURNED,e)}onParticipantInvited(e){this.controller.subscribe(l.PARTICIPANT_INVITED,e)}onAutoDisconnection(e){this.controller.subscribe(l.AUTODISCONNECTION,e)}onConnectionLost(e){this.controller.subscribe(l.CONNECTION_LOST,e)}onDeepHeartbeatSuccess(e){this.controller.subscribe(l.DEEP_HEARTBEAT_SUCCESS,e)}onDeepHeartbeatFailure(e){this.controller.subscribe(l.DEEP_HEARTBEAT_FAILURE,e)}onAuthenticationInitiated(e){this.controller.subscribe(l.AUTHENTICATION_INITIATED,e)}onAuthenticationSuccessful(e){this.controller.subscribe(l.AUTHENTICATION_SUCCESSFUL,e)}onAuthenticationFailed(e){this.controller.subscribe(l.AUTHENTICATION_FAILED,e)}onAuthenticationTimeout(e){this.controller.subscribe(l.AUTHENTICATION_TIMEOUT,e)}onAuthenticationExpired(e){this.controller.subscribe(l.AUTHENTICATION_EXPIRED,e)}onAuthenticationCanceled(e){this.controller.subscribe(l.AUTHENTICATION_CANCELED,e)}onParticipantDisplayNameUpdated(e){this.controller.subscribe(l.PARTICIPANT_DISPLAY_NAME_UPDATED,e)}onChatRehydrated(e){this.controller.subscribe(l.CHAT_REHYDRATED,e)}sendMessage(e){return this.controller.sendMessage(e)}sendAttachment(e){return this.controller.sendAttachment(e)}downloadAttachment(e){return this.controller.downloadAttachment(e)}connect(e){return this.controller.connect(e)}sendEvent(e){return this.controller.sendEvent(e)}getTranscript(e){return this.controller.getTranscript(e)}getChatDetails(){return this.controller.getChatDetails()}describeView(e){return this.controller.describeView(e)}getAuthenticationUrl(e){return this.controller.getAuthenticationUrl(e)}cancelParticipantAuthentication(e){return this.controller.cancelParticipantAuthentication(e)}}class Se extends Ce{constructor(e){super(e)}cleanUpOnParticipantDisconnect(){return this.controller.cleanUpOnParticipantDisconnect()}}class Te extends Ce{constructor(e){super(e)}disconnectParticipant(){return this.controller.disconnectParticipant()}}var Ie,Ae=new class extends Ee{constructor(){super(),this.argsValidator=new x}createChatSession(e,t,n,i){var o=this._createChatController(e,t,n,i);if(e===a.AGENT)return new Se(o);if(e===a.CUSTOMER)return new Te(o);throw new r("Unkown value for session type, Allowed values are: "+Object.values(a),e)}_createChatController(e,t,n,r){var i=this.argsValidator.normalizeChatDetails(t),o={contactId:i.contactId,participantId:i.participantId,sessionType:e},a=_.getCachedClient(n,o);return new ye({sessionType:e,chatDetails:i,chatClient:a,websocketManager:r,logMetaData:o})}},ke=e=>{T.setFeatureFlag(e)},Oe={create:e=>{var t=e.options||{},n=e.type||a.AGENT;return T.updateStageRegionCell(t),e.disableCSM||n!==a.CUSTOMER||ne.loadCsmScriptAndExecute(),Ae.createChatSession(n,e.chatDetails,t,e.websocketManager)},setGlobalConfig:e=>{var t,n,r=e.loggerConfig,i=e.csmConfig;T.update(e),ce.setGlobalConfig(e),b.updateLoggerConfig(r),i&&ne.updateCsmConfig(i),we.warn("enabling message-receipts by default; to disable set config.features.messageReceipts.shouldSendMessageReceipts = false"),T.updateThrottleTime(null===(t=e.features)||void 0===t||null===(t=t.messageReceipts)||void 0===t?void 0:t.throttleTime),!1===(null===(n=e.features)||void 0===n||null===(n=n.messageReceipts)||void 0===n?void 0:n.shouldSendMessageReceipts)?T.removeFeatureFlag(o):ke(o)},LogLevel:y,Logger:class{debug(e){}info(e){}warn(e){}error(e){}advancedLog(e){}},SessionTypes:a,csmService:ne,setFeatureFlag:ke,setRegionOverride:e=>{T.updateRegionOverride(e)}};function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ne(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Pe={version:"3.1.0",name:k.UU,source:"npm",repository:(null===(Ie=k.Jk)||void 0===Ie?void 0:Ie.url)||"https://github.com/amazon-connect/amazon-connect-chatjs",build:{timestamp:(new Date).toISOString(),environment:"production"}},Re=void 0!==Re?Re:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};Re.connect=Re.connect||{},connect.ChatSession=connect.ChatSession||Oe,connect.LogManager=connect.LogManager||b,connect.LogLevel=connect.LogLevel||y,connect.csmService=connect.csmService||Oe.csmService,Object.defineProperty(Re.connect,"ChatJS",{value:Object.freeze(Object.freeze(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(n),!0).forEach((function(t){Ne(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Pe))),writable:!1,enumerable:!0,configurable:!1})})()})();
//# sourceMappingURL=amazon-connect-chat.js.map