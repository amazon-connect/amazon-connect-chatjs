INIT_CHAT_RESPONSE = {
  ChatConnectionAttributes: {
    ConnectionId: "835b1864-cfe1-4336-8236-12092aaf0e02",
    ParticipantCredentials: {
      ConnectionAuthenticationToken:
        "AQIDAHhGwqfCvMO4XkBJFVZswpXDnR85wq7DlwI7wo8qwqHDj8KcARNkw6wpwqbDvMOYw4oBw5kyUsOScEzDlsOVw59TEsOdSMOrw7TDhAAAAG4wbAYJKsKGSMKGw7cNAQcGwqBfMF0CAQAwWAYJKsKGSMKGw7cNAQcBMB4GCWDChkgBZQMEAS4wEQQMC1XCpRTDoCY8wrjDrkNLCgIBEMKAKwIhw6h2woJMwo4eVsKoA2rDrzMIwpQ3AMOTwr5cw73Di8KBw5rDo3ogw6jCo0rDiHxXwqHCgyXDmQs1wp/Dr8O4OjpTemnDtcOqA8ORwrtrwrVZKEVCw5ozw6MIw4FGQcK1FsKZSDfCgiLCjjtXNWhUw5Jlwq4ERcOjw5Nwwr/DuBbDuChWwrx9bSMlbTBvw74oUcKBaRhPw4PDoMOBdMOVwqAcw6AaUcOuw7PCvMOQQ8KZXGxow5Q9w4PCjMKhw4kaw6ArccOaJMOPw4ZhVBrDgMKQfWrDhMO9EyrCkcOqUFwmwrxuYzA0wqcEeTEsw6ATw4xdw41bw4ktwpI7eVTDiCXDiU3CocKvajF7NmUIw4/DmMOawrsNw4XDgcOZw6XCkzcewobDtsKhJTPCoiB4w7nDlWHDmTsLbh/Ds8KHw6AUXiwVw4PCmcKgaMOg",
      Expiry: null
    },
    PreSignedConnectionUrl:
      "wss://a28nk5omtf35rr-ats.iot.us-west-2.amazonaws.com/mqtt?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAYSFVGR4NXQLJ5M2O%2F20190129%2Fus-west-2%2Fiotdata%2Faws4_request&X-Amz-Date=20190129T220608Z&X-Amz-SignedHeaders=host&X-Amz-Signature=0f0d23dfea0603c453391a1d3de2b99b5b34622f46d421b607f8b139e3238362&X-Amz-Security-Token=FQoGZXIvYXdzECAaDPycRKMF4lwAyLGIbiKFAwjDAR6uTJgs50o4UD7lYLijE9njHB7SpQ%2BkKwme5wCLakAaxDGH1TBT6ix3avfXUAYNTUKqDV%2FL4oAUzITjSJDyHt%2BQ62eMCvXdbsFR4iC8a1hg1z8firKfNUyp3yQV7AVMwac8MOzMnQOY6pjej%2BUcM4fWZG5%2BxBzMYE%2BJsqLkPcv8rdIjzehqruBlUK8DnUec4Tc6taBbspHF9QHA3gEIJJGsEE81gCqdjPTwOWlemAQFzJxX%2BFDq6mb8L%2BbJ1dqm7LPlba5geICtepyJF6shnWy%2B6DMtVAIbo3ZryD73CR0xZwp8tGZLCE6omYT5I59FOPTcW37Gk6lC8XWZbXARgu8K5tz4Lv%2BpM4K4BiZpSY%2BDPSCnqjye3qjgGxkh1yI%2FW2lxI2XrVpp73ZIf4jxgOg2IsAxlfAK5WfUZvfnzF8DmJwS0dpJCZbK6WDmpFSwk7qyX9hXDuxDSJJqFsmNkKHXNVRo6vELsv%2Fasjq4zIYv1qJxPzAeF241ndWMloIh6CVOrKNCcw%2BIF"
  },
  ContactId: "2b5cfce4-ac43-4ace-bd1f-63c58974bead",
  ParticipantId: "20f886be-b14c-4527-8d37-2707fb94fbff"
};

PID = "5e47af9a-0040-46c5-b7d1-5d7bcdfd765d";
PTOKEN =
  "AQIDAHgaX8Kqw7kBwr5FwotbWcOGwqPDvmMdwpvDsCHChcKtw6jCuEXDrcKMUsOqwpLDgCvCo8O9AcK5OcOhw5RawpAPC8KdwqwmEi7Cs8KIwr4AAABuMGwGCSrChkjChsO3DQEHBsKgXzBdAgEAMFgGCSrChkjChsO3DQEHATAeBglgwoZIAWUDBAEuMBEEDMKkWFFiw6Zew7gswpzCjMOTw6gCARDCgCt6w6LCoy5fw4vDmcKdwoxYBsK3I8OnwrjCmsO4FjEydsOEwpfCv0PCjn7CgknCr8OPwoc0E1ILAkjDp1Z7KQs6OmE9YFcDFC9RwpHCn8KONcOUwprCtsOkHgkiZsOAd8KsawfDtcKsw4syw6zDnnrDinnCmsO6w7zDssOrw47Cj8OJCyrCjcK0RijDtSHDp8O6woppXsKwTcKbw79QwonCg24Ww5LCtnTCtQIOw5fDqcOZHcO1w65IFMKxFsKVwolcVcKaGcKWw5fDl8OCWcOPM8ObAMOLFSsKYcKxV39tUQ0ow4rCgh99w7LDiDLDr8OYb8KvJB3CjMO7Nh/Cv0vDlsK6PMKcwqEIcsOgBMKRw7c2cl/DqiPDjXLDj0NvSMKbwoTCsEnCpMK1wrrCgMKgwq4rwr9iw4gXTy7DpsKBD8KRFsKhaAzDvsOHw4k/FUDDhn7CjsOqbsONwqI=";

CHAT_ID = "295053e8-ec1a-4954-8eac-10b2cc0ab1c7";

class ChatControllerTest {
  setup() {
    var self = this;
    var connectionDetails = {
      connectionToken: PTOKEN,
      ConnectionId: "5b15e516-1f3b-4bc0-b3c5-0a081d1fdfca",
      PreSignedConnectionUrl:
        "wss://a28nk5omtf35rr-ats.iot.us-west-2.amazonaws.com/mqtt?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAYSFVGR4NWN4R2TGX%2F20190102%2Fus-west-2%2Fiotdata%2Faws4_request&X-Amz-Date=20190102T194922Z&X-Amz-SignedHeaders=host&X-Amz-Signature=1ebbca0dc68eaf0cc07c68f857a8e6d95bfa69191a6488271ccb586b4774b226&X-Amz-Security-Token=FQoGZXIvYXdzEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaDLLxgk3D%2BjlwxiIv9yKEA8%2BNO8eu%2B5u20MxPPImJiA5yjNJyYIIBX8oI9z89fuqkCDGNZxUGJqCo%2BjjB5VUIpkwMD753wi%2BoILTJsbWCeKIjHfadkwee0ABQ3e%2FSgPcpTlKAYi1bYHd6oFjtD9Plc7P%2FV64VEyFTAu25avgzk24I4ma3qK%2BWIwDyWDO3t%2B5DOMa%2BLEF9rZdAnLpG%2FWHL%2FLYWNP1WJw84pajjQZeIJrkdbxwqQqm5Bueog5wBzNXNCGGpoKV5TkuUk0N8QWsEeEAVvUMGk2l7JHMldKeGzDUwude5DCE%2F%2Bk23DEhgrthxDTiwquvHX8cWLaAbkWn6Gfvok77OXdxoYsiOsVJlYgtxtSGTgVEsJgCPtC96QZCyzZ6k8a6AUOAul%2FF5YkUYl74nzDqiYC76IGN4Cng69IgLbvSQ7hNxZC9OWWo4HUdq2fzifUZz%2BfjB5LFaH%2FPU4K2NdfHuW4W9YGK1L1A78w9k%2Fc7GmgrN7WJIXu8TNjNFY7v6zZ4bGqVuK8GiHikqkhyw1Pgowqu04QU%3D"
    };
    var chatDetails = {
      initialContactId: CHAT_ID,
      contactId: CHAT_ID,
      participantId: PID,
      participantToken: PTOKEN
      //connectionDetails: connectionDetails
    };
    //var factory = new connectchatjs.ChatFactory();
    self.chatController = connectchatjs.chatSession(chatDetails);
    self.chatController.onConnectionBroken(data => {
      console.log("onNetworkLinkBreak");
      console.log(data);
      console.log("onNetworkLinkBreak");
    });

    self.chatController.onTyping(data => {
      console.log("onTyping");
      console.log(data);
      console.log("onTyping");
    });

    self.chatController.onMessage(data => {
      console.log("onMessage");
      console.log(data);
      console.log("onMessage");
    });

    self.chatController.onConnectionEstablished(data => {
      console.log("onNetworkLinkReestablished");
      console.log(data);
      console.log("onNetworkLinkReestablished");
    });
    //self.chatController.broadcaster.on("<<all>>", (e, d) => self.called(e, d));
  }

  called(eventType, data) {
    console.log("");
    console.log("ChatControllerTest callbacked: " + eventType + ": ");
    console.log(data);
    console.log("");
  }

  checkStuff() {
    console.log("Status is:");
    console.log(this.chatController.getConnectionStatus());
  }

  test1B() {
    var self = this;
    console.log("before disconnect");
    self.checkStuff();
    self.chatController.endChat();
    console.log("just after disconnect");
    self.checkStuff();
  }

  test1() {
    var self = this;
    console.log("before connect");
    self.checkStuff();
    self.chatController
      .connect()
      .then(function(response) {
        console.log("connect success");
        console.log("response is:");
        console.log(response);
        self.checkStuff();
      })
      .catch(function(error) {
        console.log("connect error");
        console.log("error is:");
        console.log(error);
        self.checkStuff();
      });
    console.log("just after connect");
    self.checkStuff();
  }

  sendEvent() {
    var self = this;
    var args = {
      eventType: "TYPING",
      messageIds: [],
      visibility: "ALL",
      persistence: "NON_PERSISTED"
    };
    self.chatController
      .sendEvent(args, { requestContext: "oye balle!!" })
      .then(function(response, requestContext) {
        console.log("sendEvent response");
        console.log(response);
        console.log(requestContext);
      })
      .catch(function(error) {
        console.log("sendEvent error");
        console.log(error);
        console.log("sendEvent error");
      });
    console.log("sendEvent called!!!");
  }

  getTranscript() {
    var self = this;
    var args = {};
    args.StartKey = {};
    args.StartKey.ItemId = "96a48038-c824-4ca0-b553-977da0df1df5";
    args.ScanDirection = "BACKWARD";
    args.SortKey = "ASCENDING";
    args.MaxResults = 5;
    self.chatController
      .getTranscript({}, { requestContext: "oye balle!!" })
      .then(function(response, requestContext) {
        console.log("transcript is");
        console.log(response);
        console.log(requestContext);
      })
      .catch(function(error) {
        console.log("transcript error");
        console.log(error);
        console.log("transcript error");
      });
    console.log("getTranscript called!!!");
  }

  send() {
    var text = document.getElementById("myText").value;
    console.log("checking type!");
    console.log(typeof text);
    var self = this;
    self.chatController
      .sendMessage(text, "text/plain", { requestContext: "oye balle!!" })
      .then(function(response, requestContext) {
        console.log("sentSuccess: " + text);
        console.log(response);
        console.log(requestContext);
      })
      .catch(function(error) {
        console.log("error");
        console.log(error);
        console.log("error");
      });
    console.log("sent: " + text);
  }

  reconnectTest() {
    var self = this;
    self.chatController.acpsClient
      .reconnectChat(PTOKEN)
      .then(function(response) {
        console.log("reconnectSuccess");
        console.log(response);
        console.log("reconnectSuccess");
      })
      .catch(function(error) {
        console.log("error");
        console.log(error);
        console.log("error");
      });
    console.log("recconnectCalled");
  }
}

testController = new ChatControllerTest();

document.getElementById("button1").addEventListener("click", function() {
  testController.setup();
  console.log(testController.chatController);
});

document.getElementById("button2").addEventListener("click", function() {
  testController.test1();
});

document.getElementById("button3").addEventListener("click", function() {
  testController.test1B();
});

document.getElementById("sendButton").addEventListener("click", function() {
  testController.send();
});

document
  .getElementById("sendEventButton")
  .addEventListener("click", function() {
    testController.sendEvent();
  });

document
  .getElementById("retrieveTranscript")
  .addEventListener("click", function() {
    testController.getTranscript();
  });

/*

class SoloChatConnectionIotHelperTest {



    setup() { 
        var self = this;
        var cId = "c8d1faa7-4818-4df1-b3f6-f11a71bf2391";
        var purl = "wss://a28nk5omtf35rr.iot.us-west-2.amazonaws.com/mqtt?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAYSFVGR4N6D7ANLEQ%2F20181116%2Fus-west-2%2Fiotdata%2Faws4_request&X-Amz-Date=20181116T002703Z&X-Amz-SignedHeaders=host&X-Amz-Signature=197ca4227a141d6d0ac5f8efed1620b115930a316d9ee95db6fc60181e8a6b9d&X-Amz-Security-Token=FQoGZXIvYXdzEBoaDEkVB0gSQ2BWvfAT6iKFA4dqWiitI8q84ZTk%2Bt9i8FOdEEZN1XfQTa5NTrAqWegZWGjlEw8vh6SsBSVU8kI9nLY7gQMXCJDnvSWzvaFdUkcL8amMXbKnQPBXRotzv7KjwZtSk6DW6vTrU9RGIEtAdxy%2FRA2Jc7sefFeWVlCgf6WekDNbGRSHN%2BEQp%2Fdeb32zpSqLYC1yoU6jqm%2B8QrMTbnaOkiQsEUkcGjfh5RZ%2BHpt4%2B%2Flc2IsEWPSMc7iUwEQTw1fJ6zxvJ5CEXk%2B%2B9KmJzDVDhKVSHe3n%2BrMJU25jUaNg4SEbLcdWbygWXBHfORzXr%2FHcwWqPV98F%2B83fVH8zxR%2F%2B6FqMvD6D67Lzn%2FQD9v%2Bf%2FBTOj%2Bhtg78det%2B43i0Lelc%2BN7BubuK65XU0ZHUk9XKOPokTZ6p%2FG007GvN0AfF8RyZdscxdUF3ZYTwdZmg4UB%2FemqRY1BJOxAa%2BB2ImpLfnPIwAykfuXTELvJccfGDOP7qEjtg4Er00245SxEeX0ZzRRX8nZLLWWGwOseoB4n0diDhVKNeduN8F";
        var connectionDetails = {
            "preSignedUrl": purl,
            "connectionId": cId
        }
        var connectionHelperProvider = CHAT_CONTROLLOR_FACTORY.createConnectionHelperProvider(connectionDetails);
        self.connectionHelper = connectionHelperProvider((eventType, data) => self.called(eventType, data));
    }

    called(eventType, data) {
        console.log("");
        console.log("SoloChatConnectionIotHelperTest callbacked: " + eventType + ": ");
        console.log(data);
        console.log("");
    }

    checkStuff() {
        console.log("Status is:");
        console.log(this.connectionHelper.getStatus());
    }

    test1B() {
        var self = this;
        console.log("before end");
        self.checkStuff();
        self.connectionHelper.end();
        console.log("just after end");
        self.checkStuff();
    }

    test1() {
        var self = this;
        console.log("before start");
        self.checkStuff();
        self.connectionHelper.start().
            then(function(response) {console.log("start success"); console.log("response is:"); console.log(response); self.checkStuff();}).
            catch(function(error) {console.log("start error"); console.log("error is:"); console.log(error); self.checkStuff();});
        console.log("just after start");
        self.checkStuff();
    }


}

testHelper = new SoloChatConnectionIotHelperTest();

document.getElementById("button1").addEventListener("click", function() {testHelper.setup(); console.log(testHelper.connectionHelper)});

document.getElementById("button2").addEventListener("click", function() {testHelper.test1()});

document.getElementById("button3").addEventListener("click", function() {testHelper.test1B()});

*/

/*
class PahoIotConnectionTest {
//
this.preSignedUrl = args.preSignedUrl;
this.connectionId = args.connectionId;
this.callback = args.callback;
this.maxRetryTime = args.maxRetryTime;
//



    setup() {
        var cId = "7af56284-b815-4ed2-9251-0e969d88b52e";
        var purl = "wss://a28nk5omtf35rr.iot.us-west-2.amazonaws.com/mqtt?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAYSFVGR4NRWG26FZO%2F20181115%2Fus-west-2%2Fiotdata%2Faws4_request&X-Amz-Date=20181115T073404Z&X-Amz-SignedHeaders=host&X-Amz-Signature=d6f3c9787ade426df800bace2869fc750c11d537c8359c3b210cbdaa5131b4e0&X-Amz-Security-Token=FQoGZXIvYXdzEAkaDKp7re%2BU2Irc1zZ6UyKEA8t%2BqXvfSXR3Apc0R94ONZemMwANWXXAeFeUqft9DwowzdlPypscMVU06V1supZnqt8hJb%2B6DTAiGSwyM7%2B7O%2BVgSpeflG3TbSJp5HQFdq1Dy%2FvQ7IAQ7GGRRmchOJpYIOFj3%2B6Htb0HaqIiAEQs%2FQf9jxwwSiMfC%2B2IHNhEKE1tY3xoD7xFyQkS2u8LT7GS63WMREhyjkGwRv%2F%2BtWc83UlML0DqOfhouOmGBJDXuwoTwp9itl9DTb78JbFGGhNcqRwQ1tIFt%2F3snd5dS03MQWNqSQGcvGa%2B%2BrdpK93c3XAIQjYRi5qUt8%2FmDhTDiKln80VzNZlTtJBGBOi6XgUufVAgw2CXjS%2BZ1m7Wac%2F2uqhaX0GgG88KoGquvDQ4MQ1SeX5ABEAgt3pp2%2BPebBcYFl9YD6qbFuR0WnGt11PSnR7cRz6qgWT8BezoZtUKQw5Ko4QCwTn8nHbTWEO3w5jW9CTmh6XNfimbmLJTHktq%2BgjMeVa6kHCkWe2eIcrYuxiDWrNUknAo7MK03wU%3D";

        self = this;
        self.purl = purl;
        self.cId = cId;
        //var cId = document.getElementById("iotConnId").value;
        //var purl = document.getElementById("iotPurl").value;
        var args = {
            preSignedUrl:purl,
            connectionId:cId,
            callback:function(eventType, data){self.called(eventType, data);},
            maxRetryTime : 120,
            debug: true
        };
        self.paho = new PahoIotConnection(args);
        self.checkStuff();
    }

    called(eventType, data) {
        console.log("");
        console.log("PahoIotConnectionTest callbacked: " + eventType + ": ");
        console.log(data);
        console.log("");
    }

    test1D() {
        var self = this;
        console.log("just before disconnect");
        self.checkStuff();
        self.paho.disconnect();
        console.log("just after disconnect");
        self.checkStuff();
    }

    test1C() {
        var self = this;
        console.log("just before unsubscribe");
        self.checkStuff();
        self.paho.unsubscribe(self.cId, {}).
            then(function(response) {console.log("unsubscribe success: "); console.log(response); self.checkStuff(); setTimeout(self.test1D(), 3000);}).
            catch(function(error) {console.log("unsubscribe Failed: "); console.log(error); self.checkStuff();});


    }

    test1B() {
        var self = this;
        console.log("just before subscribe");
        self.checkStuff();
        self.paho.subscribe(self.cId, {"qos":1}).
            then(function(response) {console.log("subscribe success: "); console.log(response); self.checkStuff();}).
            catch(function(error) {console.log("subscribe Failed: "); console.log(error); self.checkStuff();});
        self.checkStuff();
    }


    test1() {
        self = this;
        this.paho.connect({
            useSSL: true,
            mqttVersion: 4,
            keepAliveInterval: 300,
            reconnect:true
        }).
            then(function(response) {console.log("connected: "); console.log(response); self.checkStuff(); setTimeout(function(){self.test1B();}, 3000)}).
            catch(function(error) {console.log("connectionFailed: "); console.log(error); self.checkStuff();});
        self.checkStuff();
        
    }


    checkStuff() {
        console.log("Status is:");
        console.log(this.paho.getStatus());
        console.log("Topics are:");
        console.log(this.paho.getSubscribedTopics());
    }

}


testPaho = new PahoIotConnectionTest();
document.getElementById("button1").addEventListener("click", function() {testPaho.setup(); testPaho.test1()});

document.getElementById("button2").addEventListener("click", function() {testPaho.test1C()});
*/

/*
participantToken = "AQIDAHhGwqfCvMO4XkBJFVZswpXDnR85wq7DlwI7wo8qwqHDj8KcARNkw6wpwqbDvMOYw4oBw5HClcOKwqjCnWHChsKJFRc/w6bDo8OqIsOFAAAAbjBsBgkqwoZIwobDtw0BBwbCoF8wXQIBADBYBgkqwoZIwobDtw0BBwEwHgYJYMKGSAFlAwQBLjARBAx0w70LwpTDi8KuKsKoCcOfw6/CvQIBEMKAK8K6wrxgR8Kvw73Dj03Ck8Kcwr5Jw48Kw5vDhWfDmHZpwp8/QlvDrcOTw4dlwp/Cv0bClUDCv8OmIBHCsGh6ccKZw686OkhbD8KaKsKNwrPDiAUNDsKTwqYSwoDCvcKCw5zChcKjw48od8KmXnpIwpx1JUN8VMKsAcOBw7dMfcO6S8OEwrPDnMKzNgYZw6VucnbCi8OjO1TDksKZMRfCm8KQJMK9w41lwp7CicKDw5DCpkLCphYcwojDm3rClxnCjcKUHEBRw59HfcOvw7EXMWLCt17DknwPwoU+a0xgfcKvG8O7TsObJ8KJw7s6fmjCiMKjBikOFcKxI2rCncKtZcKfwoAlLcKcw7ZOwrzCsRHDqsOSYMKvSgEqE8KcVMKtZmvDgV4uwqbCusOxw4XCi8O1LA/CgsKrFHbDj8Kuw5fDl1B/G0RIVcOpf8KgYTnDlcKnIcOpRQE=";

client = ACPS_CLIENT_FACTORY.getClient("PROD");
function testThis() {
client.sendTextMessage(participantToken, "textMessageSend").
    then(function(r) {console.log("response"); console.log(r);}).
    catch(function(e){console.log("error"); console.log(e);});

}

document.getElementById("button1").addEventListener("click", function() {testThis()});
*/
